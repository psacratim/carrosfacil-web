ESTRUTURA DE CÓDIGO FONTE - PROJETO ADMIN
Este arquivo contém o contexto consolidado do diretório /admin/.
==================================================

--- START_FILE: ..\about.php ---
<?php
require_once("./conexao/conecta.php");
require_once('./Components/Header.php');
?>

<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sobre Nós - Carros Fácil</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

    <link rel="stylesheet" href="./custom/css/style.css">
    <style>
        :root {
            --blue-primary: rgb(30, 58, 138); /* Cor extraída do seu style.css */
        }

        .hero-about {
            background: linear-gradient(rgba(30, 58, 138, 0.85), rgba(30, 58, 138, 0.85)), url('https://images.unsplash.com/photo-1552519507-da3b142c6e3d?auto=format&fit=crop&q=80&w=1920');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 80px 0;
            text-align: center;
        }

        .section-padding {
            padding: 60px 0;
        }

        .icon-box {
            padding: 30px;
            border-radius: 12px;
            background: #fff;
            border: 1px solid #eee;
            transition: all 0.3s ease;
            height: 100%;
        }

        .icon-box:hover {
            border-color: var(--blue-primary);
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }

        .icon-box i {
            font-size: 2.5rem;
            color: var(--blue-primary);
            margin-bottom: 15px;
            display: inline-block;
        }

        .about-text {
            font-family: 'Poppins', sans-serif;
            line-height: 1.8;
            color: #475569;
        }

        .value-card {
            background-color: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            border-left: 5px solid var(--blue-primary);
        }
    </style>
</head>

<body>
    <?php echo HeaderComponent("about"); ?>

    <section class="hero-about">
        <div class="container">
            <h1 class="display-4 fw-bold">O Jeito Fácil de Comprar seu Carro</h1>
            <p class="lead">Transparência e tecnologia para conectar você ao seu próximo veículo.</p>
        </div>
    </section>

    <section class="section-padding">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <img src="./assets/img/about-us-image.png" alt="Carros Selecionados" class="img-fluid rounded-4 shadow-sm">
                </div>
                <div class="col-lg-6 ps-lg-5">
                    <h2 class="mb-4 text-c1 fw-bold">Quem somos</h2>
                    <div class="about-text">
                        <p>A <strong>Carros Fácil</strong> nasceu da vontade de simplificar o mercado automotivo. Sabemos que comprar um veículo é um passo importante, e nossa missão é garantir que esse processo seja claro, seguro e, acima de tudo, fácil.</p>
                        <p>Diferente do modelo tradicional, focamos em uma <strong>curadoria digital rigorosa</strong>. Cada carro em nosso estoque é selecionado criteriosamente para garantir que você leve para casa qualidade e procedência, sem letras miúdas.</p>
                    </div>
                    
                    <div class="row mt-4 g-3">
                        <div class="col-md-6">
                            <div class="value-card h-100">
                                <h6 class="fw-bold text-uppercase small text-primary">Nossa Missão</h6>
                                <p class="mb-0 small">Proporcionar a melhor experiência de compra, eliminando burocracias desnecessárias.</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="value-card h-100">
                                <h6 class="fw-bold text-uppercase small text-primary">Nosso Diferencial</h6>
                                <p class="mb-0 small">Atendimento humanizado aliado a ferramentas digitais para facilitar sua escolha.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="section-padding bg-light">
        <div class="container">
            <div class="text-center mb-5">
                <h2 class="fw-bold text-c1">Por que escolher a Carros Fácil?</h2>
                <p class="text-muted">Focamos no que realmente importa para você.</p>
            </div>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="icon-box text-center">
                        <i class="bi bi-search"></i>
                        <h5>Curadoria Exclusiva</h5>
                        <p class="small text-muted">Não temos todos os carros, apenas os melhores. Filtramos o estoque para que você tenha apenas opções de alta qualidade.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="icon-box text-center">
                        <i class="bi bi-shield-lock"></i>
                        <h5>Transparência Total</h5>
                        <p class="small text-muted">Informações reais sobre o estado de cada veículo. Sem surpresas negativas na hora da visita ou da compra.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="icon-box text-center">
                        <i class="bi bi-chat-heart"></i>
                        <h5>Foco no Cliente</h5>
                        <p class="small text-muted">Somos uma loja nova com energia para oferecer o melhor atendimento personalizado da região.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <?php include_once('./Components/Footer.php'); ?>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
--- END_FILE: ..\about.php ---
------------------------------

--- START_FILE: ..\contact.php ---
<?php
require_once("./conexao/conecta.php");
    require_once('./Components/Header.php');
?>

<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carros Fácil - Suporte</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

    <link rel="stylesheet" href="./custom/css/style.css">
    <style>
        :root {
            --primary-blue: #004aad;
            --light-blue: #eef2f7;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
        }

        .sect-page-header {
            background-color: var(--primary-blue);
            color: white;
            padding: 60px 0;
            margin-bottom: 40px;
        }

        /* Estilização dos Cards com Shadow */
        .custom-card {
            background-color: #fff;
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1) !important;
            /* Shadow para destacar do fundo */
            /* Garante que ambos tenham a mesma altura se necessário */
        }

        .contact-info-item {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .contact-info-item i {
            font-size: 1.5rem;
            color: var(--primary-blue);
            background: var(--light-blue);
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin-right: 15px;
        }

        .form-control,
        .form-select {
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .form-control:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 0.25rem rgba(0, 74, 173, 0.25);
        }

        .btn-send {
            background-color: var(--primary-blue);
            color: white;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 600;
            transition: 0.3s;
            border: none;
            width: 100%;
        }

        .btn-send:hover {
            background-color: #003a8c;
            color: white;
        }

        /* Ajuste fino para os títulos */
        .card-title-custom {
            color: var(--primary-blue);
            font-weight: 700;
            margin-bottom: 1.5rem;
        }
    </style>
</head>

<body>
    <?php
    echo HeaderComponent("contact");
    ?>

    <section class="sect-page-header">
        <div class="container text-center">
            <h1 class="fw-bold">Suporte ao Cliente</h1>
            <p>Estamos aqui para ajudar você com qualquer dúvida ou problema.</p>
        </div>
    </section>

    <main class="container mb-5">
        <div class="row g-4 align-items-stretch">
            <div class="col-lg-7">
                <div class="custom-card p-4 p-md-5">
                    <h3 class="card-title-custom">Envie uma mensagem</h3>
                    <form action="" method="POST">
                        <div class="mb-3">
                            <label for="nome" class="form-label">Nome Completo</label>
                            <input type="text" class="form-control" id="nome" name="nome" placeholder="Seu nome aqui" required>
                        </div>

                        <div class="mb-3">
                            <label for="email" class="form-label">E-mail</label>
                            <input type="email" class="form-control" id="email" name="email" placeholder="email@exemplo.com" required>
                        </div>

                        <div class="mb-3">
                            <label for="motivo" class="form-label">Motivo do Contato</label>
                            <select class="form-select" id="motivo" name="motivo" required>
                                <option value="" selected disabled>Selecione uma opção</option>
                                <option value="Dúvida sobre Veículo">Dúvida sobre Veículo</option>
                                <option value="Financiamento">Financiamento</option>
                                <option value="Pós-venda">Pós-venda / Garantia</option>
                                <option value="Sugestão ou Crítica">Sugestão ou Crítica</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label for="mensagem" class="form-label">Mensagem (Opcional)</label>
                            <textarea class="form-control" id="mensagem" name="mensagem" rows="4" placeholder="Como podemos ajudar?"></textarea>
                        </div>

                        <button type="submit" class="btn-send">
                            <i class="bi bi-send-fill me-2"></i> Enviar Solicitação
                        </button>
                    </form>
                </div>
            </div>

            <div class="col-lg-5">
                <div class="custom-card p-4 p-md-5">
                    <h3 class="card-title-custom">Canais de Atendimento</h3>

                    <div class="contact-info-item">
                        <i class="bi bi-telephone"></i>
                        <div>
                            <p class="mb-0 fw-bold">Telefone</p>
                            <span>(19) 3333-3333</span>
                        </div>
                    </div>

                    <div class="contact-info-item">
                        <i class="bi bi-whatsapp"></i>
                        <div>
                            <p class="mb-0 fw-bold">WhatsApp</p>
                            <a href="https://wa.me/5519999999999" target="_blank" class="text-decoration-none text-dark">
                                (19) 99999-9999
                            </a>
                        </div>
                    </div>

                    <div class="contact-info-item">
                        <i class="bi bi-geo-alt"></i>
                        <div>
                            <p class="mb-0 fw-bold">Endereço</p>
                            <span>Rua dos Carros, 123 - SP</span>
                        </div>
                    </div>

                    <div class="contact-info-item">
                        <i class="bi bi-envelope"></i>
                        <div>
                            <p class="mb-0 fw-bold">E-mail</p>
                            <span>contato@carrosfacil.com.br</span>
                        </div>
                    </div>

                    <hr class="my-4 text-secondary opacity-25">

                    <div class="text-center bg-light p-3 rounded-3">
                        <p class="fw-bold mb-1" style="color: var(--primary-blue);">Horário de Funcionamento</p>
                        <small class="text-muted d-block">Segunda à Sexta: 08h às 18h</small>
                        <small class="text-muted d-block">Sábado e Domingo: 10h às 14h</small>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <?php
    include_once('./Components/Footer.php');
    ?>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
--- END_FILE: ..\contact.php ---
------------------------------

--- START_FILE: ..\index.php ---
<?php
require_once("./conexao/conecta.php");
require_once('./Components/Header.php');
?>

<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carros Fácil - Inicio</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Newsreader:ital,opsz,wght@0,6..72,200..800;1,6..72,200..800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

    <link rel="stylesheet" href="./custom/css/index.css">
    <link rel="stylesheet" href="./custom/css/style.css">
</head>

<body class="bg-light">
    <?php
    echo HeaderComponent("index");
    ?>

    <section id="sect-search-car" class="py-5 text-white text-center shadow-sm">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <h1 class="display-5 fw-bold mb-3">Encontre o seu veículo ideal</h1>
                    <p class="lead mb-4">Veículos usados, semi-novos e novos com as melhores condições do mercado</p>
<form action="" id="form-search-car" class="row g-2 justify-content-center align-items-stretch">
                        <div class="col-md-9">
                            <div class="search-input-container">
                                <input onkeyup="applyFilters()" 
                                       class="form-control form-control-lg search-input-field" 
                                       type="text" 
                                       name="search_value" 
                                       id="search-value" 
                                       placeholder="Digite a marca, modelo ou ano...">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-dark btn-lg w-100 h-100 fw-bold border-0" type="submit">
                                BUSCAR
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <main class="container my-5">
        <div class="row g-4">
            <aside class="col-lg-3">
                <div class="card border-0 shadow-sm sticky-lg-top" style="top: 80px; z-index: 10;">
                    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold text-primary">Filtros</h5>
                        <button id="clear-filters" class="btn btn-sm btn-outline-secondary">
                            <i class="bi bi-arrow-clockwise"></i> Limpar
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="search_value" class="form-label fw-medium small">Palavra-chave</label>
                            <input onkeyup="applyFilters()" class="form-control" type="text" name="search_value" id="search_value" placeholder="Marca, modelo...">
                        </div>

                        <div class="mb-3">
                            <label for="category" class="form-label fw-medium small">Categoria</label>
                            <select onchange="applyFilters()" class="form-select" name="category" id="category">
                                <option value="" selected>- Todas as categorias -</option>
                                <?php
                                $query = "SELECT DISTINCT categoria FROM veiculo";
                                $result = mysqli_query($connection, $query);
                                foreach ($result as $veiculo) {
                                    echo "<option value='" . $veiculo['categoria'] . "'>" . $veiculo['categoria'] . "</option>";
                                }
                                ?>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="condition" class="form-label fw-medium small">Condição</label>
                            <select onchange="applyFilters()" class="form-select" name="condition" id="condition">
                                <option value="" selected>- Todas as condições -</option>
                                <option value="Novo">Novo</option>
                                <option value="Semi-novo">Semi-novo</option>
                                <option value="Usado">Usado</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="brand" class="form-label fw-medium small">Marca</label>
                            <select onchange="applyFilters()" class="form-select" name="brand" id="brand">
                                <option value="" selected>- Todas as marcas -</option>
                                <?php
                                $query = "SELECT id, nome FROM marca WHERE status = 1";
                                $result = mysqli_query($connection, $query);
                                foreach ($result as $marca) {
                                    echo "<option value='" . $marca['id'] . "'>" . $marca['nome'] . "</option>";
                                }
                                ?>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="fuel" class="form-label fw-medium small">Combustível</label>
                            <select onchange="applyFilters()" class="form-select" name="fuel" id="fuel">
                                <option value="" selected>- Todos os tipos -</option>
                                <option value="Gasolina">Gasolina</option>
                                <option value="Etanol">Etanol</option>
                                <option value="Flex">Flex</option>
                                <option value="Diesel">Diesel</option>
                                <option value="Elétrico">Elétrico</option>
                                <option value="GNV (Gás Natural Veicular)">GNV</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="gearbox" class="form-label fw-medium small">Câmbio</label>
                            <select onchange="applyFilters()" class="form-select" name="gearbox" id="gearbox">
                                <option value="" selected>- Todos os câmbios -</option>
                                <option value="Manual">Manual</option>
                                <option value="Automático T.">Automático Tradicional</option>
                                <option value="CVT">CVT</option>
                                <option value="Auto. Mono-Emb.">Automatizado</option>
                                <option value="DCT">DCT (Dupla Embreagem)</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="mileage" class="form-label fw-medium small">KM Máxima</label>
                            <input onkeyup="applyFilters()" class="form-control" type="text" name="mileage" id="mileage" placeholder="Ex: 50.000">
                        </div>

                        <div class="mb-3">
                            <label for="year" class="form-label fw-medium small">Ano</label>
                            <input onkeyup="applyFilters()" class="form-control" type="text" name="year" id="year" placeholder="Ex: 2025">
                        </div>

                        <div class="mb-2">
                            <label for="price_range" class="form-label fw-medium small d-flex justify-content-between">
                                Preço Máximo <span>R$<span id="range-val-display">10M</span></span>
                            </label>
                            <input oninput="updateRangeDisplay(this.value); applyFilters()" type="range" class="form-range" min="0" max="10000000" step="5000" value="10000000" id="price_range">
                            <div class="d-flex justify-content-between small text-muted">
                                <span>R$0</span>
                                <span>R$10M+</span>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <section class="col-lg-9">
                <div id="sect-vehicles-list" class="row g-4">
                </div>
            </section>
        </div>
    </main>

    <div id="sect-data" class="py-5">
        <div class="container">
            <div class="row text-center g-4">
                <div class="col-md-4">
                    <div class="p-3">
                        <i class="bi bi-whatsapp fs-1 mb-3 d-block"></i>
                        <h6 class="fw-bold mb-1">WhatsApp</h6>
                        <span class="">(19) 99999-9999</span>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="p-3 border-start border-end border-md-0">
                        <i class="bi bi-geo-alt fs-1 mb-3 d-block"></i>
                        <h6 class="fw-bold mb-1">Localização</h6>
                        <span class="d-block">Rua dos Carros, 123</span>
                        <span class="">São Paulo - SP</span>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="p-3">
                        <i class="bi bi-clock fs-1 mb-3 d-block"></i>
                        <h6 class="fw-bold mb-1">Horários</h6>
                        <span class="d-block">Segunda à Sexta: 8h - 18h</span>
                        <span class="">Sáb. e Dom.: 10h - 14h</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <?php
    include_once('./Components/Footer.php');
    ?>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let mainHeader = $('#main-header')

        $(function() {
            const headerObserver = new IntersectionObserver(([entry]) => {
                mainHeader.toggleClass('scrolled', !entry.isIntersecting)
            }, {
                threshold: 0
            })

            // Ajuste caso o sentinel não exista no HeaderComponent, aplicamos ao body top
            const sentinel = document.querySelector("#header-sentinel") || document.body;
            headerObserver.observe(sentinel);
        });

        // Auxiliar para mostrar o valor do range
        function updateRangeDisplay(val) {
            let display = val >= 1000000 ? (val / 1000000).toFixed(0) + 'M' : (val / 1000).toFixed(0) + 'k';
            $("#range-val-display").text(display);
        }

        // Limpar filtros
        $("#clear-filters").click(function() {
            $("#asid-filters input, #asid-filters select").val('');
            $("#price_range").val(10000000);
            updateRangeDisplay(10000000);
            applyFilters();
        });

        // AJAX (FUNÇÃO PARA LISTAR OS VEÍCULOS)
        function updateTableWithFilters(search_value, category, condition, brand, fuel, gearbox, mileage, price_range, year) {
            $.ajax({
                url: 'vehicle-list.php',
                method: 'POST',
                data: {
                    search_value,
                    category,
                    condition,
                    brand,
                    fuel,
                    gearbox,
                    mileage,
                    price_range,
                    year
                },
                dataType: 'html',
                beforeSend: function() {
                    $("#sect-vehicles-list").css('opacity', '0.5');
                },
                success: function(response) {
                    $("#sect-vehicles-list").html(response).css('opacity', '1');
                }
            })
        }

        // AJAX (Função para aplicar o filtro)
        function applyFilters() {
            let search_value = $("#search_value").val() || $("#search-value").val();
            let category = $("#category").val();
            let condition = $("#condition").val();
            let brand = $("#brand").val();
            let fuel = $("#fuel").val();
            let gearbox = $("#gearbox").val();
            let mileage = $("#mileage").val();
            let price_range = $("#price_range").val();
            let year = $("#year").val();

            updateTableWithFilters(search_value, category, condition, brand, fuel, gearbox, mileage, price_range, year);
        }

        $("#form-search-car").on("submit", function(e) {
            e.preventDefault();
            // sincroniza o input do topo com o input real do filtro
            $("#search_value").val($("#search-value").val());
            applyFilters();
        });

        $(document).ready(function() {
            applyFilters();
        });
    </script>
</body>

</html>
--- END_FILE: ..\index.php ---
------------------------------

--- START_FILE: ..\Login.php ---
<?php
require_once("./conexao/conecta.php");
require_once('./Components/Header.php');
?>

<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carros Fácil - Inicio</title>

    <!-- GOOGLE FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Newsreader:ital,opsz,wght@0,6.72,200.800;1,6.72,200.800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <!-- BOOTSTRAP -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

    <!-- CUSTOM CSS -->
    <link rel="stylesheet" href="./custom/css/index.css">
    <link rel="stylesheet" href="./custom/css/style.css">
</head>

<!-- A página é pequena, essas classes é pra ela ter o tamanho mínimo igual da tela, pro footer ficar certo. -->

<body class="d-flex flex-column min-vh-100 m-0">
    <?php
    echo HeaderComponent('login');
    ?>

    <div class="container flex-fill p-0 p-sm-3">
        <main id="auth-container" class="my-5 d-flex justify-content-center align-items-center flex-wrap flex-column">
            <div class="auth-header d-flex justify-content-center align-content-center flex-wrap">
                <img src="./assets/img/logotipo-empresa.png" width="auto" height="32"
                    class="d-inline-block align-top my-auto" alt="">
                <p class="w-100 text-center mt-2">Preencha as informações para entrar na conta.</p>
            </div>
            <div class="p-4 white-bg col-12 col-md-6 col-xl-4 mt-2">
                <form action="/auth" method="post" id="auth-form">
                    <div class="form-group">
                        <label for="auth-name" class="text-c1 fw-bold mb-1">Usuário ou e-mail</label>

                        <div class="input-group">
                            <div class="input-icon"><i class="bi bi-person-fill"></i></div>
                            <input class="form-control" type="text" name="auth-name" id="auth-name" placeholder="ex: meu-email@email.com">
                        </div>
                    </div>

                    <div class="form-group mt-3">
                        <label for="password" class="text-c1 fw-bold mb-1">Senha</label>
                        <div class="input-group position-relative">
                            <div class="input-icon"><i class="bi bi-lock"></i></div>
                            <input class="form-control" type="password" name="input-password" id="input-password" placeholder="••••••••">
                            <button type="button" class="show-password" aria-label="Show password"><i class="bi bi-eye-slash"></i></button>
                        </div>
                        <a id="lost-password" class="form-text" href="#">Esqueceu a senha?</a>
                    </div>

                    <button id="auth-button" class="mt-3" type="submit">Entrar na conta</button>
                </form>
            </div>

            <div id="no-account-warn" class="mt-4">
                Não tem uma conta? <a href="/Register.php">Criar conta agora.</a>
            </div>
        </main>
    </div>

    <?php
    include_once('./Components/Footer.php');
    ?>

    <!-- BOOTSTRAP -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        $(function() {
            $(".show-password").on('click', function() {
                let passwordInput = $(this).parent().find('#input-password')[0];
                let isShowing = passwordInput.type == 'password'

                passwordInput.type = isShowing ? "text" : "password"
            });
        })
    </script>
</body>

</html>
--- END_FILE: ..\Login.php ---
------------------------------

--- START_FILE: ..\Product.php ---
<?php

try {
    $vehicleId = $_GET['id'] ?? false;
    if (!$vehicleId) {
        throw new Exception("No vehicle in url.");
    }

    require_once('./conexao/conecta.php');
    require_once('./Components/Header.php');

    $vehicleResult = mysqli_execute_query($connection, "SELECT veiculo.id, modelo.id, modelo.nome 'modelName', modelo.id_marca, marca.id 'brandId', marca.nome 'brandName', veiculo.preco_venda, veiculo.preco_desconto, veiculo.desconto, veiculo.descricao, veiculo.ano, veiculo.quilometragem, veiculo.tipo_cambio, veiculo.tipo_combustivel, veiculo.foto FROM veiculo INNER JOIN modelo on modelo.id = veiculo.id_modelo INNER JOIN marca on marca.id = modelo.id_marca WHERE veiculo.id = " . $vehicleId . ";");
    if (!$vehicleResult || $vehicleResult->num_rows === 0) {
        throw new Exception("Failed to get vehicle data.");
    }

    $vehiclePhotos = mysqli_execute_query($connection, "SELECT caminho, ordem FROM foto_veiculo WHERE id_veiculo = " . $vehicleId . ";");
    if (!$vehiclePhotos || $vehiclePhotos->num_rows === 0) {
        throw new Exception("Failed to get vehicle photos.");
    }

    $vehicleItems = mysqli_execute_query($connection, "SELECT caracteristica.id, caracteristica.nome, caracteristica.icone FROM caracteristica_carro INNER JOIN caracteristica ON caracteristica.id = caracteristica_carro.id_caracteristica WHERE caracteristica_carro.id_veiculo = " . $vehicleId . ";");
    if (!$vehicleItems) {
        throw new Exception("Failed to get vehicle data.");
    }

    $vehicle = $vehicleResult->fetch_assoc();
} catch (Exception $e) {
    header('Location: Index.php');
    exit;
}
?>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarrosFácil - <?= $vehicle['modelName'] ?></title>

    <!-- BOOTSTRAP CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

    <!-- BOOTSTRAP ICONS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://unpkg.com/lucide-static@latest/font/lucide.css" />

    <!-- CUSTOM CSS -->
    <link rel="stylesheet" href="/custom/css/style.css">
</head>

<body>
    <?php
    echo HeaderComponent("product-viewer");
    ?>

    <main id="product-viewer" class="pt-4 mb-4">
        <div class="container">
            <div class="row">
                <section id="galery" class="col-12 col-lg-8 p-0 pe-lg-4 align-self-start">
                    <div id="main-container">
                        <img id="main-image" class="img-fluid" src="../images/<?= $vehicle['foto'] ?>" alt="">
                    </div>
                    <div id="pictures" class="d-flex align-items-center">
                        <ul class="list-unstyled m-0 p-0">
                            <?php
                            $diretorio = "./images/";

                            // 1. Validar e mostrar a Foto Principal (destaque) na galeria
                            if (!empty($vehicle['foto']) && file_exists($diretorio . $vehicle['foto'])) {
                                echo '<li>';
                                echo '  <button class="picture active">';
                                echo '      <img class="w-100 h-100" src="' . $diretorio . $vehicle['foto'] . '" alt="Foto Principal">';
                                echo '  </button>';
                                echo '</li>';
                            }

                            // 2. Validar e mostrar as Fotos Extras
                            foreach ($vehiclePhotos as $photo) {
                                $caminhoCompleto = $diretorio . $photo['caminho'];

                                if (!empty($photo['caminho']) && file_exists($caminhoCompleto)) {
                                    echo '<li>';
                                    echo '  <button class="picture">';
                                    echo '      <img class="w-100 h-100" src="' . $caminhoCompleto . '" alt="Foto Adicional">';
                                    echo '  </button>';
                                    echo '</li>';
                                }
                            }
                            ?>
                        </ul>
                    </div>
                </section>
                <section id="product-info" class="col-12 col-lg-4 align-self-start mt-4 mt-lg-0 ms-lg-auto white-bg">
                    <div id="model-info">
                        <span id="brand"><?= $vehicle['brandName'] ?></span>
                        <h1 id="model-name"><?= $vehicle['modelName'] ?></h1>
                    </div>
                    <div id="price">
                        <?php
                        $hasDiscount = $vehicle['desconto'] > 0;
                        if ($hasDiscount) {
                            echo '<div id="real-price">R$ ' . number_format($vehicle['preco_venda'], 2, ',', '.') . '</div>';
                        }

                        echo '<div id="current-price">R$ ' . number_format($hasDiscount ? $vehicle['preco_desconto'] : $vehicle['preco_venda'], 2, ',', '.') . '</div>';
                        ?>
                        <div id="extra-payments-info">
                            Financiamento em até 60x
                        </div>
                    </div>
                    <div class="contact">
                        <?php
                        $buyMessage = rawurlencode("Olá, eu gostaria de comprar o veiculo {$vehicle["modelName"]} da marca {$vehicle["brandName"]}.");
                        $testMessage = rawurlencode("Olá, eu gostaria de agendar um test-drive no veiculo {$vehicle["modelName"]} da marca {$vehicle["brandName"]}.");
                        ?>

                        <a href="https://wa.me/5519999999999?text=<?= htmlspecialchars($buyMessage) ?>" target="_blank" id="talk-consultant" class="w-100 d-flex justify-content-center align-items-center mb-2">
                            <i class="bi bi-whatsapp"></i>
                            Falar com Consultor
                        </a>
                        <a href="https://wa.me/5519999999999?text=<?= htmlspecialchars($testMessage) ?>" id="test-drive" class="w-100 d-flex justify-content-center align-items-center">
                            <i class="icon-life-buoy"></i>
                            Agendar Test-Drive
                        </a>
                    </div>
                </section>
                <section id="basic-infos" class="mt-4 col-12 col-lg-8 p-0 m-0 pe-lg-4 d-flex justify-content-between flex-wrap">
                    <div class="basic-info-card">
                        <div class="content d-flex flex-wrap text-center p-2 white-bg">
                            <i class="bi bi-calendar3 w-100"></i>
                            <span class="w-100 info-name">Ano</span>
                            <span class="w-100 value"><?= $vehicle['ano'] ?></span>
                        </div>
                    </div>
                    <div class="basic-info-card">
                        <div class="content d-flex flex-wrap text-center p-2 white-bg">
                            <i class="w-100 bi bi-speedometer"></i>
                            <span class="w-100 info-name">KM</span>
                            <span class="w-100 value"><?= $vehicle['quilometragem'] ?> km</span>
                        </div>
                    </div>
                    <div class="basic-info-card col-6 col-md-3 mt-4 mt-md-0 pe-0">
                        <div class="content d-flex flex-wrap text-center p-2 white-bg">
                            <i class="w-100 bi bi-sliders"></i>
                            <span class="w-100 info-name">CÂMBIO</span>
                            <span class="w-100 value"><?= $vehicle['tipo_cambio'] ?></span>
                        </div>
                    </div>
                    <div class="basic-info-card col-6 col-md-3 mt-4 mt-md-0 pe-0">
                        <div class="content d-flex flex-wrap text-center p-2 white-bg">
                            <i class="w-100 bi bi-fuel-pump"></i>
                            <span class="w-100 info-name">COMBUSTÍVEL</span>
                            <span class="w-100 value"><?= $vehicle['tipo_combustivel'] ?></span>
                        </div>
                    </div>
                </section>
                <section id="description" class="mt-4 col-lg-8 col-12 ps-0 pe-lg-4 pe-0">
                    <div class="content p-3 white-bg">
                        <h2 class="info-card-title d-flex align-items-center gap-2">
                            <span class="w-1 h-6 bg-blue-900 rounded-full"></span>
                            Descrição
                        </h2>
                        <?= $vehicle['descricao'] ?>
                    </div>
                </section>
                <section id="vehicle-items-container" class="mt-4 col-lg-8 col-12 ps-0 pe-lg-4 pe-0">
                    <div class="content white-bg p-3">
                        <h2 class="info-card-title d-flex align-items-center gap-2">
                            <span class="w-1 h-6 bg-blue-900 rounded-full"></span>
                            Itens do veículo
                        </h2>
                        <ul class="list-unstyled row row-cols-1 row-cols-md-2 g-4 row-cols-xl-3" id="vehicle-items-list">
                            <?php
                            foreach ($vehicleItems as $item) {
                                echo '<li class="col">';
                                echo '  <div class="content">';
                                echo '      <img src="../images/' . $item['icone'] . '" class="item-icon" alt="">';
                                echo '      ' . $item['nome'];
                                echo '  </div>';
                                echo '</li>';
                            }
                            ?>
                        </ul>
                    </div>
                </section>
            </div>
        </div>
    </main>


    <?php
    include_once('./Components/Footer.php');
    ?>

    <!-- BOOTSTRAP JS + JQUERY -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- CUSTOM -->
    <script>
        $('.picture').click(function() {
            const newImage = $(this).find('img').attr('src');
            const currentImage = $('#main-image').attr('src');
            if (newImage == currentImage) {
                return;
            }

            $('#main-image').fadeOut(150, function() {
                $(this).attr('src', newImage).fadeIn(150);
            });

            $('.picture').removeClass('active');
            $(this).addClass('active');
        });
    </script>
</body>

</html>
--- END_FILE: ..\Product.php ---
------------------------------

--- START_FILE: ..\Register.php ---
<?php
require_once("./conexao/conecta.php");
require_once('./Components/Header.php');
?>

<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carros Fácil - Inicio</title>

    <!-- GOOGLE FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Newsreader:ital,opsz,wght@0,6.72,200.800;1,6.72,200.800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <!-- BOOTSTRAP -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

    <!-- CUSTOM CSS -->
    <link rel="stylesheet" href="./custom/css/index.css">
    <link rel="stylesheet" href="./custom/css/style.css">
</head>

<!-- A página é pequena, essas classes é pra ela ter o tamanho mínimo igual da tela, pro footer ficar certo. -->

<body class="d-flex flex-column min-vh-100 m-0">
    <?php
    echo HeaderComponent('login');
    ?>

    <div class="container flex-fill p-0 p-sm-3">
        <main id="auth-container" class="my-5 d-flex justify-content-center align-items-center flex-wrap flex-column">
            <div class="auth-header d-flex justify-content-center align-content-center flex-wrap">
                <img src="./assets/img/logotipo-empresa.png" width="auto" height="32"
                    class="d-inline-block align-top my-auto" alt="">
                <p class="w-100 text-center mt-2">Preencha as informações pra criar a conta</p>
            </div>
            <div class="p-4 white-bg col-12 col-md-8 col-lg-6 col-xl-4 mt-2">
                <form action="/auth" method="post" id="auth-form">
                    <div class="form-group">
                        <label for="auth-name" class="text-c1 fw-bold mb-1">E-mail</label>

                        <div class="input-group">
                            <div class="input-icon"><i class="bi bi-person-fill"></i></div>
                            <input class="form-control" type="text" name="auth-name" id="auth-name" placeholder="ex: meu-email@email.com">
                        </div>
                    </div>

                    <div class="form-group mt-3">
                        <label for="input-user-password" class="text-c1 fw-bold mb-1">Senha</label>
                        <div class="input-group position-relative">
                            <div class="input-icon"><i class="bi bi-lock"></i></div>
                            <input class="form-control input-password" type="password" name="input-user-password" id="input-user-password" placeholder="••••••••">
                            <button type="button" class="show-password" aria-label="Show password"><i class="bi bi-eye-slash"></i></button>
                        </div>
                    </div>

                    <div class="form-group mt-3">
                        <label for="input-confirm-password" class="text-c1 fw-bold mb-1">Confirmar senha</label>
                        <div class="input-group position-relative">
                            <div class="input-icon"><i class="bi bi-lock"></i></div>
                            <input class="form-control input-password" type="password" name="input-confirm-password" id="input-confirm-password" placeholder="••••••••">
                            <button type="button" class="show-password" aria-label="Show password"><i class="bi bi-eye-slash"></i></button>
                        </div>
                    </div>

                    <div id="accept-info" class="d-flex justify-content-center align-items-center mt-3">
                        <input type="checkbox" name="accept-terms" id="accept-terms" class="me-2 me-lg-1">
                        <span>Eu aceito os <a href="#" class="fw-bold">Termos de Uso</a> e <a href="#" class="fw-bold">Política de Privacidade</a></span>
                    </div>

                    <button id="auth-button" class="mt-3" type="submit">Criar conta</button>
                </form>
            </div>

            <div id="no-account-warn" class="mt-4">
                Já tem uma conta? <a href="/Login.php">Entrar na conta.</a>
            </div>
        </main>
    </div>

    <?php
    include_once('./Components/Footer.php');
    ?>

    <!-- BOOTSTRAP -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        $(function() {
            $(".show-password").on('click', function() {
                let passwordInput = $(this).parent().find('.input-password')[0];
                console.log($(this).parent())
                let isShowing = passwordInput.type == 'password'

                passwordInput.type = isShowing ? "text" : "password"
            });
        })
    </script>
</body>

</html>
--- END_FILE: ..\Register.php ---
------------------------------

--- START_FILE: ..\vehicle-list.php ---
<?php
require_once("./conexao/conecta.php");

$query = "
SELECT veiculo.id, modelo.nome 'nome_modelo', veiculo.tem_desconto, veiculo.desconto, veiculo.ano, veiculo.quilometragem, veiculo.tipo_combustivel, veiculo.tipo_cambio, veiculo.preco_venda, veiculo.preco_desconto, veiculo.foto, veiculo.status, veiculo.descricao, marca.nome FROM veiculo INNER JOIN modelo ON modelo.id = veiculo.id_modelo
INNER JOIN marca ON marca.id = modelo.id_marca
";
$search_value = $_POST['search_value'] ?? "";
$category = $_POST['category'] ?? "";
$condition = $_POST['condition'] ?? "";
$brand = $_POST['brand'] ?? "";
$fuel = $_POST['fuel'] ?? "";
$gearbox = $_POST['gearbox'] ?? "";
$mileage = $_POST['mileage'] ?? "";
$price_range = $_POST['price_range'] ?? "";
$year = $_POST['year'] ?? "";
$conditions = [];

if ($search_value !== "") {
    $conditions[] = "(
        modelo.nome LIKE '%$search_value%' 
        OR marca.nome LIKE '%$search_value%' 
        OR veiculo.descricao LIKE '%$search_value%'
    )";
}

if ($category !== "") {
    $conditions[] = "veiculo.categoria LIKE '%$category%'";
}

if ($condition !== "") {
    $conditions[] = "veiculo.estado_do_veiculo = '$condition'";
}

if ($brand !== "") {
    $conditions[] = "marca.id = $brand";
}
if ($fuel !== "") {
    $conditions[] = "veiculo.tipo_combustivel LIKE '%$fuel%'";
}
if ($gearbox !== "") {
    $conditions[] = "veiculo.tipo_cambio LIKE '%$gearbox%'";
}
if ($mileage !== "") {
    $conditions[] = "veiculo.quilometragem BETWEEN 0 AND $mileage";
}
if ($price_range !== "10000000") {
    $conditions[] = "veiculo.preco_venda BETWEEN 0 AND $price_range";
    $conditions[] = "veiculo.preco_desconto BETWEEN 0 AND $price_range";
}
if ($year !== "") {
    $conditions[] = "veiculo.ano = $year";
}

if (!empty($conditions)) {
    $query .= " WHERE " . implode(" AND ", $conditions);
}

$result = mysqli_query($connection, $query);
$num_rows = mysqli_num_rows($result);
?>

<div class="col-12 mb-2">
    <div class="d-flex justify-content-between align-items-center bg-white p-3 rounded shadow-sm">
        <h5 class="fw-bold mb-0">Nossos veículos</h5>
        <span class="badge bg-primary rounded-pill"><?php echo $num_rows ?> veículos</span>
    </div>
</div>

<?php
if ($num_rows > 0) {
    foreach ($result as $veiculo) {
        $caminho_imagem = "./images/" . $veiculo['foto'];
        $placeholder = './assets/img/placeholder-veiculo.avif';
        $foto_final = (!empty($veiculo['foto']) && file_exists($caminho_imagem)) ? $caminho_imagem : $placeholder;
?>
        <div class="col-12 col-md-6 col-xl-4 d-flex align-items-stretch">
            <div class="card w-100 border-0 shadow-sm vehicle-card-modern position-relative">
                
                <div class="position-absolute top-0 start-0 m-2 d-flex flex-column gap-1" style="z-index: 3;">
                    <?php if ($veiculo['status'] == 0): ?>
                        <span class="badge bg-danger">Indisponível</span>
                    <?php else: ?>
                        <span class="badge bg-success">Disponível</span>
                    <?php endif; ?>

                    <?php if ($veiculo['tem_desconto']): ?>
                        <span class="badge bg-warning text-dark">
                            <i class="bi bi-tag-fill"></i> -<?php echo $veiculo['desconto']; ?>%
                        </span>
                    <?php endif; ?>
                </div>

                <div class="vehicle-image-container">
                    <img src="<?php echo $foto_final; ?>" class="card-img-top" alt="<?php echo htmlspecialchars($veiculo['nome_modelo']); ?>">
                </div>

                <div class="card-body p-3 d-flex flex-column">
                    <div class="text-primary fw-bold small text-uppercase mb-1"><?php echo $veiculo['nome']; ?></div>
                    <h5 class="card-title fw-bold text-dark mb-3"><?php echo $veiculo['nome_modelo'] ?></h5>

                    <div class="row g-2 mb-3">
                        <div class="col-6 small text-muted">
                            <i class="bi bi-calendar3 text-primary me-1"></i> <?php echo $veiculo['ano'] ?>
                        </div>
                        <div class="col-6 small text-muted text-end">
                            <i class="bi bi-gear text-primary me-1"></i> <?php echo $veiculo['tipo_cambio'] ?>
                        </div>
                        <div class="col-6 small text-muted">
                            <i class="bi bi-fuel-pump text-primary me-1"></i> <?php echo $veiculo['tipo_combustivel'] ?>
                        </div>
                        <div class="col-6 small text-muted text-end">
                            <i class="bi bi-speedometer text-primary me-1"></i> 
                            <?php echo ($veiculo['quilometragem'] > 0) ? number_format($veiculo['quilometragem'], 0, ',', '.') . ' km' : 'Zero KM'; ?>
                        </div>
                    </div>

                    <div class="mt-auto pt-3 border-top">
                        <div class="price-section-container mb-3">
                            <?php if ($veiculo['tem_desconto']): ?>
                                <small class="text-muted text-decoration-line-through d-block old-price-height">
                                    R$ <?php echo number_format($veiculo['preco_venda'], 2, ',', '.') ?>
                                </small>
                                <span class="h4 fw-bold text-success mb-0 d-block">
                                    R$ <?php echo number_format($veiculo['preco_desconto'], 2, ',', '.') ?>
                                </span>
                            <?php else: ?>
                                <small class="text-muted d-block old-price-height invisible">Placeholder</small>
                                <span class="h4 fw-bold text-dark mb-0 d-block">
                                    R$ <?php echo number_format($veiculo['preco_venda'], 2, ',', '.') ?>
                                </span>
                            <?php endif; ?>
                        </div>
                        <a href="Product.php?id=<?= $veiculo['id'] ?>" class="btn btn-primary w-100 fw-bold rounded-pill">
                            Ver Detalhes
                        </a>
                    </div>
                </div>
            </div>
        </div>
<?php
    }
} else {
    echo '<div class="col-12 text-center py-5"><h4 class="text-muted">Nenhum veículo encontrado.</h4></div>';
}
?>
--- END_FILE: ..\vehicle-list.php ---
------------------------------

--- START_FILE: ..\admin\admin.php ---
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <title>Carros Fácil - Painel</title>

  <!-- BOOTSTRAP CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

  <!-- BOOTSTRAP ICONS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <!-- CUSTOMIZAÇÃO DO TEMPLATE -->
  <link rel="stylesheet" href="../assets/css/dashboard.css">
  <link rel="stylesheet" href="../assets/css/styles.css">
  
  <!-- FAVICON -->
  <link rel="shortcut icon" href="../assets/img/favicon.ico" type="image/x-icon">

  <!-- CSS -->
  <link rel="stylesheet" href="../custom/css/style.css">
</head>
<body>
    
  <?php
    #Início TOPO
    // include('Topo.php');
    #Final TOPO
  ?>

  <div class="container-fluid">
    <div class="row">
      <?php
        #Início MENU
        include('Components/SideNavbar.php');
        #Final MENU
      ?>

      <main class="ml-auto col-lg-10 px-md-4">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
          <h1 class="h2">Painel Administrativo</h1>
          <h2 class="h3">Olá, USUÁRIO!</h2>
        </div>

        <div>
          Você não é um administrador
        </div>

      </main>
    </div>
  </div>

  <!-- BOOTSTRAP JS -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
</body>
</html>
--- END_FILE: ..\admin\admin.php ---
------------------------------

--- START_FILE: ..\admin\Dashboard.php ---
<?php
require_once('../conexao/conecta.php');
require_once('../Components/Sidebar.php');

if (!isset($_SESSION)) {
    session_start();
}

// 1. Coleta de Estatísticas (Lógica em EN / Banco em PT-BR)

// Total de Vendas (Soma do valor_total)
$salesQuery = mysqli_query($connection, "SELECT SUM(valor_total) AS total FROM venda");
$totalSales = mysqli_fetch_assoc($salesQuery)['total'] ?? 0;

// Total de Clientes
$customersQuery = mysqli_query($connection, "SELECT COUNT(id) AS total FROM cliente");
$totalCustomers = mysqli_fetch_assoc($customersQuery)['total'] ?? 0;

// Total de Veículos em Estoque
$stockQuery = mysqli_query($connection, "SELECT SUM(estoque) AS total FROM veiculo");
$totalStock = mysqli_fetch_assoc($stockQuery)['total'] ?? 0;

// Total de Funcionários
$employeesQuery = mysqli_query($connection, "SELECT COUNT(id) AS total FROM funcionario");
$totalEmployees = mysqli_fetch_assoc($employeesQuery)['total'] ?? 0;

// 2. Vendas Recentes (Join para pegar o nome do cliente)
$recentSalesQuery = mysqli_query($connection, "
        SELECT v.id, c.nome AS cliente_nome, v.valor_total, v.data_cadastro 
        FROM venda v 
        INNER JOIN cliente c ON v.id_cliente = c.id 
        ORDER BY v.data_cadastro DESC LIMIT 5
    ");

// 3. Alerta de Estoque Baixo (Menos de 3 unidades)
$lowStockQuery = mysqli_query($connection, "
        SELECT m.nome AS modelo, v.cor, v.estoque 
        FROM veiculo v 
        INNER JOIN modelo m ON v.id_modelo = m.id 
        WHERE v.estoque < 3 
        ORDER BY v.estoque ASC LIMIT 5
    ");
?>

<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Dashboard Admin | Sistema de Veículos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">


    <link rel="stylesheet" href="../../custom/css/style.css">
    <style>
        .stat-card {
            transition: transform 0.2s;
            border: none;
            border-radius: 15px;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .icon-box {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
    </style>
</head>

<body class="bg-light">

    <div class="d-flex">
        <?php echo Sidebar("dashboard"); ?>

        <main class="flex-grow-1 p-4">
            <div class="container-fluid">

                <div class="row mb-4">
                    <div class="col">
                        <h2 class="fw-bold">Visão Geral</h2>
                        <p class="text-secondary">Bem-vindo ao painel administrativo.</p>
                    </div>
                </div>

                <div class="row g-4 mb-5">
                    <div class="col-12 col-sm-6 col-xl-3">
                        <div class="card stat-card shadow-sm p-3">
                            <div class="d-flex align-items-center">
                                <div class="icon-box bg-success text-white me-3">
                                    <i class="bi bi-currency-dollar"></i>
                                </div>
                                <div>
                                    <h6 class="text-secondary mb-0">Total Vendas</h6>
                                    <h4 class="fw-bold mb-0">R$ <?= number_format($totalSales, 2, ',', '.') ?></h4>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-12 col-sm-6 col-xl-3">
                        <div class="card stat-card shadow-sm p-3">
                            <div class="d-flex align-items-center">
                                <div class="icon-box bg-primary text-white me-3">
                                    <i class="bi bi-people"></i>
                                </div>
                                <div>
                                    <h6 class="text-secondary mb-0">Clientes</h6>
                                    <h4 class="fw-bold mb-0"><?= $totalCustomers ?></h4>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-12 col-sm-6 col-xl-3">
                        <div class="card stat-card shadow-sm p-3">
                            <div class="d-flex align-items-center">
                                <div class="icon-box bg-warning text-dark me-3">
                                    <i class="bi bi-car-front"></i>
                                </div>
                                <div>
                                    <h6 class="text-secondary mb-0">Veículos</h6>
                                    <h4 class="fw-bold mb-0"><?= $totalStock ?> un.</h4>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-12 col-sm-6 col-xl-3">
                        <div class="card stat-card shadow-sm p-3">
                            <div class="d-flex align-items-center">
                                <div class="icon-box bg-info text-white me-3">
                                    <i class="bi bi-person-badge"></i>
                                </div>
                                <div>
                                    <h6 class="text-secondary mb-0">Equipe</h6>
                                    <h4 class="fw-bold mb-0"><?= $totalEmployees ?></h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row g-4">
                    <div class="col-12 col-lg-8">
                        <div class="card border-0 shadow-sm p-4 rounded-4">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="fw-bold mb-0">Vendas Recentes</h5>
                                <a href="vendas/Index.php" class="btn btn-sm btn-outline-primary">Ver Todas</a>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover align-middle">
                                    <thead class="table-light">
                                        <tr>
                                            <th>ID</th>
                                            <th>Cliente</th>
                                            <th>Data</th>
                                            <th>Valor</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <?php while ($sale = mysqli_fetch_assoc($recentSalesQuery)): ?>
                                            <tr>
                                                <td>#<?= $sale['id'] ?></td>
                                                <td class="fw-semibold"><?= $sale['cliente_nome'] ?></td>
                                                <td><?= date('d/m/Y', strtotime($sale['data_cadastro'])) ?></td>
                                                <td class="text-success fw-bold">R$ <?= number_format($sale['valor_total'], 2, ',', '.') ?></td>
                                            </tr>
                                        <?php endwhile; ?>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="col-12 col-lg-4">
                        <div class="card border-0 shadow-sm p-4 rounded-4 h-100">
                            <h5 class="fw-bold mb-4 text-danger">Atenção ao Estoque</h5>
                            <div class="list-group list-group-flush">
                                <?php while ($stock = mysqli_fetch_assoc($lowStockQuery)): ?>
                                    <div class="list-group-item d-flex justify-content-between align-items-center px-0 bg-transparent">
                                        <div>
                                            <h6 class="mb-0 fw-bold"><?= $stock['modelo'] ?></h6>
                                            <small class="text-secondary"><?= $stock['cor'] ?></small>
                                        </div>
                                        <span class="badge bg-danger rounded-pill"><?= $stock['estoque'] ?> un.</span>
                                    </div>
                                <?php endwhile; ?>
                            </div>
                            <?php if (mysqli_num_rows($lowStockQuery) == 0): ?>
                                <p class="text-center text-muted py-4">Tudo em ordem com o estoque!</p>
                            <?php endif; ?>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- API JS -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- CUSTOM JS -->
    <script src="../../assets/js/components/admin-header.js"></script>
    <script src="../../assets/js/components/sidebar.js"></script>
</body>

</html>
--- END_FILE: ..\admin\Dashboard.php ---
------------------------------

--- START_FILE: ..\admin\Index.php ---
<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <title>Carros Fácil - Login</title>

  <!-- BOOTSTRAP CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

  <!-- FAVICON -->
  <link rel="shortcut icon" href="../assets/img/favicon.ico" type="image/x-icon">

  <!-- CUSTOM CSS -->
  <link rel="stylesheet" href="../assets/css/signin.css">
  <link rel="stylesheet" href="../assets/css/styles.css">
  <link rel="stylesheet" href="../custom/css/style.css">
</head>

<body class="text-center">

  <main class="form-signin">
    <form action="login.php" method="POST">
      <h2 class="h3 mb-3">Faça seu Login</h2>

      <input type="text" class="form-control mb-2" name="username" placeholder="Usuário">

      <input type="password" class="form-control" name="password" placeholder="Senha">

      <button class="w-100 btn btn-lg btn-primary" type="submit">Login</button>

    </form>

    <div class="pt-2">
      STATUS DE MENSAGEM
    </div>

    <p class="mt-5 text-muted">&copy; <?= date('Y') ?></p>
  </main>

  <!-- BOOTSTRAP JS -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
</body>
</html>
--- END_FILE: ..\admin\Index.php ---
------------------------------

--- START_FILE: ..\admin\Mensagem.php ---
<?php 
    if (isset($_SESSION['messageType']) && isset($_SESSION['messageText'])) {
        switch ($_SESSION['messageType']) {
            case 'success':
                echo '<div class="alert alert-success alert-dismissible fade show mt-3" role="alert">';
                break;
            case 'info':
                echo '<div class="alert alert-info alert-dismissible fade show mt-3" role="alert">';
                break;
            default: // type: error
                echo '<div class="alert alert-danger alert-dismissible fade show mt-3" role="alert">';
                break;
        }
        echo $_SESSION['messageText'];
        echo '
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>';

        unset($_SESSION['messageType']);
        unset($_SESSION['messageText']);
    }
?>
--- END_FILE: ..\admin\Mensagem.php ---
------------------------------

--- START_FILE: ..\admin\upload_image.php ---
<?php 
    header("Access-Control-Allow-Origin: *");
    header("Access-Control-Allow-Methods: POST");
    header("Access-Control-Allow-Headers: Content-Type");
    
    if (isset($_FILES["image"])) {
        $image = basename($_FILES['image']['name']);
        $tempImagePath = $_FILES['image']['tmp_name'];
        $final = '../images/' . $image;
        
        if (move_uploaded_file($tempImagePath, $final)){
            echo json_encode($image);
        } else {
            echo json_encode("unknown_error");
        }
    } else {
        echo json_encode("error_no_file");
    }
?>
--- END_FILE: ..\admin\upload_image.php ---
------------------------------

--- START_FILE: ..\Components\Footer.php ---
<footer class="footer">
    <div class="copyright">
        CarrosFácil<br>
        © 2025 Carros Fácil. Todos os direitos reservados.
    </div>
</footer>
--- END_FILE: ..\Components\Footer.php ---
------------------------------

--- START_FILE: ..\Components\FormModal.php ---
<?php

class FormModal
{
    public static function create(array $settings, array $fields)
    {
        $modalId = htmlspecialchars($settings["modalId"]);
        $actionUrl = htmlspecialchars($settings["actionUrl"]);

        ob_start();
?>

        <div class="form-modal modal fade" id="<?= $modalId ?>" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="<?= $modalId ?>Label" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="<?= $modalId ?>Label"></h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form action="<?= $actionUrl ?>" method="post" enctype="multipart/form-data">

                            <div class="row">
                                <?php
                                foreach ($fields as $field) {
                                    $label = $field['label'];
                                    $labelPrefix = $field['optional'] ? '' : '<span class="text-danger">*</span> ';

                                    if ($field['type'] == 'text') {
                                        $length = "";
                                        if (isset($field["length"])) {
                                            $length = 'maxlength="'. $field["length"] .'"';
                                        }
                                ?>
                                        <div class="col-12 mb-3">
                                            <label for="<?= htmlspecialchars($field['id']) ?>" class="form-label"><?= $labelPrefix . $label ?></label>
                                            <input <?= $length ?> type="text" name="<?= htmlspecialchars($field['id']) ?>" id="<?= htmlspecialchars($field['id']) ?>" class="form-control" maxlength="60" <?= $field['optional'] ? '' : 'required' ?>>
                                        </div>
                                    <?php } else if ($field['type'] == 'image') { ?>
                                        <div class="col-12 mb-3 text-center">
                                            <label for="<?= htmlspecialchars($field['id']) ?>" class="form-label d-block"><?= $label ?></label>
                                            <div class="img-preview-container mb-2">
                                                <img class="img-preview img-thumbnail" src="../../assets/img/placeholder-funcionario.png" style="width: 100px; height: 100px; object-fit: cover;" alt="">
                                            </div>
                                            <input class="form-control img-input" type="file" name="<?= htmlspecialchars($field['id']) ?>" id="<?= htmlspecialchars($field['id']) ?>" accept="image/png, image/jpeg">
                                        </div>
                                    <?php } else if ($field['type'] == 'select') { ?>
                                        <div class="form-group mb-3">
                                            <label for="<?= htmlspecialchars($field['id']) ?>"><?= $labelPrefix . $label ?></label>
                                            <select name="<?= htmlspecialchars($field['id']) ?>" id="<?= htmlspecialchars($field['id']) ?>" class="form-control">
                                                <?php
                                                foreach ($field['options'] as $option) {
                                                ?>

                                                    <option value="<?= htmlspecialchars($option['value']) ?>"><?= htmlspecialchars($option['label']) ?></option>
                                                <?php
                                                }
                                                ?>
                                            </select>
                                        </div>
                                    <?php } ?>
                                <?php } ?>
                            </div>

                            <div class="d-grid gap-2">
                                <input name="id" id="id" type="text" hidden>
                                <input type="hidden" name="csfc" value="<?= htmlspecialchars(random_int(10000000, 99999999999)) ?>">
                                <?= $settings["submitButton"] ?>
                                <button type="button" class="btn btn-light w-100" data-bs-dismiss="modal">Cancelar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
<?php
        return ob_get_clean();
    }
}

--- END_FILE: ..\Components\FormModal.php ---
------------------------------

--- START_FILE: ..\Components\Header.php ---
<?php
function HeaderComponent(string $pageName)
{
    ob_start();
?>
    <div id="header-sentinel" style="position: absolute; height: 20px; width: 20px; z-index: 10000;"></div>
    <header id="main-header" class="scrolled"> <nav class="navbar navbar-expand-lg h-100">
            <div class="container h-100">
                <a class="navbar-brand" href="/index.php">
                    <img src="./assets/img/logotipo-empresa.png" width="auto" height="25" class="d-inline-block align-top my-auto" alt="">
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0 mx-auto">
                        <li class="nav-item">
                            <a class="nav-link <?= $pageName == 'index' ? 'active' : '' ?>" href="/index.php">Veículos</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link <?= $pageName == 'about' ? 'active' : '' ?>" href="/about.php">Sobre nós</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link <?= $pageName == 'contact' ? 'active' : '' ?>" href="/contact.php">Contato</a>
                        </li>
                    </ul>

                    <div class="auth-content d-flex flex-column flex-lg-row gap-2">
                        <a href="/Login.php" class="btn btn-login">Login</a>
                        <a href="/Register.php" class="btn btn-register">Registrar</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>
<?php
    return ob_get_clean();
}
?>
--- END_FILE: ..\Components\Header.php ---
------------------------------

--- START_FILE: ..\Components\Sidebar.php ---
<?php
function Sidebar(string $pageName)
{
  ob_start();
?>
  <aside class="col-lg-2 py-3 px-2 sidebar d-none d-lg-flex">
    <div class="sidebar-logo d-flex align-items-center justify-content-center gap-2">
      <span>CarrosFácil - Sistema</span>
    </div>

    <hr class="my-3">

    <nav class="d-flex flex-column gap-1 px-3">
      <a href="http://localhost:3000/admin/dashboard.php" class="nav-custom-link <?= $pageName == "dashboard" ? "active" : "" ?>">
        <i class="bi bi-speedometer2"></i>
        <span>Dashboard</span>
      </a>

      <a href="http://localhost:3000/admin/vendas/Index.php" class="nav-custom-link <?= $pageName == "sell" ? "active" : "" ?>">
        <i class="bi bi-cart-plus"></i>
        <span>Nova venda</span>
      </a>

      <div class="dropdown-container">
        <button class="dropdown-expand-button nav-custom-link justify-content-between">
          <div class="d-flex align-items-center gap-3">
            <i class="bi bi-briefcase"></i>
            <span>Gestão</span>
          </div>
          <i class="bi bi-chevron-down dropdown-arrow"></i>
        </button>

        <div class="dropdown-content-custom">
          <a href="http://localhost:3000/admin/funcionarios/index.php" class="submenu-link <?= $pageName == "employee" ? "active" : "" ?>">Funcionários</a>
          <a href="http://localhost:3000/admin/clientes/index.php" class="submenu-link <?= $pageName == "customer" ? "active" : "" ?>">Clientes</a>
          <a href="http://localhost:3000/admin/veiculos/index.php" class="submenu-link <?= $pageName == "vehicle" ? "active" : "" ?>">Veículos</a>
          <a href="http://localhost:3000/admin/modelos/index.php" class="submenu-link <?= $pageName == "model" ? "active" : "" ?>">Modelos</a>
          <a href="http://localhost:3000/admin/marcas/index.php" class="submenu-link <?= $pageName == "brand" ? "active" : "" ?>">Marcas</a>
          <a href="http://localhost:3000/admin/cargos/index.php" class="submenu-link <?= $pageName == "role" ? "active" : "" ?>">Cargos</a>
          <a href="http://localhost:3000/admin/vitems/index.php" class="submenu-link <?= $pageName == "items" ? "active" : "" ?>">Características</a>
        </div>
      </div>
    </nav>

    <div class="sidebar-footer">
      <div class="avatar-circle">PH</div>
      <div class="user-info">
        <p class="user-name">Pedro Henrique</p>
        <a href="#" class="logout-link">Sair do sistema</a>
      </div>
    </div>
  </aside>
<?php
  return ob_get_clean();
}
?>
--- END_FILE: ..\Components\Sidebar.php ---
------------------------------

--- START_FILE: ..\Components\Table.php ---
<?php
class Table
{
    public static function render(array $columns, $query, array $config)
    {
        // $columns: ['Título da Coluna' => 'nome_no_banco']
        // $config: ['entity' => 'vendas', 'modalTarget' => '#vendasModal']

        if (mysqli_num_rows($query) > 0) {
            ob_start(); ?>
            <div class="card-body p-0">
                <table class="table table-hover m-0">
                    <thead>
                        <tr>
                            <?php foreach (array_keys($columns) as $label): ?>
                                <th><?= $label ?></th>
                            <?php endforeach; ?>
                            <th class="text-end">Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php foreach ($query as $row): ?>
                            <tr>
                                <?php foreach ($columns as $label => $field): ?>
                                    <td>
                                        <?php
                                        // Lógica especial para tipos específicos
                                        if ($field == 'icon') {
                                            echo '<img class="table-icon" src="../../images/' . $row['icon'] . '" style="width:30px">';
                                        } elseif ($field == 'status') {
                                            echo $row['status'] == 1
                                                ? '<span class="badge text-bg-success">Ativo</span>'
                                                : '<span class="badge text-bg-danger">Inativo</span>';
                                        } else {
                                            echo htmlspecialchars($row[$field]);
                                        }
                                        ?>
                                    </td>
                                <?php endforeach; ?>
                                <td class="text-end">
                                    <?php
                                    if (isset($config['modalTarget'])) {
                                    ?>
                                        <button type="button" class="btn btn-outline-success btn-sm open-edit-modal"
                                            data-bs-toggle="modal" data-bs-target="<?= $config['modalTarget'] ?>"
                                            data-entity="<?= $config['entity'] ?>"
                                            <?php foreach ($row as $k => $v) {
                                                echo 'data-' . $k . '="' . htmlspecialchars($v) . '" ';
                                            } ?>>
                                            <i class="bi bi-pencil-square"></i>
                                        </button>
                                    <?php
                                    } else {
                                    ?>
                                        <a href="<?php echo $config['editUrl'].$row['id'] ?>" class="btn btn-outline-success btn-sm" title="Editar">
                                            <i class="bi bi-pencil-square"></i>
                                        </a>
                                    <?php

                                    }
                                    ?>
                                    <form action="actions.php" method="post" class="d-inline">
                                        <button type="submit" class="btn btn-outline-danger btn-sm" name="delete" value="<?= $row['id'] ?>" onclick="return confirm('Excluir?')">
                                            <i class="bi bi-trash3"></i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
            </div>
<?php return ob_get_clean();
        }
        return '<div class="alert alert-info m-3">Nenhum registro encontrado.</div>';
    }
}

--- END_FILE: ..\Components\Table.php ---
------------------------------

--- START_FILE: ..\conexao\conecta.php ---
<?php 
    $servidor = 'localhost';
    $usuario = 'root';
    $senha = '';
    $banco = 'carrosfacil_ti50';

    $connection = mysqli_connect($servidor, $usuario, $senha, $banco);
    
    if (mysqli_connect_errno()) {
        die("Failed to connect in mysql: " . mysqli_connect_error());
    }
    
?>
--- END_FILE: ..\conexao\conecta.php ---
------------------------------

--- START_FILE: ..\custom\css\index.css ---
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
}

input, select, textarea {
    font-family: inherit;
    color: #414141;
}

#sect-search-car {
    background-color: #2563EB;
    background-size: cover;
    background-position: center;
    text-align: center;
    padding: 2% 1%;
    min-height: 300px;
    display: flex;
    align-items: center;
}

#sect-search-car h1 {
    font-family: "Kanit", sans-serif;
    font-size: 48px;
    font-weight: 600;
    color: #FFFFFF;
    margin: 0;
}

#sect-search-car p {
    font-size: 20px;
    color: #ebeaea;
    margin: 0 0 20px 0;
}

#form-search-car {
    background-color: #FFFFFF;
    border-radius: 10px;
    max-width: 800px;
    margin: 0 auto;
    padding: 8px;
    display: flex;
    gap: 10px;
}

#form-search-car input {
    border-radius: 6px;
    border: 2px solid #626262;
    height: 50px;
    flex-grow: 1;
    padding: 10px;
    font-size: 18px;
}

#form-search-car button {
    border-radius: 6px;
    color: #FFFFFF;
    background-color: #000000;
    border: none;
    width: 150px;
    height: 50px;
    font-size: 20px;
    cursor: pointer;
}

#sect-vehicles {
    padding: 2%;
}

aside .card {
    border-radius: 12px;
}

aside .form-label {
    color: #4b5563;
    font-weight: 500;
    margin-bottom: 0.4rem;
}

aside .form-select, 
aside .form-control {
    border-color: #e5e7eb;
    padding: 0.5rem 0.75rem;
    font-size: 0.9rem;
    border-radius: 6px;
}

aside .form-select:focus, 
aside .form-control:focus {
    border-color: #2563eb;
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.form-range::-webkit-slider-thumb { background: #2563eb; }
.form-range::-moz-range-thumb { background: #2563eb; }

#sect-vehicles-list {
    transition: opacity 0.2s ease-in-out;
}

.vehicle-card-modern {
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border-radius: 16px;
    overflow: hidden;
    background-color: #fff;
}

.vehicle-card-modern:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.12) !important;
}

.vehicle-image-container {
    width: 100%;
    aspect-ratio: 16 / 9;
    overflow: hidden;
    background-color: #f8f9fa;
    position: relative;
}

.vehicle-image-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
}

.vehicle-card-modern:hover .vehicle-image-container img {
    transform: scale(1.1);
}

.vehicle-image-container::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 40%;
    background: linear-gradient(to bottom, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0) 100%);
    pointer-events: none;
}

.vehicle-card-modern .badge {
    font-size: 0.75rem;
    padding: 0.5em 1em;
    border-radius: 6px;
    font-weight: 600;
}

.tracking-wider { letter-spacing: 0.05em; }
.rounded-pill { border-radius: 50px !important; }

#sect-data {
    background-color: #2563EB;
    padding: 40px;
    text-align: center;
    color: #fff;
}

#sect-data .data-item i {
    display: block;
    font-size: 40px;
    margin-bottom: 10px;
}

#sect-data .data-item span {
    display: block;
    font-weight: 300;
}

@media (max-width: 767.98px) {
    #sect-search-car h1 { font-size: 32px; }
    
    #form-search-car {
        flex-direction: column;
        background: transparent;
        padding: 0;
    }
    
    #form-search-car input, 
    #form-search-car button {
        width: 100%;
    }

    .border-start, .border-end { border: none !important; }
    
    #sect-data .col-md-4 {
        border-bottom: 1px solid rgba(255,255,255,0.2);
        padding-bottom: 20px;
        margin-bottom: 20px;
    }
    
    #sect-data .col-md-4:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }

    .vehicle-card-modern {
        width: 100% !important;
        margin: 0;
    }
}
--- END_FILE: ..\custom\css\index.css ---
------------------------------

--- START_FILE: ..\custom\css\insert-vehicle.css ---
.features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 10px;
}

.feature-item {
    border: 1px solid #dee2e6;
    border-radius: 12px;
    padding: 10px;
    text-align: center;
    position: relative;
    cursor: pointer;
    transition: all 0.2s ease;
    background: #f8f9fa;
}

.feature-item:hover {
    background: #e9ecef;
}

.feature-item.active {
    background: #d1e7dd;
    border-color: #0f5132;
}

.feature-item .feature-icon {
    display: block;
    font-size: 1.5rem;
    margin-bottom: 5px;
}

.remove-feature {
    position: absolute;
    top: 8px;
    right: 8px;
    font-size: 1rem;
    color: #dc3545;
    display: none;
    cursor: pointer;
}

.feature-item.active .remove-feature {
    display: inline;
}
--- END_FILE: ..\custom\css\insert-vehicle.css ---
------------------------------

--- START_FILE: ..\custom\css\style.css ---
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* SOME COLORS */
.text-c1 {
    color: rgb(51 65 85);
}


/* MAIN HEADER */
a:visited, a:link{
    text-decoration: none;
}

#main-header {
    height: 62px;

    position: sticky;
    top: 0;
    width: 100%;

    background-color: rgb(248, 249, 250);

    z-index: 999;
}

#main-header.scrolled {
    box-shadow: 0 0 10px 2px #a0a0a0;
}

.btn-login {
    color: #fff;
    background-color: #2563EB;
    border: 2px solid #2563EB;
}

.btn-register {
    color: #000;
    border: 2px solid #2563EB;
}

.btn-register:hover,
.btn-login:hover,
.nav-link:hover
{
    background-color: #8584845f;
    border-radius: 6px;
}

textarea {
    resize: none;
}

#foto-img {
    max-width: 360px;
    width: 100%;
    height: auto;
}

.icone-preview,
.table-icon {
    width: 100%;
    max-width: 128px;
    height: auto;

    border-radius: 6px;
}

.table-icon {
    max-width: 32px;
}

.form-fs .title {
    font-size: 18px;
    font-weight: bold;
}

.fs-container label {
    font-size: 16px;
}

.image-preview {
    border: 1px dashed rgb(200, 200, 200);
}

.image-preview-empty i {
    font-size: 48px;
}

.image-preview-empty h3 {
    font-size: 22px;
}

.image-preview-empty p {
    font-size: 16px;
}

.error-input {
    border-color: red !important;
    box-shadow: 0 0 0 0.2rem rgba(253, 13, 13, 0.25) !important;
}

/* INDEX */
.image-wrapper {
    width: 100%;
    height: 200px;
    background-color: #f0f0f0;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    border-radius: 8px 8px 0 0;
}

.image-wrapper img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* ADMIN HEADER */
#admin-header #left-info {
    font-weight: 700;
}

/* SIDEBAR */
.sidebar {
    background-color: rgb(30, 58, 138);

    min-height: 100vh;
    
    color: white;
    padding: 1.5rem;
    
    display: flex;
    flex-direction: column;
}


.sidebar-logo {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;

    text-transform: uppercase;
    font-weight: 700;
}


.logo-icon {
    background: white;
    color: rgb(30, 58, 138);
    
    padding: 5px 8px;
    
    border-radius: 6px;
}


.sidebar-divider {
    border-top: 1px solid rgb(200, 200, 200);
    margin: 15px 0;
}


.nav-custom-link {
    display: flex;
    align-items: center;
    
    gap: 12px;
    padding: 8px;
    
    color: #bfdbfe;

    text-decoration: none;
    text-align: left;
    
    font-size: 20px;
    font-weight: 500;
    border-radius: 6px;
    
    transition: all 0.3s;
    
    border: none;
    
    background: transparent;
    
    width: 100%;
}


.nav-custom-link span {
    font-size: 14px;
}


.nav-custom-link:hover, 
.nav-custom-link.active,
.submenu-link:hover, 
.submenu-link.active {
    background-color: rgba(255, 255, 255, 0.1);
    color: white;

    border-radius: 6;
}



/* SIDEBAR (DROPDOWN) */
.dropdown-content-custom {
    max-height: 0;

    overflow: hidden;

    transition: max-height 0.3s ease-out;
    
    margin-left: 20px;

    display: flex;
    flex-direction: column;
    gap: 4px;
}


.dropdown-active .dropdown-content-custom {
    max-height: 300px;
    margin-top: 5px;
}


.dropdown-arrow {
    display: inline-block;

    transition: transform 200ms ease-in-out;
    
    font-size: 12px;
}


.rotate-180 {
    transform: rotate(180deg);
}


.submenu-link {
    font-size: 0.85rem;
    padding: 8px;

    color: #dbeafe;

    text-decoration: none;

    display: flex;
    align-items: center;
    gap: 8px;

    transition: 0.2s;
}


.submenu-link:hover {
    color: white;
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: 6px;
}


.dot {
    width: 4px;
    height: 4px;

    background-color: rgb(99, 207, 250);

    border-radius: 50%;
}


/* SIDEBAR FOOTER */
.sidebar-footer {
    margin-top: auto;
    padding-top: 1.5rem;

    border-top: 1px solid rgba(255, 255, 255, 0.1);
    
    display: flex;
    align-items: center;
    gap: 12px;
}


.avatar-circle {
    width: 40px;
    height: 40px;

    background: rgb(37, 99, 235);

    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;

    display: flex;
    align-items: center;
    justify-content: center;
    
    font-weight: bold;
    font-size: 0.8rem;
}


.user-name {
    margin: 0;
    font-size: 0.75rem; 
    font-weight: 700;
}


.logout-link {
    font-size: 10px; 
    color: rgb(99, 207, 250);
    opacity: 0.7; 
    font-style: italic;
    text-decoration: none;
}

/* PRODUCT */
.white-bg {
    box-shadow: 0 0 10px 2px #bebebe;
    border-radius: 6px;
}

#product-info {
    box-shadow: 0 0 10px 5px #bebebe;
    border-radius: 6px;
}

#product-info {
    padding: 25px;
}

#product-info #brand {
    color: rgba(30, 58, 138, 1);

    background-color: rgba(107, 150, 209, 0.3);

    padding: 5px 10px;
    font-weight: 600;
    font-size: 14px;

    border-radius: 40px;
}

#product-info #model-name {
    font-size: 28px;
    margin-top: 5px;
}

#product-info #model-info {
    margin-bottom: 20px;
}

#product-info #price #real-price {
    font-size: 18px;
    font-weight: 500;

    color: rgb(148, 163, 184);
    text-decoration: line-through;
}

#product-info #price #current-price {
    font-size: 28px;
    color: rgb(49, 202, 54);
    font-weight: 700;
}

#product-info #price #extra-payments-info {
    font-size: 12px;
    font-weight: 600;

    color: rgb(83, 91, 100);

    margin-bottom: 20px;
}

#product-info .contact i {
    font-size: 24px;
    margin-right: 13px;
}

#product-info .contact a {
    text-decoration: none;
}

#product-info .contact #talk-consultant {
    background-color: rgb(30, 58, 138);

    padding: 10px;
    border-radius: 6px;

    color: #fff;
    font-weight: 700;
    font-size: 16px;
}

#product-info .contact #talk-consultant i {
    color: rgb(0, 255, 8);
}

#product-info .contact #test-drive {
    padding: 10px;
    border-radius: 6px;

    color: rgb(71, 85, 105);
    font-weight: 500;
    font-size: 14px;

    border: 2px solid rgb(30, 58, 138);
}

#pictures .picture {
    width: 96px;
    height: 64px;
}

#galery #main-image {
    border-radius: 6px 6px 0px 0px;
    box-shadow: 0 -5px 10px 3px #bebebe;
}

#pictures {
    padding: 10px;

    box-shadow: 0 2px 10px 3px #bebebe;
    border-radius: 0px 0px 6px 6px;
}

#pictures li {
    display: inline;
    margin: 0 5px;
}

#pictures .picture {
    border: none;
    opacity: 0.6;
}

#pictures .active {
    border: 2px solid rgb(30, 58, 138);
    border-radius: 8px;

    opacity: 1;
}

#pictures .picture img {
    object-fit: cover;
    border-radius: 6px;
}

.basic-info-card {
    width: 48%;
}

.basic-info-card i {
    font-size: 24px;
    color: rgb(30, 58, 138);
}

.basic-info-card .info-name {
    color: rgb(148, 163, 184);

    font-size: 12px;
    font-weight: 700;

    text-transform: uppercase;
}

.basic-info-card .value {
    color: rgb(30, 41, 59);
    font-weight: 700;

    font-size: 14px;
}

.info-card-title {
    font-size: 20px;
    font-weight: 700;

    margin-bottom: 15px;
}

.info-card-title span {
    display: inline-block;
    
    width: 4px;
    height: 24px; /* title size + 4px */

    background-color: rgb(30, 58, 138);
    border-radius: 26px;
    flex-shrink: 0;
}


#vehicle-items-list li .content {
    background-color: rgba(99, 207, 250, 0.4);

    padding: 10px;
    border-radius: 6px;
}

#vehicle-items-list .item-icon {
    width: 32px;
    height: 32px;
}

/* LOGIN FORM */
.show-password {
    position: absolute;
    right: 0;

    height: 100%;
    width: auto;
    aspect-ratio: 1;

    background: none;
    border: none;
    
    color: rgb(148, 163, 184);
    z-index: 10;

    font-size: 20px;
}

.show-password:hover {
    color: #5e5d5d;
}

.input-password {
    padding-right: 35px;
}

#auth-form label {
    font-size: 14px;
}

#auth-form a, #no-account-warn a {
    color: rgb(30, 58, 138);
    font-weight: 500;
}

#auth-form .form-control {
    background-color: rgb(240, 240, 240);
    border: 1px solid rgb(220, 220, 220);

    font-size: 14px;
}

#auth-form input::placeholder {
    color: rgb(139, 151, 167);
}

#auth-form .form-control:focus {
    box-shadow: 0 0 0 .25rem rgba(37, 99, 235, 0.15);
    border-color: rgb(37, 99, 235);
}

.input-group input {
    padding: 12px;
    border-radius: 6px;
}

.input-group:has(.input-icon) > .form-control {
    padding-left: 45px !important;
}

.input-group .input-icon {
    position: absolute;
    left: 10px;

    height: 100%;

    display: flex;
    justify-content: center;
    align-items: center;

    z-index: 10;

    color: rgb(148, 163, 184);
}

.input-group .input-icon i {
    font-size: 24px;
}

#auth-form #auth-button {
    width: 100%;

    background-color: rgb(30, 58, 138);
    color: #fff;

    border: none;
    border-radius: 6px;
    padding: 12px;

    font-weight: 700;
    font-size: 16px;
}

.auth-header p {
    font-weight: 500;
    color: rgb(100, 116, 139);
}

#accept-info {
    font-size: 14px;
}

#accept-info input {
    width: 20px;
    height: 20px;
}

/* FOOTER */
.footer {
    background-color: #111826;
    text-align: center;

    color: #fff;

    padding: 40px 0;
}

/* Extra small devices (phones, 600px and down) */
@media only screen and (max-width: 600px) {
    
}

/* Small devices (portrait tablets and large phones, 600px and up) */
@media only screen and (min-width: 600px) {}

/* 990px é o máximo que o bootstrap aparece o "=", por isso é esse número */
@media only screen and (max-width: 991px){
    /* Quando o menu expande, forçamos um fundo sólido */
    .navbar-collapse {
        background-color: #ffffff !important; /* Ou a cor do seu site */
        padding: 1rem;
        border-radius: 10px;
        margin-top: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        z-index: 999;
    }

    /* Garante que os textos dos links fiquem visíveis sobre o fundo branco */
    .navbar-nav .nav-link {
        color: #333 !important;
        text-align: center;
        padding: 10px 0;
    }
    
    /* Ajuste para os botões não ficarem colados no mobile */
    .auth-content {
        padding-top: 10px;
        border-top: 1px solid #eee;
        margin-top: 10px;
    }
}

/* Medium devices (landscape tablets, 768px and up) */
@media only screen and (min-width: 768px) {
    .basic-info-card {
        width: 23%;
    }
}

/* Large devices (laptops/desktops, 992px and up) */
@media only screen and (min-width: 992px) {}

/* Extra large devices (large laptops and desktops, 1200px and up) */
@media only screen and (min-width: 1200px) {}
--- END_FILE: ..\custom\css\style.css ---
------------------------------

--- START_FILE: ..\assets\css\dashboard.css ---
body {
  font-size: .875rem;
}

.feather {
  width: 16px;
  height: 16px;
  vertical-align: text-bottom;
}

/*
 * Sidebar
 */

.sidebar {
  position: fixed;
  top: 0;
  /* rtl:raw:
  right: 0;
  */
  bottom: 0;
  /* rtl:remove */
  left: 0;
  z-index: 100; /* Behind the navbar */
  padding: 48px 0 0; /* Height of navbar */
  box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
}

@media (max-width: 767.98px) {
  .sidebar {
    top: 5rem;
  }
}

.sidebar-sticky {
  position: relative;
  top: 0;
  height: calc(100vh - 48px);
  padding-top: .5rem;
  overflow-x: hidden;
  overflow-y: auto; /* Scrollable contents if viewport is shorter than content. */
}

.sidebar .nav-link {
  font-weight: 500;
  color: #333;
}

.sidebar .nav-link .feather {
  margin-right: 4px;
  color: #727272;
}

.sidebar .nav-link.active {
  color: #2470dc;
}

.sidebar .nav-link:hover .feather,
.sidebar .nav-link.active .feather {
  color: inherit;
}

.sidebar-heading {
  font-size: .75rem;
  text-transform: uppercase;
}

/*
 * Navbar
 */

.navbar-brand {
  padding-top: .75rem;
  padding-bottom: .75rem;
  font-size: 1rem;
  background-color: rgba(0, 0, 0, .25);
  box-shadow: inset -1px 0 0 rgba(0, 0, 0, .25);
}

.navbar .navbar-toggler {
  top: .25rem;
  right: 1rem;
}

.navbar .form-control {
  padding: .75rem 1rem;
  border-width: 0;
  border-radius: 0;
}

.form-control-dark {
  color: #fff;
  background-color: rgba(255, 255, 255, .1);
  border-color: rgba(255, 255, 255, .1);
}

.form-control-dark:focus {
  border-color: transparent;
  box-shadow: 0 0 0 3px rgba(255, 255, 255, .25);
}

--- END_FILE: ..\assets\css\dashboard.css ---
------------------------------

--- START_FILE: ..\assets\css\sidebar.css ---
#sbmenu {
    background-color: green;
}

#sb-links-list {
    display: inline;
}
--- END_FILE: ..\assets\css\sidebar.css ---
------------------------------

--- START_FILE: ..\assets\css\signin.css ---
html,
body {
  height: 100%;
}

body {
  display: flex;
  align-items: center;
  padding-top: 40px;
  padding-bottom: 40px;
  background-color: #f5f5f5;
}

.form-signin {
  width: 100%;
  max-width: 330px;
  padding: 15px;
  margin: auto;
}

.form-signin .checkbox {
  font-weight: 400;
}

.form-signin .form-floating:focus-within {
  z-index: 2;
}

.form-signin input[type="email"] {
  margin-bottom: -1px;
  border-bottom-right-radius: 0;
  border-bottom-left-radius: 0;
}

.form-signin input[type="password"] {
  margin-bottom: 10px;
  border-top-left-radius: 0;
  border-top-right-radius: 0;
}

--- END_FILE: ..\assets\css\signin.css ---
------------------------------

--- START_FILE: ..\assets\js\jquery.mask.js ---
/**
 * jquery.mask.js
 * @version: v1.14.16
 * @author: Igor Escobar
 *
 * Created by Igor Escobar on 2012-03-10. Please report any bug at github.com/igorescobar/jQuery-Mask-Plugin
 *
 * Copyright (c) 2012 Igor Escobar http://igorescobar.com
 *
 * The MIT License (http://www.opensource.org/licenses/mit-license.php)
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 */

/* jshint laxbreak: true */
/* jshint maxcomplexity:17 */
/* global define */

// UMD (Universal Module Definition) patterns for JavaScript modules that work everywhere.
// https://github.com/umdjs/umd/blob/master/templates/jqueryPlugin.js
(function (factory, jQuery, Zepto) {

    if (typeof define === 'function' && define.amd) {
        define(['jquery'], factory);
    } else if (typeof exports === 'object' && typeof Meteor === 'undefined') {
        module.exports = factory(require('jquery'));
    } else {
        factory(jQuery || Zepto);
    }

}(function ($) {
    'use strict';

    var Mask = function (el, mask, options) {

        var p = {
            invalid: [],
            getCaret: function () {
                try {
                    var sel,
                        pos = 0,
                        ctrl = el.get(0),
                        dSel = document.selection,
                        cSelStart = ctrl.selectionStart;

                    // IE Support
                    if (dSel && navigator.appVersion.indexOf('MSIE 10') === -1) {
                        sel = dSel.createRange();
                        sel.moveStart('character', -p.val().length);
                        pos = sel.text.length;
                    }
                    // Firefox support
                    else if (cSelStart || cSelStart === '0') {
                        pos = cSelStart;
                    }

                    return pos;
                } catch (e) {}
            },
            setCaret: function(pos) {
                try {
                    if (el.is(':focus')) {
                        var range, ctrl = el.get(0);

                        // Firefox, WebKit, etc..
                        if (ctrl.setSelectionRange) {
                            ctrl.setSelectionRange(pos, pos);
                        } else { // IE
                            range = ctrl.createTextRange();
                            range.collapse(true);
                            range.moveEnd('character', pos);
                            range.moveStart('character', pos);
                            range.select();
                        }
                    }
                } catch (e) {}
            },
            events: function() {
                el
                .on('keydown.mask', function(e) {
                    el.data('mask-keycode', e.keyCode || e.which);
                    el.data('mask-previus-value', el.val());
                    el.data('mask-previus-caret-pos', p.getCaret());
                    p.maskDigitPosMapOld = p.maskDigitPosMap;
                })
                .on($.jMaskGlobals.useInput ? 'input.mask' : 'keyup.mask', p.behaviour)
                .on('paste.mask drop.mask', function() {
                    setTimeout(function() {
                        el.keydown().keyup();
                    }, 100);
                })
                .on('change.mask', function(){
                    el.data('changed', true);
                })
                .on('blur.mask', function(){
                    if (oldValue !== p.val() && !el.data('changed')) {
                        el.trigger('change');
                    }
                    el.data('changed', false);
                })
                // it's very important that this callback remains in this position
                // otherwhise oldValue it's going to work buggy
                .on('blur.mask', function() {
                    oldValue = p.val();
                })
                // select all text on focus
                .on('focus.mask', function (e) {
                    if (options.selectOnFocus === true) {
                        $(e.target).select();
                    }
                })
                // clear the value if it not complete the mask
                .on('focusout.mask', function() {
                    if (options.clearIfNotMatch && !regexMask.test(p.val())) {
                       p.val('');
                   }
                });
            },
            getRegexMask: function() {
                var maskChunks = [], translation, pattern, optional, recursive, oRecursive, r;

                for (var i = 0; i < mask.length; i++) {
                    translation = jMask.translation[mask.charAt(i)];

                    if (translation) {

                        pattern = translation.pattern.toString().replace(/.{1}$|^.{1}/g, '');
                        optional = translation.optional;
                        recursive = translation.recursive;

                        if (recursive) {
                            maskChunks.push(mask.charAt(i));
                            oRecursive = {digit: mask.charAt(i), pattern: pattern};
                        } else {
                            maskChunks.push(!optional && !recursive ? pattern : (pattern + '?'));
                        }

                    } else {
                        maskChunks.push(mask.charAt(i).replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'));
                    }
                }

                r = maskChunks.join('');

                if (oRecursive) {
                    r = r.replace(new RegExp('(' + oRecursive.digit + '(.*' + oRecursive.digit + ')?)'), '($1)?')
                         .replace(new RegExp(oRecursive.digit, 'g'), oRecursive.pattern);
                }

                return new RegExp(r);
            },
            destroyEvents: function() {
                el.off(['input', 'keydown', 'keyup', 'paste', 'drop', 'blur', 'focusout', ''].join('.mask '));
            },
            val: function(v) {
                var isInput = el.is('input'),
                    method = isInput ? 'val' : 'text',
                    r;

                if (arguments.length > 0) {
                    if (el[method]() !== v) {
                        el[method](v);
                    }
                    r = el;
                } else {
                    r = el[method]();
                }

                return r;
            },
            calculateCaretPosition: function(oldVal) {
                var newVal = p.getMasked(),
                    caretPosNew = p.getCaret();
                if (oldVal !== newVal) {
                    var caretPosOld = el.data('mask-previus-caret-pos') || 0,
                        newValL = newVal.length,
                        oldValL = oldVal.length,
                        maskDigitsBeforeCaret = 0,
                        maskDigitsAfterCaret = 0,
                        maskDigitsBeforeCaretAll = 0,
                        maskDigitsBeforeCaretAllOld = 0,
                        i = 0;

                    for (i = caretPosNew; i < newValL; i++) {
                        if (!p.maskDigitPosMap[i]) {
                            break;
                        }
                        maskDigitsAfterCaret++;
                    }

                    for (i = caretPosNew - 1; i >= 0; i--) {
                        if (!p.maskDigitPosMap[i]) {
                            break;
                        }
                        maskDigitsBeforeCaret++;
                    }

                    for (i = caretPosNew - 1; i >= 0; i--) {
                        if (p.maskDigitPosMap[i]) {
                            maskDigitsBeforeCaretAll++;
                        }
                    }

                    for (i = caretPosOld - 1; i >= 0; i--) {
                        if (p.maskDigitPosMapOld[i]) {
                            maskDigitsBeforeCaretAllOld++;
                        }
                    }

                    // if the cursor is at the end keep it there
                    if (caretPosNew > oldValL) {
                      caretPosNew = newValL * 10;
                    } else if (caretPosOld >= caretPosNew && caretPosOld !== oldValL) {
                        if (!p.maskDigitPosMapOld[caretPosNew])  {
                          var caretPos = caretPosNew;
                          caretPosNew -= maskDigitsBeforeCaretAllOld - maskDigitsBeforeCaretAll;
                          caretPosNew -= maskDigitsBeforeCaret;
                          if (p.maskDigitPosMap[caretPosNew])  {
                            caretPosNew = caretPos;
                          }
                        }
                    }
                    else if (caretPosNew > caretPosOld) {
                        caretPosNew += maskDigitsBeforeCaretAll - maskDigitsBeforeCaretAllOld;
                        caretPosNew += maskDigitsAfterCaret;
                    }
                }
                return caretPosNew;
            },
            behaviour: function(e) {
                e = e || window.event;
                p.invalid = [];

                var keyCode = el.data('mask-keycode');

                if ($.inArray(keyCode, jMask.byPassKeys) === -1) {
                    var newVal = p.getMasked(),
                        caretPos = p.getCaret(),
                        oldVal = el.data('mask-previus-value') || '';

                    // this is a compensation to devices/browsers that don't compensate
                    // caret positioning the right way
                    setTimeout(function() {
                      p.setCaret(p.calculateCaretPosition(oldVal));
                    }, $.jMaskGlobals.keyStrokeCompensation);

                    p.val(newVal);
                    p.setCaret(caretPos);
                    return p.callbacks(e);
                }
            },
            getMasked: function(skipMaskChars, val) {
                var buf = [],
                    value = val === undefined ? p.val() : val + '',
                    m = 0, maskLen = mask.length,
                    v = 0, valLen = value.length,
                    offset = 1, addMethod = 'push',
                    resetPos = -1,
                    maskDigitCount = 0,
                    maskDigitPosArr = [],
                    lastMaskChar,
                    check;

                if (options.reverse) {
                    addMethod = 'unshift';
                    offset = -1;
                    lastMaskChar = 0;
                    m = maskLen - 1;
                    v = valLen - 1;
                    check = function () {
                        return m > -1 && v > -1;
                    };
                } else {
                    lastMaskChar = maskLen - 1;
                    check = function () {
                        return m < maskLen && v < valLen;
                    };
                }

                var lastUntranslatedMaskChar;
                while (check()) {
                    var maskDigit = mask.charAt(m),
                        valDigit = value.charAt(v),
                        translation = jMask.translation[maskDigit];

                    if (translation) {
                        if (valDigit.match(translation.pattern)) {
                            buf[addMethod](valDigit);
                             if (translation.recursive) {
                                if (resetPos === -1) {
                                    resetPos = m;
                                } else if (m === lastMaskChar && m !== resetPos) {
                                    m = resetPos - offset;
                                }

                                if (lastMaskChar === resetPos) {
                                    m -= offset;
                                }
                            }
                            m += offset;
                        } else if (valDigit === lastUntranslatedMaskChar) {
                            // matched the last untranslated (raw) mask character that we encountered
                            // likely an insert offset the mask character from the last entry; fall
                            // through and only increment v
                            maskDigitCount--;
                            lastUntranslatedMaskChar = undefined;
                        } else if (translation.optional) {
                            m += offset;
                            v -= offset;
                        } else if (translation.fallback) {
                            buf[addMethod](translation.fallback);
                            m += offset;
                            v -= offset;
                        } else {
                          p.invalid.push({p: v, v: valDigit, e: translation.pattern});
                        }
                        v += offset;
                    } else {
                        if (!skipMaskChars) {
                            buf[addMethod](maskDigit);
                        }

                        if (valDigit === maskDigit) {
                            maskDigitPosArr.push(v);
                            v += offset;
                        } else {
                            lastUntranslatedMaskChar = maskDigit;
                            maskDigitPosArr.push(v + maskDigitCount);
                            maskDigitCount++;
                        }

                        m += offset;
                    }
                }

                var lastMaskCharDigit = mask.charAt(lastMaskChar);
                if (maskLen === valLen + 1 && !jMask.translation[lastMaskCharDigit]) {
                    buf.push(lastMaskCharDigit);
                }

                var newVal = buf.join('');
                p.mapMaskdigitPositions(newVal, maskDigitPosArr, valLen);
                return newVal;
            },
            mapMaskdigitPositions: function(newVal, maskDigitPosArr, valLen) {
              var maskDiff = options.reverse ? newVal.length - valLen : 0;
              p.maskDigitPosMap = {};
              for (var i = 0; i < maskDigitPosArr.length; i++) {
                p.maskDigitPosMap[maskDigitPosArr[i] + maskDiff] = 1;
              }
            },
            callbacks: function (e) {
                var val = p.val(),
                    changed = val !== oldValue,
                    defaultArgs = [val, e, el, options],
                    callback = function(name, criteria, args) {
                        if (typeof options[name] === 'function' && criteria) {
                            options[name].apply(this, args);
                        }
                    };

                callback('onChange', changed === true, defaultArgs);
                callback('onKeyPress', changed === true, defaultArgs);
                callback('onComplete', val.length === mask.length, defaultArgs);
                callback('onInvalid', p.invalid.length > 0, [val, e, el, p.invalid, options]);
            }
        };

        el = $(el);
        var jMask = this, oldValue = p.val(), regexMask;

        mask = typeof mask === 'function' ? mask(p.val(), undefined, el,  options) : mask;

        // public methods
        jMask.mask = mask;
        jMask.options = options;
        jMask.remove = function() {
            var caret = p.getCaret();
            if (jMask.options.placeholder) {
                el.removeAttr('placeholder');
            }
            if (el.data('mask-maxlength')) {
                el.removeAttr('maxlength');
            }
            p.destroyEvents();
            p.val(jMask.getCleanVal());
            p.setCaret(caret);
            return el;
        };

        // get value without mask
        jMask.getCleanVal = function() {
           return p.getMasked(true);
        };

        // get masked value without the value being in the input or element
        jMask.getMaskedVal = function(val) {
           return p.getMasked(false, val);
        };

       jMask.init = function(onlyMask) {
            onlyMask = onlyMask || false;
            options = options || {};

            jMask.clearIfNotMatch  = $.jMaskGlobals.clearIfNotMatch;
            jMask.byPassKeys       = $.jMaskGlobals.byPassKeys;
            jMask.translation      = $.extend({}, $.jMaskGlobals.translation, options.translation);

            jMask = $.extend(true, {}, jMask, options);

            regexMask = p.getRegexMask();

            if (onlyMask) {
                p.events();
                p.val(p.getMasked());
            } else {
                if (options.placeholder) {
                    el.attr('placeholder' , options.placeholder);
                }

                // this is necessary, otherwise if the user submit the form
                // and then press the "back" button, the autocomplete will erase
                // the data. Works fine on IE9+, FF, Opera, Safari.
                if (el.data('mask')) {
                  el.attr('autocomplete', 'off');
                }

                // detect if is necessary let the user type freely.
                // for is a lot faster than forEach.
                for (var i = 0, maxlength = true; i < mask.length; i++) {
                    var translation = jMask.translation[mask.charAt(i)];
                    if (translation && translation.recursive) {
                        maxlength = false;
                        break;
                    }
                }

                if (maxlength) {
                    el.attr('maxlength', mask.length).data('mask-maxlength', true);
                }

                p.destroyEvents();
                p.events();

                var caret = p.getCaret();
                p.val(p.getMasked());
                p.setCaret(caret);
            }
        };

        jMask.init(!el.is('input'));
    };

    $.maskWatchers = {};
    var HTMLAttributes = function () {
        var input = $(this),
            options = {},
            prefix = 'data-mask-',
            mask = input.attr('data-mask');

        if (input.attr(prefix + 'reverse')) {
            options.reverse = true;
        }

        if (input.attr(prefix + 'clearifnotmatch')) {
            options.clearIfNotMatch = true;
        }

        if (input.attr(prefix + 'selectonfocus') === 'true') {
           options.selectOnFocus = true;
        }

        if (notSameMaskObject(input, mask, options)) {
            return input.data('mask', new Mask(this, mask, options));
        }
    },
    notSameMaskObject = function(field, mask, options) {
        options = options || {};
        var maskObject = $(field).data('mask'),
            stringify = JSON.stringify,
            value = $(field).val() || $(field).text();
        try {
            if (typeof mask === 'function') {
                mask = mask(value);
            }
            return typeof maskObject !== 'object' || stringify(maskObject.options) !== stringify(options) || maskObject.mask !== mask;
        } catch (e) {}
    },
    eventSupported = function(eventName) {
        var el = document.createElement('div'), isSupported;

        eventName = 'on' + eventName;
        isSupported = (eventName in el);

        if ( !isSupported ) {
            el.setAttribute(eventName, 'return;');
            isSupported = typeof el[eventName] === 'function';
        }
        el = null;

        return isSupported;
    };

    $.fn.mask = function(mask, options) {
        options = options || {};
        var selector = this.selector,
            globals = $.jMaskGlobals,
            interval = globals.watchInterval,
            watchInputs = options.watchInputs || globals.watchInputs,
            maskFunction = function() {
                if (notSameMaskObject(this, mask, options)) {
                    return $(this).data('mask', new Mask(this, mask, options));
                }
            };

        $(this).each(maskFunction);

        if (selector && selector !== '' && watchInputs) {
            clearInterval($.maskWatchers[selector]);
            $.maskWatchers[selector] = setInterval(function(){
                $(document).find(selector).each(maskFunction);
            }, interval);
        }
        return this;
    };

    $.fn.masked = function(val) {
        return this.data('mask').getMaskedVal(val);
    };

    $.fn.unmask = function() {
        clearInterval($.maskWatchers[this.selector]);
        delete $.maskWatchers[this.selector];
        return this.each(function() {
            var dataMask = $(this).data('mask');
            if (dataMask) {
                dataMask.remove().removeData('mask');
            }
        });
    };

    $.fn.cleanVal = function() {
        return this.data('mask').getCleanVal();
    };

    $.applyDataMask = function(selector) {
        selector = selector || $.jMaskGlobals.maskElements;
        var $selector = (selector instanceof $) ? selector : $(selector);
        $selector.filter($.jMaskGlobals.dataMaskAttr).each(HTMLAttributes);
    };

    var globals = {
        maskElements: 'input,td,span,div',
        dataMaskAttr: '[data-mask]',
        dataMask: true,
        watchInterval: 300,
        watchInputs: true,
        keyStrokeCompensation: 10,
        // old versions of chrome dont work great with input event
        useInput: !/Chrome\/[2-4][0-9]|SamsungBrowser/.test(window.navigator.userAgent) && eventSupported('input'),
        watchDataMask: false,
        byPassKeys: [9, 16, 17, 18, 36, 37, 38, 39, 40, 91],
        translation: {
            '0': {pattern: /\d/},
            '9': {pattern: /\d/, optional: true},
            '#': {pattern: /\d/, recursive: true},
            'A': {pattern: /[a-zA-Z0-9]/},
            'S': {pattern: /[a-zA-Z]/}
        }
    };

    $.jMaskGlobals = $.jMaskGlobals || {};
    globals = $.jMaskGlobals = $.extend(true, {}, globals, $.jMaskGlobals);

    // looking for inputs with data-mask attribute
    if (globals.dataMask) {
        $.applyDataMask();
    }

    setInterval(function() {
        if ($.jMaskGlobals.watchDataMask) {
            $.applyDataMask();
        }
    }, globals.watchInterval);
}, window.jQuery, window.Zepto));

--- END_FILE: ..\assets\js\jquery.mask.js ---
------------------------------

--- START_FILE: ..\assets\js\mascaras.js ---
$(document).ready(function() {
    $('#cep').on('input propertychange', async function(){
    let currentValue = $(this).val().replace("-", "")
    let currentLength = currentValue.length
    let maxLength = $(this).attr('maxlength') - 1

    if (currentLength == maxLength) {
        const response = await fetch('https://viacep.com.br/ws/'+currentValue+'/json/');
        const data = await response.json();
        
        $("#endereco").val(data.logradouro);
        $("#bairro").val(data.bairro);
        $("#cidade").val(data.localidade);
        $("#complemento").val(data.complemento);
        $("#estado").val(data.uf.toUpperCase());
    }
    })

    $('#foto-perfil').change(function(e) {
        let file = this.files[0]; // ou $(this)[0].files[0]
        if (file) {
            let reader = new FileReader();
            reader.onload = function(event) {
                $("#foto-img").attr("src", event.target.result);
            };
            reader.readAsDataURL(file);
        }
    });
})
--- END_FILE: ..\assets\js\mascaras.js ---
------------------------------

--- START_FILE: ..\assets\js\register-vehicle-form-extras.js ---
$(function() {
    const costInput = $('#preco_custo');
    const profitInput = $('#lucro_esperado');
    const discountInput = $('#desconto');
    const saleInput = $('#preco_venda');
    const finalInput = $('#preco_desconto');

    function parseValue(value) {
        return parseFloat(value.replace(/\./g, '').replace(',', '.')) || 0;
    }

    function formatValue(value) {
        return value.toLocaleString('pt-br', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    }

    function calculatePrices() {
        const cost = parseValue(costInput.val());
        const profit = parseFloat(profitInput.val()) || 0;
        const discount = parseFloat(discountInput.val()) || 0;

        const salePrice = cost * (1 + profit / 100);
        const finalPrice = salePrice * (1 - discount / 100);

        saleInput.val(formatValue(salePrice));
        finalInput.val(formatValue(finalPrice));

        if (discount > 0 && finalPrice < cost) {
            const costFormatted = formatValue(cost);
            
            discountInput[0].setCustomValidity(`Preço com desconto abaixo do custo (R$ ${costFormatted}). Reduza o desconto.`);
            discountInput[0].reportValidity();
            discountInput.addClass('is-invalid');
        } else {
            discountInput[0].setCustomValidity('');
            discountInput.removeClass('is-invalid');
        }
    }

    costInput.on('input', calculatePrices);
    profitInput.on('input', calculatePrices);
    
    discountInput.on('input', function() {
        let value = parseInt($(this).val().replace(/\D/g, '')) || 0;
        if (value > 100) value = 100;
        $(this).val(value);
        calculatePrices();
    });

    $('form').on('submit', function(e) {
        calculatePrices();
        
        if (!this.checkValidity()) {
            e.preventDefault();
            this.reportValidity();
            return;
        }

        const cost = parseValue(costInput.val());
        const finalPrice = parseValue(finalInput.val());

        if (finalPrice < cost && parseValue(discountInput.val()) > 0) {
            alert("Atenção: O valor final está abaixo do custo.");
            e.preventDefault();
        }
    });
});
--- END_FILE: ..\assets\js\register-vehicle-form-extras.js ---
------------------------------

--- START_FILE: ..\assets\js\components\admin-header.js ---
$(function() {
    // Relógio
    function updateCurrentDate() {
    const now = new Date();
    const formatter = new Intl.DateTimeFormat('pt-BR', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: 'numeric',
        minute: 'numeric',
        second: 'numeric',
        hour12: false
    });
    $("#current-time").text(formatter.format(now).replace(', ', ' - '));
    }
    updateCurrentDate();
    setInterval(updateCurrentDate, 1000);
});
--- END_FILE: ..\assets\js\components\admin-header.js ---
------------------------------

--- START_FILE: ..\assets\js\components\form-modal.js ---
$(function () {
    const titles = { // titles[componente][isEditing], tipo: titles["vitems"][isEditing].
        ["vitems"]: {
            ["false"]: "CRIAR ACESSÓRIO",
            ["true"]: "EDITAR ACESSÓRIO"
        },
        ["cargos"]: {
            ["false"]: "CRIAR ACESSÓRIO",
            ["true"]: "EDITAR ACESSÓRIO"
        },
        ["marcas"]: {
            ["false"]: "CRIAR MARCA",
            ["true"]: "EDITAR MARCA"
        },
        ["modelos"]: {
            ["false"]: "CRIAR MODELO",
            ["true"]: "EDITAR MODELO"
        }
    }

    const loaders = {
        ["vitems"]: function (modal, trigger, isEdit) {
            // Get data from clicked button. If exists.
            let id = $(trigger).attr("data-id") || "";
            let name = $(trigger).attr("data-name") || "";
            let observation = $(trigger).attr("data-observation") || "";
            let icon = $(trigger).attr("data-icone") || null;
            let status = $(trigger).attr("data-status") || 1;

            // Get components
            const inputTitle = $(modal.find('.modal-title')[0]);
            const inputIcon = modal.find('#icon');
            const iconPreview = $(inputIcon.parent().find('.img-preview')[0]);
            const inputName = modal.find("#name");
            const inputObservation = modal.find("#observation");

            // Load data in modal elements
            inputName.val(name)
            inputObservation.val(observation)

            if (isEdit) {
                if (icon) {
                    iconPreview.attr('src', "../../../images/" + icon)
                }

                modal.find("#id").attr('value', id);
            }

            // Change modal elements
            const inputStatus = modal.find("#status");
            inputStatus.prop('disabled', !isEdit);
            inputStatus.val(status);

            inputTitle.text(titles["vitems"][isEdit]);
        },
        ["cargos"]: function (modal, trigger, isEdit) {
            // Get data from clicked button. If exists.
            let id = $(trigger).attr("data-id") || "";
            let name = $(trigger).attr("data-name") || "";
            let observation = $(trigger).attr("data-observation") || "";
            let status = $(trigger).attr("data-status") || 1;

            // Get components
            const inputTitle = $(modal.find('.modal-title')[0]);
            const inputName = modal.find("#name");
            const inputObservation = modal.find("#observation");

            // Load data in modal elements
            inputName.val(name)
            inputObservation.val(observation)

            if (isEdit) {
                modal.find("#id").attr('value', id);
            }

            // Change modal elements
            const inputStatus = modal.find("#status");
            inputStatus.prop('disabled', !isEdit);
            inputStatus.val(status);

            inputTitle.text(titles["cargos"][isEdit]);
        },
        ["marcas"]: function (modal, trigger, isEdit) {
            console.log('boa pa nois')
            let id = $(trigger).attr("data-id") || "";
            let name = $(trigger).attr("data-name") || "";
            let observation = $(trigger).attr("data-observation") || "";
            let status = $(trigger).attr("data-status") || 1;

            const inputTitle = $(modal.find('.modal-title')[0]);
            const inputName = modal.find("#name");
            const inputObservation = modal.find("#observation");

            inputName.val(name);
            inputObservation.val(observation);

            if (isEdit) {
                modal.find("#id").attr('value', id);
            }

            const inputStatus = modal.find("#status");
            inputStatus.prop('disabled', !isEdit);
            inputStatus.val(status);

            inputTitle.text(titles["marcas"][isEdit]);
        },
        ["modelos"]: function (modal, trigger, isEdit) {
            let id = $(trigger).attr("data-id") || "";
            let name = $(trigger).attr("data-name") || "";
            let observation = $(trigger).attr("data-observation") || "";
            let idMarca = $(trigger).attr("data-id_marca") || "";
            let status = $(trigger).attr("data-status") || 1;

            const inputTitle = $(modal.find('.modal-title')[0]);
            const inputName = modal.find("#name");
            const inputObservation = modal.find("#observation");
            const inputMarca = modal.find("#id_marca");

            inputName.val(name);
            inputObservation.val(observation);
            inputMarca.val(idMarca);

            if (isEdit) {
                modal.find("#id").attr('value', id);
            }

            const inputStatus = modal.find("#status");
            inputStatus.prop('disabled', !isEdit);
            inputStatus.val(status);

            inputTitle.text(titles["modelos"][isEdit]);
        }
    }

    $(".img-input").on('change', function () {
        const file = this.files[0];
        if (!file) {
            return;
        }

        const imagePreview = $(this).parent().find('.img-preview')[0];
        if (!imagePreview) {
            return;
        }

        const reader = new FileReader();
        reader.onload = function (event) {
            imagePreview.setAttribute('src', event.target.result);
        }

        reader.readAsDataURL(file);
    });

    $(".form-modal").on('show.bs.modal', function (event) {
        const clickedBtn = event.relatedTarget;
        if (!clickedBtn) {
            return;
        }

        const isEdit = clickedBtn.classList.contains("open-edit-modal");
        const entity = $(clickedBtn).attr('data-entity')

        loaders[entity]($(this), clickedBtn, isEdit)
    });
});
--- END_FILE: ..\assets\js\components\form-modal.js ---
------------------------------

--- START_FILE: ..\assets\js\components\sidebar.js ---
$(() => {
    $('.dropdown-expand-button').on('click', function() {
        $(this).parent().find('.dropdown-arrow').toggleClass('rotate-180')
        $(this).parent().toggleClass('dropdown-active')
    })
})
--- END_FILE: ..\assets\js\components\sidebar.js ---
------------------------------

--- START_FILE: ..\assets\js\pages\sell-manage.js ---

let selectedItems = <?php echo $itemsJson; ?>;
let selectedPayments = <?php echo $paymentsJson; ?>;
let currentVehicle = null;

function formatMoney(value) {
    return value.toLocaleString('pt-br', {
        style: 'currency',
        currency: 'BRL'
    });
}

function parseMoney(value) {
    if (!value) return 0;
    return parseFloat(value.replace(/\./g, '').replace(',', '.'));
}

$(function () {
    if (selectedItems.length > 0) renderItemsTable();
    if (selectedPayments.length > 0) renderPaymentsTable();
    updateCalculations();
});

function initSearch(inputId, resultsId, searchType) {
    $(`#${inputId}`).on('keyup', function () {
        let term = $(this).val();
        if (term.length > 2) {
            $.get('search.php', {
                type: searchType,
                q: term
            }, function (data) {
                $(`#${resultsId}`).html(data).show();
            });
        } else {
            $(`#${resultsId}`).hide();
        }
    });
}

initSearch('customer-search', 'customer-results', 'cliente');
initSearch('seller-search', 'seller-results', 'vendedor');
initSearch('vehicle-search', 'vehicle-results', 'veiculo');

function selecionarCliente(id, name) {
    $('#customer-id-hidden').val(id);
    $('#customer-search').val(name).addClass('field-selected');
    $('#customer-icon').html('<i class="bi bi-check-lg text-success"></i>');
    $('#customer-results').hide();
}

function selecionarVendedor(id, name) {
    $('#seller-id-hidden').val(id);
    $('#seller-search').val(name).addClass('field-selected');
    $('#seller-icon').html('<i class="bi bi-check-lg text-success"></i>');
    $('#seller-results').hide();
}

function selecionarVeiculo(id, name, price, stock) {
    currentVehicle = {
        id: id,
        name: name,
        price: parseFloat(price),
        stock: parseInt(stock)
    };
    $('#vehicle-search').val(name);
    $('#vehicle-results').hide();
}

function updateCalculations() {
    let subtotalValue = 0;
    let itemsCount = selectedItems.length;

    for (let index = 0; index < itemsCount; index++) {
        subtotalValue += (selectedItems[index].price * selectedItems[index].quantity);
    }

    let discountPercent = parseFloat($('#sale-discount').val()) || 0;
    let totalValue = subtotalValue - (subtotalValue * (discountPercent / 100));

    let totalReceived = 0;
    let paymentsCount = selectedPayments.length;

    for (let index = 0; index < paymentsCount; index++) {
        totalReceived += selectedPayments[index].amount;
    }

    let difference = totalReceived - totalValue;

    $('#view-subtotal').text(formatMoney(subtotalValue));
    $('#view-total').text(formatMoney(totalValue));
    $('#view-received').text(formatMoney(totalReceived));
    $('#view-difference').text(formatMoney(difference));
}

$("#sale-discount").on('input', function () {
    if (parseInt($(this).val()) > 100) {
        $(this).val(100);
    }
});

$('#btn-add-vehicle').click(function () {
    if (!currentVehicle) return alert("Por favor, selecione um veículo.");
    let qty = parseInt($('#input-qty').val());
    if (qty > currentVehicle.stock) return alert("Estoque insuficiente.");

    // O push coloca um novo objeto dentro da lista (array)
    selectedItems.push({
        id: currentVehicle.id,
        name: currentVehicle.name,
        price: currentVehicle.price,
        quantity: qty
    });

    renderItemsTable();
    currentVehicle = null;
    $('#vehicle-search').val('');
});

function renderItemsTable() {
    let rowsHtml = '';
    let totalRecords = selectedItems.length;

    for (let index = 0; index < totalRecords; index++) {
        let item = selectedItems[index];
        let sub = item.price * item.quantity;
        rowsHtml += `<tr>
                    <td>${item.name} 
                        <input type="hidden" name="item_id[]" value="${item.id}">
                        <input type="hidden" name="item_qty[]" value="${item.quantity}">
                    </td>
                    <td>${formatMoney(item.price)}</td>
                    <td>${item.quantity}</td>
                    <td>${formatMoney(sub)}</td>
                    <td class="text-end"><i class="bi bi-trash text-danger pointer" onclick="removeItem(${index})"></i></td>
                </tr>`;
    }
    $('#vehicle-table-body').html(rowsHtml);
    updateCalculations();
}

function removeItem(index) {
    selectedItems.splice(index, 1);
    renderItemsTable();
}

$('#btn-add-payment').click(function () {
    let method = $('#pay-method').val();
    let amount = parseMoney($('#pay-amount').val());
    let installments = $('#pay-installments').val();

    if (amount <= 0) return alert("Informe um valor válido.");
    if (method !== "Cartão de Crédito") installments = 1;

    selectedPayments.push({
        method: method,
        amount: amount,
        installments: installments
    });
    renderPaymentsTable();
    $('#pay-amount').val('');
});

function renderPaymentsTable() {
    let rowsHtml = '';
    let totalRecords = selectedPayments.length;

    for (let index = 0; index < totalRecords; index++) {
        let p = selectedPayments[index];
        rowsHtml += `<tr>
                    <td>${p.method} 
                        <input type="hidden" name="pay_method[]" value="${p.method}">
                        <input type="hidden" name="pay_amount[]" value="${p.amount}">
                        <input type="hidden" name="pay_installments[]" value="${p.installments}">
                    </td>
                    <td>${p.installments}x</td>
                    <td>${formatMoney(p.amount)}</td>
                    <td class="text-end"><i class="bi bi-x-lg text-danger pointer" onclick="removePayment(${index})"></i></td>
                </tr>`;
    }
    $('#payment-table-body').html(rowsHtml);
    updateCalculations();
}

function removePayment(index) {
    selectedPayments.splice(index, 1);
    renderPaymentsTable();
}

$('#sale-discount').on('keyup', updateCalculations);

function generateMockData() {
    const customers = <? php echo json_encode($mockCustomers); ?>;
    const employees = <? php echo json_encode($mockEmployees); ?>;
    const vehicles = <? php echo json_encode($mockVehicles); ?>;
    if (customers.length === 0 || employees.length === 0 || vehicles.length === 0) return;

    selecionarCliente(customers[0].id, customers[0].nome);
    selecionarVendedor(employees[0].id, employees[0].nome);

    selectedItems = [{
        id: vehicles[0].id,
        name: vehicles[0].nome,
        price: parseFloat(vehicles[0].preco_venda),
        quantity: 1
    }];
    renderItemsTable();
}

$("#pay-method").on('change', function () {
    const isCredit = $(this).val() === "Cartão de Crédito";
    $("#pay-installments").prop('disabled', !isCredit);
});

$('#sale-form').on('submit', function (e) {
    let customerId = $("#customer-id-hidden").val();
    let sellerId = $("#seller-id-hidden").val();
    let discountPercent = parseFloat($('#sale-discount').val()) || 0;

    if (customerId == "") {
        alert('Por favor, selecione um cliente antes de finalizar.');
        e.preventDefault();
        return;
    }

    if (sellerId == "") {
        alert('Por favor, selecione um vendedor antes de finalizar.');
        e.preventDefault();
        return;
    }

    if (selectedItems.length == 0) {
        alert('A venda não possui produtos. Adicione ao menos um veículo.');
        e.preventDefault();
        return;
    }

    if (selectedPayments.length == 0) {
        alert('Você precisa informar como o cliente vai pagar.');
        e.preventDefault();
        return;
    }

    let totalToPay = 0;
    for (let index = 0; index < selectedItems.length; index++) {
        totalToPay += (selectedItems[index].price * selectedItems[index].quantity);
    }

    let finalTotalWithDiscount = totalToPay - (totalToPay * (discountPercent / 100));

    let totalAmountPaid = 0;
    for (let index = 0; index < selectedPayments.length; index++) {
        totalAmountPaid += selectedPayments[index].amount;
    }

    if (totalAmountPaid < finalTotalWithDiscount) {
        alert('O valor total pago é menor que o valor final da venda. Ajuste os pagamentos.');
        // O preventDefault cancela o envio do formulário
        e.preventDefault();
        return;
    }
});
--- END_FILE: ..\assets\js\pages\sell-manage.js ---
------------------------------

--- START_FILE: ..\admin\cargos\actions.php ---
<?php 
    require_once('../../conexao/conecta.php');

    if (!isset($_SESSION)) { session_start(); }

    // Excluir
    if (isset($_POST["delete"])) {
        $id = (int)$_POST["delete"]; 

        try {
            $query = "DELETE FROM cargo WHERE id = $id;";
            if (mysqli_query($connection, $query)) {
                $_SESSION['messageType'] = 'success';
                $_SESSION['messageText'] = "Sucesso: O cargo foi excluído.";
            } else {
                throw new mysqli_sql_exception();
            }
        } catch (mysqli_sql_exception $e) {
            if ($e->getCode() == 1451) {
                $query = "SELECT COUNT(id) AS total FROM funcionario WHERE id_cargo = $id";
                $result = mysqli_query($connection, $query);
                $totalCount = mysqli_fetch_assoc($result)['total'];

                $_SESSION['messageType'] = 'info';
                $_SESSION['messageText'] = "Falhou: Existem $totalCount funcionários vinculados a este cargo.";
            } else {
                $_SESSION['messageType'] = 'error';
                $_SESSION['messageText'] = "Erro ao excluir.";
            }
        }
        header('Location: Index.php');
        exit;
    }

    // Cadastrar e Editar
    $id = isset($_POST['id']) ? (int)$_POST['id'] : 0;
    $isEditing = ($id > 0);

    $name = mysqli_real_escape_string($connection, $_POST['name']);
    $observation = mysqli_real_escape_string($connection, $_POST['observation']);
    $status = isset($_POST['status']) ? (int)$_POST['status'] : 1;

    if ($isEditing) {
        $query = "UPDATE cargo SET nome = '$name', observacao = '$observation', status = $status WHERE id = $id";
        $successMessage = "Cargo editado com sucesso!";
    } else {
        $query = "INSERT INTO cargo VALUES (0, '$name', '$observation', NOW(), 1);";
        $successMessage = "Cargo cadastrado com sucesso!";
    }

    if (mysqli_query($connection, $query)) {
        $_SESSION['messageType'] = 'success';
        $_SESSION['messageText'] = $successMessage;
    } else {
        $_SESSION['messageType'] = 'error';
        $_SESSION['messageText'] = "Erro ao processar cargo.";
    }

    header('Location: Index.php');
    exit;
?>
--- END_FILE: ..\admin\cargos\actions.php ---
------------------------------

--- START_FILE: ..\admin\cargos\Index.php ---
<?php
if (!isset($_SESSION)) {
  session_start();
}
require_once("../../conexao/conecta.php");
require_once('../../Components/Sidebar.php');
require_once("../../Components/FormModal.php");
?>
<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Carros Fácil - Painel</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

  <link rel="shortcut icon" href="../../assets/img/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="../../custom/css/style.css">
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <?php echo Sidebar("role"); ?>

      <main class="col-lg-10">
        <header id="admin-header" class="py-3 d-flex align-items-center justify-content-between gap-2 px-3">
          <div id="left-info">GERENCIANDO - CARGOS</div>
          <div id="right-info">
            <div id="current-time">AGORA</div>
          </div>
        </header>

        <hr class="m-0">

        <?php include('../Mensagem.php'); ?>

        <div class="container mt-5">
          <div class="card">
            <div class="card-header d-flex justify-content-between">
              <h4 class="m-0 lh-base">Cargos</h4>
              <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#cargosModal" data-entity="cargos">
                Adicionar
              </button>
            </div>


            <div class="card-body">
              <div class="row">
                <div class="col-md-2">
                  <input onkeyup="applyFilters()" type="text" name="id-filter" id="id-filter" class="form-control" placeholder="Filtrar por código">
                </div>

                <div class="col-7">
                  <input onkeyup="applyFilters()" type="search" name="search-filter" id="search-filter" class="form-control" placeholder="Filtrar por cargo">
                </div>

                <div class="col-3">
                  <select name="status-filter" id="status-filter" class="form-control" onchange="applyFilters()">
                    <option value="">Status</option>
                    <option value="1">Ativo</option>
                    <option value="0">Inativo</option>
                  </select>
                </div>
              </div>
            </div>

            <div id="table-target"></div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <?php
  echo FormModal::create([
    "modalId" => "cargosModal",
    "actionUrl" => "./actions.php",
    "submitButton" => '<button type="submit" class="btn btn-primary w-100">Cadastrar</button>'
  ], [
    ["id" => "name", "optional" => false, "label" => "Nome", "type" => "text", "length" => 80],
    ["id" => "observation", "optional" => true, "label" => "Observação", "type" => "text", "length" => 250],
    ["id" => "status", "optional" => false, "label" => "Status", "type" => "select", "options" => [
      ["label" => "Desativado", "value" => 0],
      ["label" => "Ativado", "value" => 1],
    ]]
  ]);
  ?>

  <!-- BOOTSTRAP JS + JQUERY -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js"></script>

  <script src="../../assets/js/components/form-modal.js"></script>
  <script src="../../assets/js/components/admin-header.js"></script>
  <script src="../../assets/js/components/sidebar.js"></script>
  
  <!-- CUSTOM SCRIPTS -->
  <script>
    // AJAX (FUNÇÃO PARA LISTAR OS FUNCIONÁRIOS)
    function updateTableWithFilters(id, name, status) {
      $.ajax({
        url: './table.php',
        method: 'POST',
        data: {
          id,
          name,
          status
        },
        dataType: 'html',
        success: function(response) {
          $("#table-target").html(response);
        }
      })
    }

    // AJAX (Função para aplicar o filtro)
    function applyFilters() {
      updateTableWithFilters($("#id-filter").val(), $("#search-filter").val(), $("#status-filter").val());
    }

    $(document).ready(function() {
      applyFilters();
    });
  </script>
</body>

</html>
--- END_FILE: ..\admin\cargos\Index.php ---
------------------------------

--- START_FILE: ..\admin\cargos\table.php ---
<?php
require_once("../../conexao/conecta.php");
require_once("../../Components/Table.php");

// Query base buscando os cargos
$query = "SELECT id, nome 'name', observacao 'observation', data_cadastro 'createdAt', status FROM cargo";

$id = (int) $_POST['id'] ?? 0;
$name = $_POST['name'] ?? "";
$status = $_POST['status'] ?? "";
$conditions = [];

if ($id > 0) {
    $id = mysqli_real_escape_string($connection, $id);
    $conditions[] = "id = '$id'";
}

if ($name !== "") {
    $name = mysqli_real_escape_string($connection, $name);
    $conditions[] = "nome LIKE '%$name%'";
}

if ($status !== "") {
    $conditions[] = "status = " . (int)$status;
}

if (!empty($conditions)) {
    $query .= " WHERE " . implode(" AND ", $conditions);
}

$query .= " ORDER BY id ASC";
$result = mysqli_query($connection, $query);

// Renderização via componente Table
echo Table::render([
  "#" => "id",
  "Nome" => "name",
  "Observação" => "observation",
  "Data" => "createdAt",
  "Status" => "status"
], $result, [
  "entity" => "cargos",
  "modalTarget" => "#cargosModal" // Certifique-se que o ID do modal no Index de cargos seja este
]);
?>
--- END_FILE: ..\admin\cargos\table.php ---
------------------------------

--- START_FILE: ..\admin\clientes\actions.php ---
<?php 
    require_once('../../conexao/conecta.php');

    if (!isset($_SESSION)) { session_start(); }

    // Excluir
    if (isset($_POST["delete"])) {
        $id = (int)$_POST["delete"]; 

        try {
            $query = "DELETE FROM cliente WHERE id = $id;";
            if (mysqli_query($connection, $query)) {
                $_SESSION['messageType'] = 'success';
                $_SESSION['messageText'] = "Sucesso: Cliente removido.";
            } else {
                throw new mysqli_sql_exception();
            }
        } catch (mysqli_sql_exception $e) {
            if ($e->getCode() == 1451) {
                $query = "SELECT COUNT(id) AS total FROM venda WHERE id_cliente = $id";
                $result = mysqli_query($connection, $query);
                $totalCount = mysqli_fetch_assoc($result)['total'];

                $_SESSION['messageType'] = 'info';
                $_SESSION['messageText'] = "Falhou: Existem $totalCount vendas vinculadas a este cliente.";
            } else {
                $_SESSION['messageType'] = 'error';
                $_SESSION['messageText'] = "Erro ao excluir cliente.";
            }
        }
        header('Location: Index.php');
        exit;
    }

    // Cadastrar e Editar
    $id = isset($_POST['id']) ? (int)$_POST['id'] : 0;
    $isEditing = ($id > 0);

    // Coleta e Sanitização (EN logic)
    $cpf = mysqli_real_escape_string($connection, $_POST['cpf']);
    $rg = mysqli_real_escape_string($connection, $_POST['rg']);
    $name = mysqli_real_escape_string($connection, $_POST['name']);
    $birthDate = mysqli_real_escape_string($connection, $_POST['birthDate']);
    $username = mysqli_real_escape_string($connection, $_POST['username']);
    $password = mysqli_real_escape_string($connection, $_POST['password']);
    $address = mysqli_real_escape_string($connection, $_POST['address']);
    $zipcode = mysqli_real_escape_string($connection, $_POST['zipcode']);
    $number = mysqli_real_escape_string($connection, $_POST['number']);
    $complement = mysqli_real_escape_string($connection, $_POST['complement']);
    $neighborhood = mysqli_real_escape_string($connection, $_POST['neighborhood']);
    $city = mysqli_real_escape_string($connection, $_POST['city']);
    $state = mysqli_real_escape_string($connection, $_POST['state']);
    $phone1 = mysqli_real_escape_string($connection, $_POST['phone1']);
    $phone2 = mysqli_real_escape_string($connection, $_POST['phone2']);
    $email = mysqli_real_escape_string($connection, $_POST['email']);
    $maritalStatus = mysqli_real_escape_string($connection, $_POST['maritalStatus']);
    $gender = mysqli_real_escape_string($connection, $_POST['gender']);
    $status = isset($_POST['status']) ? (int)$_POST['status'] : 1;

    if ($isEditing) {
        $query = "UPDATE cliente SET 
            cpf = '$cpf', rg = '$rg', nome = '$name', data_nascimento = '$birthDate', 
            usuario = '$username', senha = '$password', endereco = '$address', cep = '$zipcode', 
            numero = '$number', complemento = '$complement', bairro = '$neighborhood', 
            cidade = '$city', estado = '$state', telefone1 = '$phone1', telefone2 = '$phone2', 
            email = '$email', estado_civil = '$maritalStatus', sexo = '$gender', status = $status 
            WHERE id = $id";
        $successMessage = "Dados do cliente atualizados!";
    } else {
        $query = "INSERT INTO cliente (
            cpf, rg, nome, data_nascimento, usuario, senha, endereco, cep, 
            numero, complemento, bairro, cidade, estado, telefone1, telefone2, 
            email, estado_civil, sexo, data_cadastro, status
        ) VALUES (
            '$cpf', '$rg', '$name', '$birthDate', '$username', '$password', '$address', '$zipcode', 
            '$number', '$complement', '$neighborhood', '$city', '$state', '$phone1', '$phone2', 
            '$email', '$maritalStatus', '$gender', NOW(), 1
        )";
        $successMessage = "Cliente cadastrado com sucesso!";
    }

    try {
        if (mysqli_query($connection, $query)) {
            $_SESSION['messageType'] = 'success';
            $_SESSION['messageText'] = $successMessage;
        } else {
            throw new mysqli_sql_exception();
        }
    } catch (mysqli_sql_exception $e) {
        $_SESSION['messageType'] = 'error';
        if ($e->getCode() == 1062) {
            $_SESSION['messageText'] = "Erro: CPF ou Usuário já cadastrado.";
        } else {
            $_SESSION['messageText'] = "Erro ao processar cliente.";
        }
    }

    header('Location: Index.php');
    exit;
?>
--- END_FILE: ..\admin\clientes\actions.php ---
------------------------------

--- START_FILE: ..\admin\clientes\Index.php ---
<?php
if (!isset($_SESSION)) {
  session_start();
}
require_once("../../conexao/conecta.php");
require_once('../../Components/Sidebar.php');
?>
<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Carros Fácil - Clientes</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <link rel="shortcut icon" href="../../assets/img/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="../../custom/css/style.css">
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <?php echo Sidebar("customer"); ?>

      <main class="col-lg-10">
        <header id="admin-header" class="py-3 d-flex align-items-center justify-content-between gap-2 px-3">
          <div id="left-info">GERENCIANDO - CLIENTES</div>
          <div id="right-info">
            <div id="current-time">AGORA</div>
          </div>
        </header>

        <hr class="m-0">

        <?php include('../Mensagem.php'); ?>

        <div class="container mt-3">
          <div class="card shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h4 class="m-0">Base de Clientes</h4>
              <a href="manage.php" id="btn-abrir-modal" class="btn btn-primary">
                <i class="bi bi-plus-lg"></i> Adicionar
              </a>
            </div>

            <div class="card-body">
              <div class="row g-2">
                <div class="col-md-3">
                  <input onkeyup="applyFilters()" type="text" id="name-filter" class="form-control" placeholder="Nome do cliente">
                </div>
                <div class="col-md-2">
                  <input onkeyup="applyFilters()" type="text" id="cpf-filter" class="form-control" placeholder="CPF" data-mask="000.000.000-00">
                </div>
                <div class="col-md-2">
                  <input onkeyup="applyFilters()" type="text" id="phone-filter" class="form-control" placeholder="Telefone" data-mask="(00) 00000-0000">
                </div>
                <div class="col-md-2">
                  <select onchange="applyFilters()" id="gender-filter" class="form-select">
                    <option value="">Sexo</option>
                    <option value="M">Masculino</option>
                    <option value="F">Feminino</option>
                    <option value="N">Não Informado</option>
                  </select>
                </div>
                <div class="col-md-2">
                  <select onchange="applyFilters()" id="status-filter" class="form-select">
                    <option value="">Status</option>
                    <option value="1">Ativo</option>
                    <option value="0">Inativo</option>
                  </select>
                </div>
              </div>
            </div>

            <div id="table-target">
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../../assets/js/jquery.mask.js"></script>
  <script src="../../assets/js/components/admin-header.js"></script>
  <script src="../../assets/js/components/sidebar.js"></script>

  <script>
    function applyFilters() {
      $.ajax({
        url: 'table.php',
        method: 'POST',
        data: {
          name: $("#name-filter").val(),
          cpf: $("#cpf-filter").val(),
          phone: $("#phone-filter").val(),
          gender: $("#gender-filter").val(),
          status: $("#status-filter").val()
        },
        success: function(response) {
          $("#table-target").html(response);
        }
      });
    }

    $(document).ready(function() {
      applyFilters();
    });
  </script>
</body>

</html>
--- END_FILE: ..\admin\clientes\Index.php ---
------------------------------

--- START_FILE: ..\admin\clientes\manage.php ---
<?php
if (!isset($_SESSION)) {
  session_start();
}
require_once("../../conexao/conecta.php");
require_once('../../Components/Sidebar.php');

$id = isset($_GET['id']) ? (int)$_GET['id'] : 0;
$customer = null;

if ($id > 0) {
  $query = "SELECT * FROM cliente WHERE id = $id";
  $result = mysqli_query($connection, $query);
  $customer = mysqli_fetch_assoc($result);
}

$pageTitle = $customer ? "Editar Cliente: " . $customer['nome'] : "Novo Cliente";
?>
<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Carros Fácil - <?php echo $pageTitle; ?></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="../../custom/css/style.css">
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <?php echo Sidebar("customer"); ?>

      <main class="col-lg-10">
        <header id="admin-header" class="py-2 d-flex align-items-center justify-content-between gap-2 px-3">
          <div id="left-info"><?php echo mb_strtoupper($pageTitle); ?></div>
          <div id="right-info">
            <button type="button" id="fillCustomer" class="btn btn-warning btn-sm py-2">
              <i class="bi bi-magic"></i> Mock Data
            </button>
            <a href="Index.php" class="py-2 btn btn-outline-secondary btn-sm"><i class="bi bi-arrow-left"></i> Voltar</a>
          </div>
        </header>

        <hr class="m-0">

        <div class="container mt-4 mb-5">
          <form action="actions.php" method="post">
            <input maxlength="999" type="hidden" name="id" value="<?php echo $id; ?>">

            <div class="row g-4">
              <div class="col-md-12">
                <div class="card shadow-sm">
                  <div class="card-header bg-light"><strong>Dados Pessoais</strong></div>
                  <div class="card-body row g-3">
                    <div class="col-md-6">
                      <label for="name" class="form-label">Nome Completo <span class="text-danger">*</span></label>
                      <input maxlength="80" type="text" name="name" id="name" class="form-control" value="<?php echo $customer['nome'] ?? ''; ?>" required>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">CPF <span class="text-danger">*</span></label>
                      <input maxlength="14" type="text" name="cpf" id="cpf" class="form-control" data-mask="000.000.000-00" value="<?php echo $customer['cpf'] ?? ''; ?>" required>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">RG</label>
                      <input maxlength="12" type="text" name="rg" id="rg" class="form-control" data-mask="00.000.000-A" value="<?php echo $customer['rg'] ?? ''; ?>">
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Sexo</label>
                      <select name="gender" id="gender" class="form-select">
                        <option value="N" <?php if ($customer && $customer['sexo'] == 'N') echo 'selected'; ?>>Não Informado</option>
                        <option value="M" <?php if ($customer && $customer['sexo'] == 'M') echo 'selected'; ?>>Masculino</option>
                        <option value="F" <?php if ($customer && $customer['sexo'] == 'F') echo 'selected'; ?>>Feminino</option>
                      </select>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Estado Civil</label>
                      <select name="maritalStatus" id="maritalStatus" class="form-select">
                        <?php
                        $maritalStatusItems = ["Solteiro(a)", "Casado(a)", "Separado(a)", "Divorciado(a)", "Viúvo(a)"];
                        foreach ($maritalStatusItems as $maritalStatusItem) {
                          $selected = ($customer && $customer['estado_civil'] == $maritalStatusItem) ? 'selected' : '';
                          echo "<option value='$maritalStatusItem' $selected>$maritalStatusItem</option>";
                        }
                        ?>
                      </select>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Data Nascimento</label>
                      <input type="date" name="birthDate" id="birthDate" class="form-control" value="<?php echo $customer['data_nascimento'] ?? ''; ?>">
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Status</label>
                      <select name="status" id="status" class="form-select">
                        <option value="1" <?php if ($customer && $customer['status'] == 1) echo 'selected'; ?>>Ativo</option>
                        <option value="0" <?php if ($customer && $customer['status'] == 0) echo 'selected'; ?>>Inativo</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-5">
                <div class="card shadow-sm h-100">
                  <div class="card-header bg-light"><strong>Acesso e Segurança</strong></div>
                  <div class="card-body row g-3">
                    <div class="col-md-5">
                      <label class="form-label">Usuário <span class="text-danger">*</span></label>
                      <input maxlength="20" type="text" name="username" id="username" class="form-control" value="<?php echo $customer["usuario"] ?? ''; ?>" required>
                    </div>
                    <div class="col-md-7">
                      <label class="form-label">Senha <span class="text-danger">*</span></label>
                      <input maxlength="255" type="password" name="password" id="password" class="form-control" value="<?php echo $customer["senha"] ?? ''; ?>" required>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-7">
                <div class="card shadow-sm h-100">
                  <div class="card-header bg-light"><strong>Contatos</strong></div>
                  <div class="card-body row g-3">
                    <div class="col-md-3">
                      <label class="form-label">Telefone 1 <span class="text-danger">*</span></label>
                      <input maxlength="15" type="text" name="phone1" id="phone1" class="form-control" data-mask="(00) 00000-0000" value="<?php echo $customer['telefone1'] ?? ''; ?>" required>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Telefone 2</label>
                      <input maxlength="15" type="text" name="phone2" id="phone2" class="form-control" data-mask="(00) 00000-0000" value="<?php echo $customer['telefone2'] ?? ''; ?>">
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">E-mail</label>
                      <input maxlength="100" type="email" name="email" id="email" class="form-control" value="<?php echo $customer['email'] ?? ''; ?>">
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-12">
                <div class="card shadow-sm">
                  <div class="card-header bg-light"><strong>Localização</strong></div>
                  <div class="card-body row g-3">
                    <div class="col-md-2">
                      <label class="form-label">CEP</label>
                      <input maxlength="9" type="text" name="zipcode" id="zipcode" class="form-control" data-mask="00000-000" value="<?php echo $customer['cep'] ?? ''; ?>">
                    </div>
                    <div class="col-md-5">
                      <label class="form-label">Endereço <span class="text-danger">*</span></label>
                      <input maxlength="60" type="text" name="address" id="address" class="form-control" value="<?php echo $customer['endereco'] ?? ''; ?>" required>
                    </div>
                    <div class="col-md-1">
                      <label class="form-label">Número <span class="text-danger">*</span></label>
                      <input maxlength="5" type="text" name="number" id="number" class="form-control" value="<?php echo $customer['numero'] ?? ''; ?>" required>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Bairro <span class="text-danger">*</span></label>
                      <input maxlength="50" type="text" name="neighborhood" id="neighborhood" class="form-control" value="<?php echo $customer['bairro'] ?? ''; ?>" required>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Cidade <span class="text-danger">*</span></label>
                      <input maxlength="50" type="text" name="city" id="city" class="form-control" value="<?php echo $customer['cidade'] ?? ''; ?>" required>
                    </div>
                    <div class="col-md-2">
                      <label class="form-label">Estado <span class="text-danger">*</span></label>
                      <select name="state" id="state" class="form-select" required>
                        <option value="" disabled <?= empty($customer['estado']) ? "selected" : "" ?>>Selecione um estado</option>
                        <option value="AC" <?= $customer && $customer['estado'] == 'AC' ? "selected" : "" ?>>Acre</option>
                        <option value="AL" <?= $customer && $customer['estado'] == 'AL' ? "selected" : "" ?>>Alagoas</option>
                        <option value="AP" <?= $customer && $customer['estado'] == 'AP' ? "selected" : "" ?>>Amapá</option>
                        <option value="AM" <?= $customer && $customer['estado'] == 'AM' ? "selected" : "" ?>>Amazonas</option>
                        <option value="BA" <?= $customer && $customer['estado'] == 'BA' ? "selected" : "" ?>>Bahia</option>
                        <option value="CE" <?= $customer && $customer['estado'] == 'CE' ? "selected" : "" ?>>Ceará</option>
                        <option value="DF" <?= $customer && $customer['estado'] == 'DF' ? "selected" : "" ?>>Distrito Federal</option>
                        <option value="ES" <?= $customer && $customer['estado'] == 'ES' ? "selected" : "" ?>>Espírito Santo</option>
                        <option value="GO" <?= $customer && $customer['estado'] == 'GO' ? "selected" : "" ?>>Goiás</option>
                        <option value="MA" <?= $customer && $customer['estado'] == 'MA' ? "selected" : "" ?>>Maranhão</option>
                        <option value="MT" <?= $customer && $customer['estado'] == 'MT' ? "selected" : "" ?>>Mato Grosso</option>
                        <option value="MS" <?= $customer && $customer['estado'] == 'MS' ? "selected" : "" ?>>Mato Grosso do Sul</option>
                        <option value="MG" <?= $customer && $customer['estado'] == 'MG' ? "selected" : "" ?>>Minas Gerais</option>
                        <option value="PA" <?= $customer && $customer['estado'] == 'PA' ? "selected" : "" ?>>Pará</option>
                        <option value="PB" <?= $customer && $customer['estado'] == 'PB' ? "selected" : "" ?>>Paraíba</option>
                        <option value="PR" <?= $customer && $customer['estado'] == 'PR' ? "selected" : "" ?>>Paraná</option>
                        <option value="PE" <?= $customer && $customer['estado'] == 'PE' ? "selected" : "" ?>>Pernambuco</option>
                        <option value="PI" <?= $customer && $customer['estado'] == 'PI' ? "selected" : "" ?>>Piauí</option>
                        <option value="RJ" <?= $customer && $customer['estado'] == 'RJ' ? "selected" : "" ?>>Rio de Janeiro</option>
                        <option value="RN" <?= $customer && $customer['estado'] == 'RN' ? "selected" : "" ?>>Rio Grande do Norte</option>
                        <option value="RS" <?= $customer && $customer['estado'] == 'RS' ? "selected" : "" ?>>Rio Grande do Sul</option>
                        <option value="RO" <?= $customer && $customer['estado'] == 'RO' ? "selected" : "" ?>>Rondônia</option>
                        <option value="RR" <?= $customer && $customer['estado'] == 'RR' ? "selected" : "" ?>>Roraima</option>
                        <option value="SC" <?= $customer && $customer['estado'] == 'SC' ? "selected" : "" ?>>Santa Catarina</option>
                        <option value="SP" <?= $customer && $customer['estado'] == 'SP' ? "selected" : "" ?>>São Paulo</option>
                        <option value="SE" <?= $customer && $customer['estado'] == 'SE' ? "selected" : "" ?>>Sergipe</option>
                        <option value="TO" <?= $customer && $customer['estado'] == 'TO' ? "selected" : "" ?>>Tocantins</option>
                      </select>
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Complemento</label>
                      <input maxlength="200" type="text" name="complement" class="form-control" value="<?= $customer ? $customer['complemento'] : '' ?? ''; ?>">
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-12">
                <button type="submit" name="actionSave" class="btn btn-primary w-100 py-3 shadow-sm">
                  <i class="bi bi-check2-circle"></i> <?php echo $customer ? "Atualizar Cadastro" : "Finalizar Cadastro"; ?>
                </button>
              </div>
            </div>
          </form>
        </div>
      </main>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="../../assets/js/jquery.mask.js"></script>

  <script src="../../assets/js/components/sidebar.js"></script>
  <script>
    $('#fillCustomer').on('click', async function() {
      const btn = $(this);
      // Feedback visual de carregamento
      btn.html('<span class="spinner-border spinner-border-sm"></span> Gerando...').prop('disabled', true);

      try {
        // 1. Busca dados base na API (Nomes, Emails, Cidades reais)
        const response = await fetch('https://randomuser.me/api/?nat=br');
        const data = await response.json();
        const person = data.results[0];

        // 2. Funções para dados aleatórios brasileiros
        const rand = (n) => Math.floor(Math.random() * n);

        const geraCPF = () => `${rand(900)+100}.${rand(900)+100}.${rand(900)+100}-${rand(90)+10}`;
        const geraRG = () => `${rand(90)}.${rand(900)+100}.${rand(900)+100}-${rand(9)}`;

        // Gera telefone no formato (XX) 9XXXX-XXXX
        const generatePhoneNumber = () => `(${rand(89)+10}) 9${rand(8999)+1000}-${rand(8999)+1000}`;

        // 3. Lista de Estados Civis (igual ao seu PHP)
        const maritalStatusItems = ["Solteiro(a)", "Casado(a)", "Separado(a)", "Divorciado(a)", "Viúvo(a)"];

        // --- PREENCHIMENTO DOS CAMPOS ---

        // Dados Pessoais
        $('#name').val(`${person.name.first} ${person.name.last}`);
        $('#cpf').val(geraCPF());
        $('#rg').val(geraRG());
        $('#gender').val(person.gender === 'male' ? 'M' : 'F');
        $('#maritalStatus').val(maritalStatusItems[rand(maritalStatusItems.length)]); // Sorteio do Estado Civil

        const birthDate = new Date(person.dob.date).toISOString().split('T')[0];
        $('#birthDate').val(birthDate);

        // Acesso
        $('#username').val(person.login.username);
        $('#password').val('123456');
        $('#email').val(person.email);

        // Contatos (Telefone 1 e 2 aleatórios)
        $('#phone1').val(generatePhoneNumber());
        $('#phone2').val(generatePhoneNumber());

        // Localização
        $('#zipcode').val(person.location.postcode);
        $('#address').val(person.location.street.name);
        $('#number').val(rand(999) + 1);
        $('#neighborhood').val('Centro');
        $('#city').val(person.location.city);
        $('#state').val("SP"); // Mantendo SP conforme seu select

      } catch (error) {
        console.error(error);
        alert('Erro ao buscar dados externos. Verifique sua conexão.');
      } finally {
        // Restaura o botão
        btn.html('<i class="bi bi-magic"></i> Mock Data').prop('disabled', false);
      }
    });
  </script>
</body>

</html>
--- END_FILE: ..\admin\clientes\manage.php ---
------------------------------

--- START_FILE: ..\admin\clientes\table.php ---
<?php
require_once("../../conexao/conecta.php");
require_once("../../Components/Table.php");

$query = "SELECT id, cpf, nome 'name', telefone1 'phone1', sexo 'gender', data_nascimento 'birthDate', status FROM cliente";
$conditions = [];

if (!empty($_POST['name'])) $conditions[] = "nome LIKE '%".mysqli_real_escape_string($connection, $_POST['name'])."%'";
if (!empty($_POST['cpf'])) $conditions[] = "cpf LIKE '%".mysqli_real_escape_string($connection, $_POST['cpf'])."%'";
if (!empty($_POST['phone'])) $conditions[] = "telefone1 LIKE '%".mysqli_real_escape_string($connection, $_POST['phone'])."%'";
if (!empty($_POST["gender"])) $conditions[] = "sexo = '".$_POST["gender"]."'";
if (isset($_POST['status']) && $_POST['status'] !== "") $conditions[] = "status = " . (int)$_POST['status'];

if (!empty($conditions)) $query .= " WHERE " . implode(" AND ", $conditions);
$query .= " ORDER BY id ASC";

$result = mysqli_query($connection, $query);

echo Table::render([
  "#" => "id",
  "CPF" => "cpf",
  "Nome Completo" => "name",
  "Telefone" => "phone1",
  "Sexo" => "gender",
  "Nascimento" => "birthDate",
  "Status" => "status"
], $result, [
  "editUrl" => "manage.php?id=",
  "entity" => "clientes",
]);
--- END_FILE: ..\admin\clientes\table.php ---
------------------------------

--- START_FILE: ..\admin\funcionarios\actions.php ---
<?php 
    require_once('../../conexao/conecta.php');

    if (!isset($_SESSION)) { session_start(); }

    // Excluir
    if (isset($_POST["delete"])) {
        $id = (int)$_POST["delete"]; 

        try {
            $query = "DELETE FROM funcionario WHERE id = $id;";
            if (mysqli_query($connection, $query)) {
                $_SESSION['messageType'] = 'success';
                $_SESSION['messageText'] = "Sucesso: Funcionário excluído.";
            } else {
                throw new mysqli_sql_exception();
            }
        } catch (mysqli_sql_exception $e) {
            if ($e->getCode() == 1451) {
                $query = "SELECT COUNT(id) AS total FROM venda WHERE id_funcionario = $id";
                $result = mysqli_query($connection, $query);
                $totalCount = mysqli_fetch_assoc($result)['total'];

                $_SESSION['messageType'] = 'info';
                $_SESSION['messageText'] = "Falhou: Existem $totalCount vendas vinculadas a este funcionário.";
            } else {
                $_SESSION['messageType'] = 'error';
                $_SESSION['messageText'] = "Erro ao excluir funcionário.";
            }
        }
        header('Location: Index.php');
        exit;
    }

    // Cadastrar e Editar
    $id = isset($_POST['id']) ? (int)$_POST['id'] : 0;
    $isEditing = ($id > 0);

    // Coleta e Sanitização baseada no banco PT-BR
    $role = isset($_POST['role']) ? (int)$_POST['role'] : "NULL";
    $cpf = mysqli_real_escape_string($connection, $_POST['cpf']);
    $rg = mysqli_real_escape_string($connection, $_POST['rg']);
    $name = mysqli_real_escape_string($connection, $_POST["name"]);
    $socialName = mysqli_real_escape_string($connection, $_POST['socialName']);
    $password = mysqli_real_escape_string($connection, $_POST["password"]);
    $salary = !empty($_POST["salary"]) ? str_replace(['.', ','], ['', '.'], $_POST["salary"]) : 0;
    $gender = mysqli_real_escape_string($connection, $_POST["gender"]);
    $username = mysqli_real_escape_string($connection, $_POST["username"]);
    $maritalStatus = mysqli_real_escape_string($connection, $_POST['maritalStatus']);
    $birthDate = mysqli_real_escape_string($connection, $_POST['birthDate']);
    $accessType = mysqli_real_escape_string($connection, $_POST["accessType"]);
    $cellPhone = mysqli_real_escape_string($connection, $_POST["cellPhone"]);
    $messagesPhone = mysqli_real_escape_string($connection, $_POST['messagesPhone']);
    $homePhone = mysqli_real_escape_string($connection, $_POST['homePhone']);
    $address = mysqli_real_escape_string($connection, $_POST["address"]);
    $zipcode = mysqli_real_escape_string($connection, $_POST["zipcode"]);
    $number = mysqli_real_escape_string($connection, $_POST["number"]);
    $complement = mysqli_real_escape_string($connection, $_POST["complement"]);
    $neighborhood = mysqli_real_escape_string($connection, $_POST["neighborhood"]);
    $city = mysqli_real_escape_string($connection, $_POST["city"]);
    $state = mysqli_real_escape_string($connection, $_POST["state"]);
    $email = mysqli_real_escape_string($connection, $_POST['email']);
    $status = (int) ($_POST['status'] ?? 1);

    // Lógica da Foto
    $photoQuery = "";
    if (!empty($_FILES["photo"]['name'])) {
        $finalPhoto = time() . "_" . basename($_FILES["photo"]['name']);
        if (move_uploaded_file($_FILES["photo"]['tmp_name'], '../../images/' . $finalPhoto)) {
            $photoQuery = ", foto = '$finalPhoto'";
        }
    }

    if ($isEditing) {
        $query = "UPDATE funcionario SET 
            id_cargo = $role, cpf = '$cpf', rg = '$rg', nome = '$name', nome_social = '$socialName', 
            senha = '$password', salario = $salary, sexo = '$gender', usuario = '$username', 
            estado_civil = '$maritalStatus', data_nascimento = '$birthDate', tipo_acesso = '$accessType', 
            telefone_celular = '$cellPhone', telefone_recado = '$messagesPhone', telefone_residencial = '$homePhone', 
            endereco = '$address', cep = '$zipcode', numero = '$number', complemento = '$complement', 
            bairro = '$neighborhood', cidade = '$city', estado = '$state', email = '$email', status = $status $photoQuery 
            WHERE id = $id";
        $successMessage = "Funcionário atualizado!";
    } else {
        $photoEntry = isset($finalPhoto) ? $finalPhoto : 'placeholder-funcionario.png';
        $query = "INSERT INTO funcionario VALUES (
            0, $role, '$cpf', '$rg', '$name', '$socialName', '$password', $salary, 
            '$gender', '$username', '$maritalStatus', '$birthDate', '$accessType', 
            '$cellPhone', '$messagesPhone', '$homePhone', '$address', '$zipcode', 
            '$number', '$complement', '$neighborhood', '$city', '$state', '$email', 
            '$photoEntry', NOW(), 1
        )";
        $successMessage = "Funcionário cadastrado!";
    }

    try {
        if (mysqli_query($connection, $query)) {
            $_SESSION['messageType'] = 'success';
            $_SESSION['messageText'] = $successMessage;
        } else {
            throw new mysqli_sql_exception();
        }
    } catch (mysqli_sql_exception $e) {
        $_SESSION['messageType'] = 'error';
        $_SESSION['messageText'] = ($e->getCode() == 1062) ? "Erro: Usuário ou CPF duplicado." : "Erro ao processar funcionário.";
    }

    header('Location: Index.php');
    exit;
?>
--- END_FILE: ..\admin\funcionarios\actions.php ---
------------------------------

--- START_FILE: ..\admin\funcionarios\Index.php ---
<?php
if (!isset($_SESSION)) {
  session_start();
}

require_once("../../conexao/conecta.php");
require_once('../../Components/Sidebar.php');
?>
<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Carros Fácil - Gerenciar Funcionários</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <link rel="shortcut icon" href="../../assets/img/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="../../custom/css/style.css">
</head>

<body>

  <div class="container-fluid">
    <div class="row">
      <?php echo Sidebar("employee"); ?>

      <main class="col-lg-10">
        <header id="admin-header" class="py-3 d-flex align-items-center justify-content-between gap-2 px-3">
          <div id="left-info">GERENCIANDO - FUNCIONÁRIOS</div>
          <div id="right-info">
            <div id="current-time">AGORA</div>
          </div>
        </header>

        <hr class="m-0">

        <?php include('../Mensagem.php'); ?>

        <div class="container mt-3">
          <div class="card shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h4 class="m-0">Funcionários</h4>
              <a href="manage.php" class="btn btn-primary">
                <i class="bi bi-person-plus"></i> Adicionar
              </a>
            </div>

            <div class="card-body">
              <div class="row g-2">
                <div class="col-md-3">
                  <input onkeyup="applyFilters()" type="text" id="name-filter" class="form-control" placeholder="Nome do funcionário">
                </div>
                <div class="col-md-2">
                  <input onkeyup="applyFilters()" type="text" id="cpf-filter" class="form-control" placeholder="CPF" data-mask="000.000.000-00">
                </div>
                <div class="col-md-2">
                  <select onchange="applyFilters()" id="gender-filter" class="form-select">
                    <option value="">Sexo</option>
                    <option value="M">Masculino</option>
                    <option value="F">Feminino</option>
                    <option value="N">Não Informado</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <select onchange="applyFilters()" id="role-filter" class="form-select">
                    <option value="">Cargo</option>
                    <?php
                    $query = "SELECT id, nome FROM cargo WHERE status = 1";
                    $result = mysqli_execute_query($connection, $query);

                    foreach ($result as $role) {
                      echo '<option value="' . $role['id'] . '">' . $role['nome'] . '</option>';
                    }
                    ?>
                  </select>
                </div>
                <div class="col-md-2">
                  <select onchange="applyFilters()" id="status-filter" class="form-select">
                    <option value="">Status</option>
                    <option value="1">Ativo</option>
                    <option value="0">Inativo</option>
                  </select>
                </div>
              </div>
            </div>

            <div id="table-target">
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../../assets/js/jquery.mask.js"></script>
  <script src="../../assets/js/components/admin-header.js"></script>
  <script src="../../assets/js/components/sidebar.js"></script>

  <script>
    function applyFilters() {
      $.ajax({
        url: 'table.php',
        method: 'POST',
        data: {
          name: $("#name-filter").val(),
          cpf: $("#cpf-filter").val(),
          gender: $("#gender-filter").val(),
          role: $("#role-filter").val(),
          status: $("#status-filter").val()
        },
        success: function(response) {
          $("#table-target").html(response);
        }
      });
    }

    $(document).ready(function() {
      applyFilters();
    });
  </script>
</body>

</html>
--- END_FILE: ..\admin\funcionarios\Index.php ---
------------------------------

--- START_FILE: ..\admin\funcionarios\manage.php ---
<?php
if (!isset($_SESSION)) {
  session_start();
}
require_once("../../conexao/conecta.php");
require_once('../../Components/Sidebar.php');

$id = isset($_GET['id']) ? (int)$_GET['id'] : 0;
$employee = null;

if ($id > 0) {
  $query = "SELECT * FROM funcionario WHERE id = $id";
  $result = mysqli_query($connection, $query);
  $employee = mysqli_fetch_assoc($result);
}

$pageTitle = $employee ? "Editar: " . $employee['nome'] : "Novo Funcionário";
?>
<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Carros Fácil - <?php echo $pageTitle; ?></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="../../custom/css/style.css">
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <?php echo Sidebar("employee"); ?>

      <main class="col-lg-10 ms-sm-auto px-md-4">
        <header id="admin-header" class="py-2 d-flex align-items-center justify-content-between gap-2 px-3">
          <div id="left-info"><?php echo mb_strtoupper($pageTitle); ?></div>
          <div id="right-info">
            <button type="button" id="mock-funcionario" class="btn btn-warning btn-sm py-2">
              <i class="bi bi-magic"></i> Mock Data
            </button>
            <a href="Index.php" class="py-2 btn btn-outline-secondary btn-sm"><i class="bi bi-arrow-left"></i> Voltar</a>
          </div>
        </header>
        
        <hr class="m-0 mb-4">

        <div class="container-fluid p-0">
          <form id="form-funcionario" action="actions.php" method="post" enctype="multipart/form-data">
            <input type="hidden" name="id" value="<?php echo $id; ?>">

            <div class="row g-4 mb-4">
              <div class="col-lg-8">
                <div class="card shadow-sm h-100">
                  <div class="card-header bg-light"><strong>Informações Pessoais</strong></div>
                  <div class="card-body row g-3">
                    <div class="col-md-7">
                      <label class="form-label">Nome Completo</label>
                      <input maxlength="80" type="text" name="name" class="form-control" value="<?php echo $employee['nome'] ?? ''; ?>" required>
                    </div>
                    <div class="col-md-5">
                      <label class="form-label">Nome Social</label>
                      <input maxlength="80" type="text" name="socialName" class="form-control" value="<?php echo $employee['nome_social'] ?? ''; ?>">
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">CPF</label>
                      <input maxlength="14" type="text" name="cpf" class="form-control" data-mask="000.000.000-00" value="<?php echo $employee['cpf'] ?? ''; ?>" required>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">RG</label>
                      <input maxlength="12" type="text" name="rg" class="form-control" data-mask="00.000.000-A" value="<?php echo $employee['rg'] ?? ''; ?>">
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Nascimento</label>
                      <input type="date" name="birthDate" class="form-control" value="<?php echo $employee['data_nascimento'] ?? ''; ?>" required>
                    </div>
                    <div class="col-3">
                      <label class="form-label">Salário (R$)</label>
                      <input maxlength="13" type="text" name="salary" class="form-control" data-mask="#.##0,00" data-mask-reverse="true" value="<?php echo $employee['salario'] ?? ''; ?>">
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Sexo</label>
                      <select name="gender" class="form-select">
                        <option value="N" <?php if (($employee['sexo'] ?? '') == 'N') echo 'selected'; ?>>Não Informado</option>
                        <option value="M" <?php if (($employee['sexo'] ?? '') == 'M') echo 'selected'; ?>>Masculino</option>
                        <option value="F" <?php if (($employee['sexo'] ?? '') == 'F') echo 'selected'; ?>>Feminino</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Estado Civil</label>
                      <select name="maritalStatus" id="maritalStatus" class="form-select">
                        <?php
                        $maritalStatusItems = ["Solteiro(a)", "Casado(a)", "Separado(a)", "Divorciado(a)", "Viúvo(a)"];
                        foreach ($maritalStatusItems as $maritalStatusItem) {
                          $selected = ($employee && $employee['estado_civil'] == $maritalStatusItem) ? 'selected' : '';
                          echo "<option value='$maritalStatusItem' $selected>$maritalStatusItem</option>";
                        }
                        ?>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Cargo</label>
                      <select name="role" id="role-select" class="form-select">
                        <option value="" disabled <?= empty($employee['id_cargo']) ? "selected" : "" ?>>Selecione um cargo</option>
                        <?php
                        $roles = mysqli_query($connection, "SELECT id, nome FROM cargo WHERE status = 1");
                        foreach ($roles as $role) {
                          $selectedAttr = $employee && $employee['id_cargo'] == $role['id'] ? 'selected' : '';
                          echo "<option value='{$role['id']}' $selectedAttr>{$role['nome']}</option>";
                        }
                        ?>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-lg-4">
                <div class="card shadow-sm h-100">
                  <div class="card-header bg-light"><strong>Foto de Perfil</strong></div>
                  <div class="card-body d-flex flex-column text-center">
                    <div class="flex-grow-1 d-flex align-items-center justify-content-center">
                      <img id="preview-photo" src="<?php echo ($employee && $employee['foto']) ? '../../images/' . $employee['foto'] : '../../assets/img/placeholder-funcionario.png'; ?>" class="img-fluid rounded border shadow-sm" style="max-height: 180px;">
                    </div>
                    <div class="mt-3">
                      <input type="file" name="photo" class="form-control form-control-sm" accept="image/*" onchange="previewImage(this)">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="row g-4 mb-4">
              <div class="col-lg-8">
                <div class="card shadow-sm h-100">
                  <div class="card-header bg-light"><strong>Endereço</strong></div>
                  <div class="card-body row g-3">
                    <div class="col-md-3">
                      <label class="form-label">CEP</label>
                      <input maxlength="9" type="text" name="zipcode" class="form-control" data-mask="00000-000" value="<?php echo $employee['cep'] ?? ''; ?>">
                    </div>
                    <div class="col-md-7">
                      <label class="form-label">Endereço</label>
                      <input maxlength="60" type="text" name="address" class="form-control" value="<?php echo $employee['endereco'] ?? ''; ?>" required>
                    </div>
                    <div class="col-md-2">
                      <label class="form-label">Número</label>
                      <input type="text" name="number" class="form-control" data-mask="####0" value="<?php echo $employee['numero'] ?? ''; ?>" required>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Complemento</label>
                      <input maxlength="200" type="text" name="complement" class="form-control" value="<?php echo $employee['complemento'] ?? ''; ?>">
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Bairro</label>
                      <input maxlength="50" type="text" name="neighborhood" class="form-control" value="<?php echo $employee['bairro'] ?? ''; ?>" required>
                    </div>
                    <div class="col-md-8">
                      <label class="form-label">Cidade</label>
                      <input maxlength="50" type="text" name="city" class="form-control" value="<?php echo $employee['cidade'] ?? ''; ?>" required>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Estado <span class="text-danger">*</span></label>
                      <select name="state" id="state" class="form-select" required>
                        <option value="" disabled <?= empty($employee['estado']) ? "selected" : "" ?>>Selecione um estado</option>
                        <option value="AC" <?= $employee && $employee['estado'] == 'AC' ? "selected" : "" ?>>Acre</option>
                        <option value="AL" <?= $employee && $employee['estado'] == 'AL' ? "selected" : "" ?>>Alagoas</option>
                        <option value="AP" <?= $employee && $employee['estado'] == 'AP' ? "selected" : "" ?>>Amapá</option>
                        <option value="AM" <?= $employee && $employee['estado'] == 'AM' ? "selected" : "" ?>>Amazonas</option>
                        <option value="BA" <?= $employee && $employee['estado'] == 'BA' ? "selected" : "" ?>>Bahia</option>
                        <option value="CE" <?= $employee && $employee['estado'] == 'CE' ? "selected" : "" ?>>Ceará</option>
                        <option value="DF" <?= $employee && $employee['estado'] == 'DF' ? "selected" : "" ?>>Distrito Federal</option>
                        <option value="ES" <?= $employee && $employee['estado'] == 'ES' ? "selected" : "" ?>>Espírito Santo</option>
                        <option value="GO" <?= $employee && $employee['estado'] == 'GO' ? "selected" : "" ?>>Goiás</option>
                        <option value="MA" <?= $employee && $employee['estado'] == 'MA' ? "selected" : "" ?>>Maranhão</option>
                        <option value="MT" <?= $employee && $employee['estado'] == 'MT' ? "selected" : "" ?>>Mato Grosso</option>
                        <option value="MS" <?= $employee && $employee['estado'] == 'MS' ? "selected" : "" ?>>Mato Grosso do Sul</option>
                        <option value="MG" <?= $employee && $employee['estado'] == 'MG' ? "selected" : "" ?>>Minas Gerais</option>
                        <option value="PA" <?= $employee && $employee['estado'] == 'PA' ? "selected" : "" ?>>Pará</option>
                        <option value="PB" <?= $employee && $employee['estado'] == 'PB' ? "selected" : "" ?>>Paraíba</option>
                        <option value="PR" <?= $employee && $employee['estado'] == 'PR' ? "selected" : "" ?>>Paraná</option>
                        <option value="PE" <?= $employee && $employee['estado'] == 'PE' ? "selected" : "" ?>>Pernambuco</option>
                        <option value="PI" <?= $employee && $employee['estado'] == 'PI' ? "selected" : "" ?>>Piauí</option>
                        <option value="RJ" <?= $employee && $employee['estado'] == 'RJ' ? "selected" : "" ?>>Rio de Janeiro</option>
                        <option value="RN" <?= $employee && $employee['estado'] == 'RN' ? "selected" : "" ?>>Rio Grande do Norte</option>
                        <option value="RS" <?= $employee && $employee['estado'] == 'RS' ? "selected" : "" ?>>Rio Grande do Sul</option>
                        <option value="RO" <?= $employee && $employee['estado'] == 'RO' ? "selected" : "" ?>>Rondônia</option>
                        <option value="RR" <?= $employee && $employee['estado'] == 'RR' ? "selected" : "" ?>>Roraima</option>
                        <option value="SC" <?= $employee && $employee['estado'] == 'SC' ? "selected" : "" ?>>Santa Catarina</option>
                        <option value="SP" <?= $employee && $employee['estado'] == 'SP' ? "selected" : "" ?>>São Paulo</option>
                        <option value="SE" <?= $employee && $employee['estado'] == 'SE' ? "selected" : "" ?>>Sergipe</option>
                        <option value="TO" <?= $employee && $employee['estado'] == 'TO' ? "selected" : "" ?>>Tocantins</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-lg-4">
                <div class="card shadow-sm h-100">
                  <div class="card-header bg-light"><strong>Dados de Acesso</strong></div>
                  <div class="card-body row g-3">
                    <div class="col-12">
                      <label class="form-label">Usuário</label>
                      <input maxlength="20" type="text" name="username" class="form-control" value="<?php echo $employee["usuario"] ?? ''; ?>" required>
                    </div>
                    <div class="col-12">
                      <label class="form-label">Senha</label>
                      <input maxlength="255" type="password" name="password" class="form-control" value="<?php echo $employee["senha"] ?? ''; ?>" required>
                    </div>
                    <div class="col-12">
                      <label class="form-label">Tipo de Acesso</label>
                      <select name="accessType" class="form-select" required>
                        <option value="0" <?php if (($employee['tipo_acesso'] ?? '') == 0) echo 'selected'; ?>>Comum</option>
                        <option value="1" <?php if (($employee['tipo_acesso'] ?? '') == 1) echo 'selected'; ?>>Administrador</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="row g-4 mb-4">
              <div class="col-lg-8">
                <div class="card shadow-sm">
                  <div class="card-header bg-light"><strong>Canais de Contato</strong></div>
                  <div class="card-body row g-3">
                    <div class="col-md-6">
                      <label class="form-label">E-mail</label>
                      <input maxlength="120" type="email" name="email" class="form-control" value="<?php echo $employee['email'] ?? ''; ?>">
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Telefone Celular</label>
                      <input minlength="15" type="text" name="cellPhone" class="form-control" data-mask="(00) 00000-0000" value="<?php echo $employee['telefone_celular'] ?? ''; ?>">
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Telefone Residencial</label>
                      <input minlength="14" type="text" name="homePhone" class="form-control" data-mask="(00) 0000-0000" value="<?php echo $employee['telefone_residencial'] ?? ''; ?>">
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Telefone Recado (Obrigatório)</label>
                      <input type="text" name="messagesPhone" class="form-control"
                        data-mask="(00) 00000-0000"
                        pattern="\(\d{2}\)\s\d{5}-\d{4}"
                        title="Formato esperado: (00) 00000-0000"
                        value="<?php echo $employee['telefone_recado'] ?? ''; ?>" required>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-lg-4">
                <div class="card shadow-sm h-100">
                  <div class="card-header bg-light"><strong>Status do Cadastro</strong></div>
                  <div class="card-body">
                    <label class="form-label">Código</label>
                    <input disabled class="form-control" type="text" value="<?= $employee ? $employee['id'] : '' ?>">

                    <label class="form-label mt-3">Status</label>
                    <select <?= !$employee ? "disabled" : "" ?> name="status" class="form-select">
                      <option value="1" <?= $employee && $employee['status'] == 1 ? 'selected' : ''; ?>>Ativo</option>
                      <option value="0" <?= $employee && $employee['status'] == 0 ? 'selected' : ''; ?>>Inativo</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-12 mb-5">
                <button type="submit" name="actionSave" class="btn btn-primary w-100 py-3 shadow">
                  <i class="bi bi-save"></i> Salvar Registro do Funcionário
                </button>
              </div>
            </div>
          </form>
        </div>
      </main>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="../../assets/js/jquery.mask.js"></script>
  <script src="../../assets/js/components/sidebar.js"></script>
  <script>
    function previewImage(input) {
      if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
          $('#preview-photo').attr('src', e.target.result);
        }
        reader.readAsDataURL(input.files[0]);
      }
    }

    $('#mock-funcionario').on('click', async function() {
      const btn = $(this);
      const originalHtml = btn.html();
      btn.html('<span class="spinner-border spinner-border-sm"></span> Carregando...').prop('disabled', true);

      // Mapeamento de Estados para bater com o Select (API retorna nome completo)
      const stateMap = {
        "acre": "AC",
        "alagoas": "AL",
        "amapá": "AP",
        "amazonas": "AM",
        "bahia": "BA",
        "ceará": "CE",
        "distrito federal": "DF",
        "espírito santo": "ES",
        "goiás": "GO",
        "maranhão": "MA",
        "mato grosso": "MT",
        "mato grosso do sul": "MS",
        "minas gerais": "MG",
        "pará": "PA",
        "paraíba": "PB",
        "paraná": "PR",
        "pernambuco": "PE",
        "piauí": "PI",
        "rio de janeiro": "RJ",
        "rio grande do norte": "RN",
        "rio grande do sul": "RS",
        "rondônia": "RO",
        "roraima": "RR",
        "santa catarina": "SC",
        "são paulo": "SP",
        "sergipe": "SE",
        "tocantins": "TO"
      };

      try {
        const response = await fetch('https://randomuser.me/api/?nat=br');
        const data = await response.json();
        const p = data.results[0];
        const rand = (n) => Math.floor(Math.random() * n);

        // Dados Básicos
        $('input[name="name"]').val(`${p.name.first} ${p.name.last}`);
        $('input[name="socialName"]').val(p.name.first);
        $('input[name="cpf"]').val(`${rand(899)+100}${rand(899)+100}${rand(899)+100}${rand(89)+10}`).trigger('input');
        $('input[name="rg"]').val(`${rand(89)}${rand(899)+100}${rand(899)+100}${rand(9)}`).trigger('input');
        $('input[name="birthDate"]').val(new Date(p.dob.date).toISOString().split('T')[0]);

        // Login e Financeiro
        $('input[name="username"]').val(p.login.username);
        $('input[name="password"]').val('Senha@123');
        $('input[name="salary"]').val((Math.random() * 5000 + 1500).toFixed(2).replace('.', ',')).trigger('input');

        // Endereço
        $('input[name="zipcode"]').val(p.location.postcode).trigger('input');
        $('input[name="address"]').val(p.location.street.name);
        $('input[name="number"]').val(p.location.street.number);
        $('input[name="neighborhood"]').val('Centro');
        $('input[name="city"]').val(p.location.city);

        // Trata o Select de Estado
        const stateSigla = stateMap[p.location.state.toLowerCase()];
        if (stateSigla) $('select[name="state"]').val(stateSigla);

        // Contatos
        $('input[name="email"]').val(p.email);
        // Limpa caracteres não numéricos antes de disparar a máscara
        $('input[name="cellPhone"]').val(p.cell.replace(/\D/g, '')).trigger('input');
        $('input[name="messagesPhone"]').val(p.phone.replace(/\D/g, '')).trigger('input');

        // Foto
        $('#preview-photo').attr('src', p.picture.large);

      } catch (e) {
        alert('Erro ao gerar dados. Verifique sua conexão.');
      } finally {
        btn.html(originalHtml).prop('disabled', false);
      }
    });
  </script>
</body>

</html>
--- END_FILE: ..\admin\funcionarios\manage.php ---
------------------------------

--- START_FILE: ..\admin\funcionarios\table.php ---
<?php
require_once("../../conexao/conecta.php");
require_once("../../Components/Table.php");

$query = "SELECT f.id, f.nome 'name', c.nome 'role', f.cpf, f.salario, f.tipo_acesso 'accessType', f.data_cadastro 'createdAt', f.status
        FROM funcionario f
        LEFT JOIN cargo c ON c.id = f.id_cargo";

$conditions = [];
if (!empty($_POST["name"])) $conditions[] = "f.nome LIKE '%" . mysqli_real_escape_string($connection, $_POST["name"]) . "%'";
if (!empty($_POST['cpf'])) $conditions[] = "f.cpf = '" . mysqli_real_escape_string($connection, $_POST['cpf']) . "'";
if (!empty($_POST["gender"])) $conditions[] = "f.sexo = '" . $_POST["gender"] . "'";
if (!empty($_POST['role'])) $conditions[] = "f.id_cargo = '" . $_POST['role'] . "'";

if (isset($_POST['status']) && $_POST['status'] !== "") $conditions[] = "f.status = " . (int)$_POST['status'];
if (!empty($conditions)) $query .= " WHERE " . implode(" AND ", $conditions);

$result = mysqli_query($connection, $query);
echo Table::render([
  "#" => "id",
  "Nome" => "name",
  "Cargo" => "role",
  "CPF" => "cpf",
  "Tipo Acesso" => "accessType",
  "Cadastro" => "createdAt",
  "Status" => "status"
], $result, [
  "editUrl" => "manage.php?id=",
  "entity" => "funcionarios"
]);

--- END_FILE: ..\admin\funcionarios\table.php ---
------------------------------

--- START_FILE: ..\admin\marcas\actions.php ---
<?php 
    require_once('../../conexao/conecta.php');

    if (!isset($_SESSION)) { session_start(); }

    // Excluir
    if (isset($_POST["delete"])) {
        $id = (int)$_POST["delete"]; 

        try {
            $query = "DELETE FROM marca WHERE id = $id;";
            if (mysqli_query($connection, $query)) {
                $_SESSION['messageType'] = 'success';
                $_SESSION['messageText'] = "Sucesso: Marca removida com sucesso.";
            } else {
                throw new mysqli_sql_exception();
            }
        } catch (mysqli_sql_exception $e) {
            if ($e->getCode() == 1451) {
                $query = "SELECT COUNT(id) AS total FROM modelo WHERE id_marca = $id";
                $result = mysqli_query($connection, $query);
                $totalCount = mysqli_fetch_assoc($result)['total'];

                $_SESSION['messageType'] = 'info';
                $_SESSION['messageText'] = "Falhou: Existem $totalCount modelos vinculados nessa marca.";
            } else {
                $_SESSION['messageType'] = 'error';
                $_SESSION['messageText'] = "Erro: Não foi possível excluir a marca.";
            }
        }
        header('Location: Index.php');
        exit;
    }

    // Cadastrar e Editar
    $id = isset($_POST['id']) ? (int)$_POST['id'] : 0;
    $isEditing = ($id > 0);

    $name = mysqli_real_escape_string($connection, $_POST['name']);
    $observation = mysqli_real_escape_string($connection, $_POST['observation']);
    $status = isset($_POST['status']) ? (int)$_POST['status'] : 1;

    if ($isEditing) {
        $query = "UPDATE marca SET nome = '$name', observacao = '$observation', status = $status WHERE id = $id";
        $successMessage = "Marca atualizada com sucesso!";
    } else {
        $query = "INSERT INTO marca VALUES (0, '$name', '$observation', NOW(), 1);";
        $successMessage = "Marca cadastrada com sucesso!";
    }

    if (mysqli_query($connection, $query)) {
        $_SESSION['messageType'] = 'success';
        $_SESSION['messageText'] = 'Sucesso: '. $successMessage;
    } else {
        $_SESSION['messageType'] = 'error';
        $_SESSION['messageText'] = "Erro: Não foi possível salvar a marca, tente novamente.";
    }

    header('Location: Index.php');
    exit;
?>
--- END_FILE: ..\admin\marcas\actions.php ---
------------------------------

--- START_FILE: ..\admin\marcas\Index.php ---
<?php
if (!isset($_SESSION)) {
  session_start();
}

require_once("../../conexao/conecta.php");
require_once("../../Components/FormModal.php");
require_once("../../Components/Table.php");
require_once('../../Components/Sidebar.php');
?>
<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Carros Fácil - Painel</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

  <link rel="shortcut icon" href="../../assets/img/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="../../custom/css/style.css">
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <?php echo Sidebar("brand"); ?>

      <main class="col-lg-10">
        <header id="admin-header" class="py-3 d-flex align-items-center justify-content-between gap-2 px-3">
          <div id="left-info">GERENCIANDO - MARCAS</div>
          <div id="right-info">
            <div id="current-time">AGORA</div>
          </div>
        </header>

        <hr class="m-0">

        <?php include('../Mensagem.php'); ?>

        <div class="container mt-3">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h4 class="m-0">Marcas de Veículos</h4>
              <button type="button" class="btn btn-primary" data-entity="marcas" data-bs-toggle="modal" data-bs-target="#marcasModal">
                <i class="bi bi-plus-lg"></i> Adicionar
              </button>
            </div>

            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-2">
                  <input onkeyup="applyFilters()" type="text" name="id-filter" id="id-filter" class="form-control" placeholder="Filtrar por código">
                </div>
                <div class="col-md-7">
                  <input onkeyup="applyFilters()" type="text" name="name-filter" id="name-filter" class="form-control" placeholder="Filtrar por marca">
                </div>
                <div class="col-md-3">
                  <select onchange="applyFilters()" name="status-filter" id="status-filter" class="form-control">
                    <option value="">Status</option>
                    <option value="1">Ativo</option>
                    <option value="0">Inativo</option>
                  </select>
                </div>
              </div>
            </div>

            <div id="table-target">
                <?php
                // Listagem inicial
                $query = "SELECT id, nome 'name', observacao 'observation', data_cadastro 'createdAt', status FROM marca";
                $result = mysqli_query($connection, $query);
                
                echo Table::render([
                  "#" => "id",
                  "Nome" => "name",
                  "Observação" => "observation",
                  "Cadastro" => "createdAt",
                  "Status" => "status"
                ], $result, [
                  "entity" => "marcas",
                  "modalTarget" => "#marcasModal"
                ]);
                ?>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <?php
  // Criação do Modal usando o Componente
  echo FormModal::create([
    "modalId" => "marcasModal",
    "actionUrl" => "./actions.php",
    "submitButton" => '<button type="submit" class="btn btn-primary w-100">Salvar Marca</button>'
  ], [
    ["id" => "name", "optional" => false, "label" => "Nome da Marca", "type" => "text", "length" => 80],
    ["id" => "observation", "optional" => true, "label" => "Observação", "type" => "text", "length" => 250],
    ["id" => "status", "optional" => false, "label" => "Status", "type" => "select", "options" => [
      ["label" => "Desativado", "value" => 0],
      ["label" => "Ativado", "value" => 1],
    ]]
  ]);
  ?>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script src="../../assets/js/components/form-modal.js"></script>
  <script src="../../assets/js/components/admin-header.js"></script>
  <script src="../../assets/js/components/sidebar.js"></script>

  <script>
    function updateTableWithFilters(id, name, status) {
      $.ajax({
        url: 'table.php',
        method: 'POST',
        data: { id, name, status },
        success: function(response) {
          $("#table-target").html(response);
        }
      });
    }

    function applyFilters() {
      updateTableWithFilters($("#id-filter").val(), $("#name-filter").val(), $("#status-filter").val());
    }

    $(document).ready(function() {
      // Carrega a tabela com filtros vazios ao iniciar
      applyFilters();
    });
  </script>
</body>
</html>
--- END_FILE: ..\admin\marcas\Index.php ---
------------------------------

--- START_FILE: ..\admin\marcas\table.php ---
<?php
require_once("../../conexao/conecta.php");
require_once("../../Components/Table.php");

$query = "SELECT id, nome 'name', observacao 'observation', data_cadastro 'createdAt', status FROM marca";

$id = (int) $_POST['id'] ?? 0;
$name = $_POST["name"] ?? "";
$status = $_POST['status'] ?? "";
$conditions = [];

if ($id > 0) {
    $id = mysqli_real_escape_string($connection, $id);
    $conditions[] = "id = '$id'";
}

if ($name !== "") {
    $name = mysqli_real_escape_string($connection, $name);
    $conditions[] = "nome LIKE '%$name%'";
}

if ($status !== "") {
    $conditions[] = "status = " . (int)$status;
}

if (!empty($conditions)) {
    $query .= " WHERE " . implode(" AND ", $conditions);
}

$result = mysqli_query($connection, $query);

// Renderiza a tabela usando o componente padrão
echo Table::render([
  "#" => "id",
  "Nome" => "name",
  "Observação" => "observation",
  "Cadastro" => "createdAt",
  "Status" => "status"
], $result, [
  "entity" => "marcas",
  "modalTarget" => "#marcasModal"
]);
--- END_FILE: ..\admin\marcas\table.php ---
------------------------------

--- START_FILE: ..\admin\modelos\actions.php ---
<?php 
    require_once('../../conexao/conecta.php');

    if (!isset($_SESSION)) { session_start(); }

    // Excluir
    if (isset($_POST["delete"])) {
        $id = (int)$_POST["delete"]; 

        try {
            $query = "DELETE FROM modelo WHERE id = $id;";
            if (mysqli_query($connection, $query)) {
                $_SESSION['messageType'] = 'success';
                $_SESSION['messageText'] = "Sucesso: O modelo foi removido.";
            } else {
                throw new mysqli_sql_exception();
            }
        } catch (mysqli_sql_exception $e) {
            if ($e->getCode() == 1451) {
                $query = "SELECT COUNT(id) AS total FROM veiculo WHERE id_modelo = $id";
                $result = mysqli_query($connection, $query);
                $totalCount = mysqli_fetch_assoc($result)['total'];

                $_SESSION['messageType'] = 'info';
                $_SESSION['messageText'] = "Falhou: Existem $totalCount veículos vinculados a este modelo.";
            } else {
                $_SESSION['messageType'] = 'error';
                $_SESSION['messageText'] = "Erro: Não foi possível excluir o modelo.";
            }
        }
        header('Location: Index.php');
        exit;
    }

    // Cadastrar e Editar
    $id = isset($_POST['id']) ? (int)$_POST['id'] : 0;
    $isEditing = ($id > 0);

    $brandId = (int)$_POST['id_marca'];
    $name = mysqli_real_escape_string($connection, $_POST['name']);
    $observation = mysqli_real_escape_string($connection, $_POST['observation']);
    $status = isset($_POST['status']) ? (int)$_POST['status'] : 1;

    if ($isEditing) {
        $query = "UPDATE modelo SET id_marca = $brandId, nome = '$name', observacao = '$observation', status = $status WHERE id = $id";
        $successMessage = "Modelo atualizado com sucesso!";
    } else {
        $query = "INSERT INTO modelo VALUES (0, $brandId, '$name', '$observation', NOW(), 1);";
        $successMessage = "Modelo cadastrado com sucesso!";
    }

    if (mysqli_query($connection, $query)) {
        $_SESSION['messageType'] = 'success';
        $_SESSION['messageText'] = 'Sucesso: '. $successMessage;
    } else {
        $_SESSION['messageType'] = 'error';
        $_SESSION['messageText'] = "Erro: Não foi possível salvar os dados, tente novamente.";
    }

    header('Location: Index.php');
    exit;
?>
--- END_FILE: ..\admin\modelos\actions.php ---
------------------------------

--- START_FILE: ..\admin\modelos\Index.php ---
<?php
if (!isset($_SESSION)) {
  session_start();
}

require_once("../../conexao/conecta.php");
require_once("../../Components/FormModal.php");
require_once("../../Components/Table.php");
require_once('../../Components/Sidebar.php');

// Buscamos as marcas ativas para popular o select do modal de cadastro/edição
$queryMarcas = "SELECT id, nome FROM marca WHERE status = 1 ORDER BY nome ASC";
$resultMarcas = mysqli_query($connection, $queryMarcas);
$marcasOptions = [];

while ($marca = mysqli_fetch_assoc($resultMarcas)) {
    $marcasOptions[] = ["label" => $marca['nome'], "value" => $marca['id']];
}
?>
<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Carros Fácil - Painel</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

  <link rel="shortcut icon" href="../../assets/img/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="../../custom/css/style.css">
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <?php echo Sidebar("model"); ?>

      <main class="col-lg-10">
        <header id="admin-header" class="py-3 d-flex align-items-center justify-content-between gap-2 px-3">
          <div id="left-info">GERENCIANDO - MODELOS</div>
          <div id="right-info">
            <div id="current-time">AGORA</div>
          </div>
        </header>

        <hr class="m-0">

        <?php include('../Mensagem.php'); ?>

        <div class="container mt-3">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h4 class="m-0">Modelos de Veículos</h4>
              <button type="button" class="btn btn-primary" data-entity="modelos" data-bs-toggle="modal" data-bs-target="#modelosModal">
                <i class="bi bi-plus-lg"></i> Adicionar
              </button>
            </div>

            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-2">
                  <input onkeyup="applyFilters()" type="text" id="id-filter" class="form-control" placeholder="Filtrar por código">
                </div>
                <div class="col-md-4">
                  <input onkeyup="applyFilters()" type="text" id="brand-filter" class="form-control" placeholder="Filtrar por Marca">
                </div>
                <div class="col-md-4">
                  <input onkeyup="applyFilters()" type="text" id="model-filter" class="form-control" placeholder="Filtrar por Modelo">
                </div>
                <div class="col-md-2">
                  <select onchange="applyFilters()" id="status-filter" class="form-control">
                    <option value="">Status</option>
                    <option value="1">Ativo</option>
                    <option value="0">Inativo</option>
                  </select>
                </div>
              </div>
            </div>

            <div id="table-target">
              </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <?php
  // Renderização do Modal de Modelos
  echo FormModal::create([
    "modalId" => "modelosModal",
    "actionUrl" => "./actions.php",
    "submitButton" => '<button type="submit" class="btn btn-primary w-100">Salvar Modelo</button>'
  ], [
    ["id" => "id_marca", "optional" => false, "label" => "Marca do Veículo", "type" => "select", "options" => $marcasOptions],
    ["id" => "name", "optional" => false, "label" => "Nome do Modelo", "type" => "text", "length" => 80],
    ["id" => "observation", "optional" => true, "label" => "Observação", "type" => "text", "length" => 250],
    ["id" => "status", "optional" => false, "label" => "Status", "type" => "select", "options" => [
      ["label" => "Inativo", "value" => 0],
      ["label" => "Ativo", "value" => 1],
    ]]
  ]);
  ?>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script src="../../assets/js/components/form-modal.js"></script>
  <script src="../../assets/js/components/admin-header.js"></script>
  <script src="../../assets/js/components/sidebar.js"></script>

  <script>
    function updateTableWithFilters(id, nameBrand, nameModel, status) {
      $.ajax({
        url: 'table.php',
        method: 'POST',
        data: { id, nameBrand, nameModel, status },
        success: function(response) {
          $("#table-target").html(response);
        }
      });
    }

    function applyFilters() {
      updateTableWithFilters(
        $("#id-filter").val(),
        $("#brand-filter").val(),
        $("#model-filter").val(),
        $("#status-filter").val()
      );
    }

    $(document).ready(function() {
      applyFilters();
    });
  </script>
</body>
</html>
--- END_FILE: ..\admin\modelos\Index.php ---
------------------------------

--- START_FILE: ..\admin\modelos\table.php ---
<?php
require_once("../../conexao/conecta.php");
require_once("../../Components/Table.php");

// Query base com Join para trazer o nome da marca
$query = "SELECT m.id, ma.nome 'nameBrand', m.nome 'name', m.observacao 'observation', m.status, m.id_marca 
        FROM modelo m 
        INNER JOIN marca ma ON m.id_marca = ma.id";

$id = (int) $_POST['id'] ?? 0;
$nameBrand = $_POST['nameBrand'] ?? "";
$nameModel = $_POST['nameModel'] ?? "";
$status = $_POST['status'] ?? "";
$conditions = [];

if ($id > 0) {
    $id = mysqli_real_escape_string($connection, $id);
    $conditions[] = "m.id = '$id'";
}

if ($nameBrand !== "") {
    $nameBrand = mysqli_real_escape_string($connection, $nameBrand);
    $conditions[] = "ma.nome LIKE '%$nameBrand%'";
}

if ($nameModel !== "") {
    $nameModel = mysqli_real_escape_string($connection, $nameModel);
    $conditions[] = "m.nome LIKE '%$nameModel%'";
}

if ($status !== "") {
    $conditions[] = "m.status = " . (int)$status;
}

if (!empty($conditions)) {
    $query .= " WHERE " . implode(" AND ", $conditions);
}

$query .= " ORDER BY ma.nome ASC, m.nome ASC";
$result = mysqli_query($connection, $query);

// Renderização utilizando o novo componente de Tabela
echo Table::render([
  "#" => "id",
  "Marca" => "nameBrand",
  "Modelo" => "name",
  "Observação" => "observation",
  "Status" => "status"
], $result, [
  "entity" => "modelos",
  "modalTarget" => "#modelosModal"
]);
--- END_FILE: ..\admin\modelos\table.php ---
------------------------------

--- START_FILE: ..\admin\veiculos\actions.php ---
<?php
require_once('../../conexao/conecta.php');

if (!isset($_SESSION)) {
    session_start();
}

// Excluir
if (isset($_POST["delete"])) {
    $id = (int)$_POST["delete"];

    $salesCheck = mysqli_query($connection, "SELECT id FROM item_venda WHERE id_veiculo = $id");
    $salesCount = mysqli_num_rows($salesCheck);

    if (mysqli_num_rows($salesCheck) > 0) {
        $_SESSION['messageType'] = 'info';
        $_SESSION['messageText'] = "Impossível excluir: O veículo possui $salesCount vendas vinculadas.";
    } else {
        mysqli_query($connection, "DELETE FROM foto_veiculo WHERE id_veiculo = $id");
        mysqli_query($connection, "DELETE FROM caracteristica_carro WHERE id_veiculo = $id");

        $deleteVehicleQuery = "DELETE FROM veiculo WHERE id = $id";

        if (mysqli_query($connection, $deleteVehicleQuery)) {
            $_SESSION['messageType'] = 'success';
            $_SESSION['messageText'] = "Veículo removido com sucesso.";
        } else {
            $_SESSION['messageType'] = 'error';
            $_SESSION['messageText'] = "Erro ao processar a exclusão do veículo.";
        }
    }

    header('Location: Index.php');
    exit;
}

// Cadastrar e Editar
$id = isset($_POST['id']) ? (int)$_POST['id'] : 0;
$isEditing = ($id > 0);

// Mapeamento de variáveis do formulário manage.php
$id_model = (int)$_POST['model'];
$category = mysqli_real_escape_string($connection, $_POST["category"]);
$condition = mysqli_real_escape_string($connection, $_POST["condition"]);
$usageTime = (int)$_POST["usageTime"];
$year = (int)$_POST["year"];
$mileage = (int)$_POST["mileage"];
$transmissionType = mysqli_real_escape_string($connection, $_POST["transmissionType"]);
$fuelType = mysqli_real_escape_string($connection, $_POST["fuelType"]);
$description = mysqli_real_escape_string($connection, $_POST["description"]);
$profit = (int)$_POST["expected_profit"];
$discount = (int)$_POST["discount"];
$hasDiscount = ($discount > 0) ? 1 : 0;
$costPrice = str_replace(['.', ','], ['', '.'], $_POST["costPrice"]);
$sellPrice = str_replace(['.', ','], ['', '.'], $_POST["sellPrice"]);
$discountPrice = str_replace(['.', ','], ['', '.'], $_POST["discountPrice"]);
$stock = (int)$_POST["stock"];
$color = mysqli_real_escape_string($connection, $_POST["color"]);

$mainPhoto = "default.png";
if (!empty($_FILES['photo_1']['name'])) {
    $mainPhoto = time() . "_1_" . basename($_FILES['photo_1']['name']);
    move_uploaded_file($_FILES['photo_1']['tmp_name'], "../../images/" . $mainPhoto);
}

if ($isEditing) {
    $query = "UPDATE veiculo SET 
            id_modelo = $id_model, 
            categoria = '$category', 
            estado_do_veiculo = '$condition', 
            tempo_de_uso = $usageTime, 
            preco_custo = '$costPrice', 
            preco_venda = '$sellPrice', 
            preco_desconto = '$discountPrice', 
            desconto = $discount, 
            tem_desconto = $hasDiscount, 
            lucro = $profit, 
            quilometragem = $mileage, 
            cor = '$color', 
            descricao = '$description', 
            ano = $year, 
            tipo_cambio = '$transmissionType', 
            tipo_combustivel = '$fuelType', 
            estoque = $stock" .
        (!empty($_FILES['photo_1']['name']) ? ", foto='$mainPhoto'" : "") . " 
            WHERE id = $id";

    $successMessage = "Veículo atualizado!";
} else {
    $query = "INSERT INTO veiculo (
            id_modelo, categoria, estado_do_veiculo, tempo_de_uso, 
            preco_custo, preco_venda, preco_desconto, desconto, 
            tem_desconto, lucro, quilometragem, cor, descricao, 
            ano, tipo_cambio, tipo_combustivel, foto, estoque, 
            data_cadastro, status
        ) VALUES (
            $id_model, '$category', '$condition', $usageTime, 
            '$costPrice', '$sellPrice', '$discountPrice', $discount, 
            $hasDiscount, $profit, $mileage, '$color', '$description', 
            $year, '$transmissionType', '$fuelType', '$mainPhoto', $stock, 
            NOW(), 1
        )";

    $successMessage = "Veículo cadastrado!";
}

try {
    if (mysqli_query($connection, $query)) {
        $vehicleId = $isEditing ? $id : mysqli_insert_id($connection);

        // Fotos adicionais
        for ($i = 1; $i <= 6; $i++) {
            $field = "photo_$i";
            if (!empty($_FILES[$field]['name'])) {
                $finalName = time() . "_$i" . "_" . basename($_FILES[$field]['name']);
                if (move_uploaded_file($_FILES[$field]['tmp_name'], "../../images/" . $finalName)) {
                    // Verifica se já existe uma foto para essa ordem ao editar para evitar duplicatas simples
                    mysqli_query($connection, "INSERT INTO foto_veiculo (id_veiculo, caminho, ordem, data_cadastro, status) 
                                                  VALUES ($vehicleId, '$finalName', $i, NOW(), 1)");
                }
            }
        }

        // Características do Veículo
        mysqli_query($connection, "DELETE FROM caracteristica_carro WHERE id_veiculo = $vehicleId");
        if (isset($_POST['features']) && is_array($_POST['features'])) {
            foreach ($_POST['features'] as $fId) {
                $fId = (int)$fId;
                mysqli_query($connection, "INSERT INTO caracteristica_carro (id_veiculo, id_caracteristica) VALUES ($vehicleId, $fId)");
            }
        }

        $_SESSION['messageType'] = 'success';
        $_SESSION['messageText'] = $successMessage;
    } else {
        throw new mysqli_sql_exception();
    }
} catch (mysqli_sql_exception $e) {
    $_SESSION['messageType'] = 'error';
    $_SESSION['messageText'] = "Erro ao salvar veículo.";
}

header('Location: Index.php');
exit;

--- END_FILE: ..\admin\veiculos\actions.php ---
------------------------------

--- START_FILE: ..\admin\veiculos\Index.php ---
<?php
if (!isset($_SESSION)) {
  session_start();
}
require_once("../../conexao/conecta.php");
require_once('../../Components/Sidebar.php');
?>
<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Carros Fácil - Gerenciar Veículos</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <link rel="shortcut icon" href="../../assets/img/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="../../custom/css/style.css">
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <?php echo Sidebar("vehicle"); ?>

      <main class="col-lg-10">
        <header id="admin-header" class="py-3 d-flex align-items-center justify-content-between gap-2 px-3">
          <div id="left-info">GERENCIANDO - ESTOQUE DE VEÍCULOS</div>
          <div id="right-info">
            <div id="current-time">AGORA</div>
          </div>
        </header>

        <hr class="m-0">

        <?php include('../Mensagem.php'); ?>

        <div class="container mt-3">
          <div class="card shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h4 class="m-0">Lista de Veículos</h4>
              <a href="manage.php" class="btn btn-primary">
                <i class="bi bi-plus-lg"></i> Adicionar Veículo
              </a>
            </div>

            <div class="card-body">
              <div class="row g-2">
                <div class="col-md-1">
                  <input onkeyup="applyFilters()" type="text" id="id-filter" class="form-control" placeholder="Código">
                </div>
                <div class="col-md-3">
                  <input onkeyup="applyFilters()" type="text" id="model-filter" class="form-control" placeholder="Filtrar por modelo">
                </div>
                <div class="col-md-3">
                  <select onchange="applyFilters()" id="category-filter" class="form-select">
                    <option value="">Todas Categorias</option>
                    <option value="Hatchback">Hatchback</option>
                    <option value="Sedan">Sedan</option>
                    <option value="SUV">SUV</option>
                    <option value="Pickup">Picape</option>
                    </select>
                </div>
                <div class="col-md-3">
                  <select onchange="applyFilters()" id="conditions-filter" class="form-select">
                    <option value="">Todos Estados</option>
                    <option value="Novo">Novo</option>
                    <option value="Semi-novo">Semi-novo</option>
                    <option value="Usado">Usado</option>
                  </select>
                </div>
                <div class="col-md-2">
                  <select onchange="applyFilters()" id="status-filter" class="form-select">
                    <option value="">Status</option>
                    <option value="1">Ativo</option>
                    <option value="0">Inativo</option>
                  </select>
                </div>
              </div>
            </div>

            <div id="table-target">
              </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../../assets/js/components/admin-header.js"></script>
  <script src="../../assets/js/components/sidebar.js"></script>

  <script>
    function applyFilters() {
      $.ajax({
        url: 'table.php',
        method: 'POST',
        data: {
          id: $("#id-filter").val(),
          model: $("#model-filter").val(),
          category: $("#category-filter").val(),
          conditions: $("#conditions-filter").val(),
          status: $("#status-filter").val()
        },
        success: function(response) {
          $("#table-target").html(response);
        }
      });
    }

    $(document).ready(function() {
      applyFilters();
    });
  </script>
</body>
</html>
--- END_FILE: ..\admin\veiculos\Index.php ---
------------------------------

--- START_FILE: ..\admin\veiculos\manage.php ---
<?php
if (!isset($_SESSION)) {
  session_start();
}
require_once("../../conexao/conecta.php");
require_once('../../Components/Sidebar.php');

$id = isset($_GET['id']) ? (int)$_GET['id'] : 0;
$vehicle = null;

if ($id > 0) {
  $query = "SELECT * FROM veiculo WHERE id = $id";
  $result = mysqli_query($connection, $query);
  $vehicle = mysqli_fetch_assoc($result);
  $photosGalery = [];
  if ($id > 0) {
    $vehiclePhotos = mysqli_query($connection, "SELECT caminho, ordem FROM foto_veiculo WHERE id_veiculo = $id");
    while ($f = mysqli_fetch_assoc($vehiclePhotos)) {
      $photosGalery[$f['ordem']] = $f['caminho'];
    }
  }
}

$pageTitle = $vehicle ? "Editar Veículo #" . $vehicle['id'] : "Novo Veículo";
?>
<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Carros Fácil - <?php echo $pageTitle; ?></title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="../../custom/css/style.css">

  <style>
    .image-preview {
      border: 2px dashed #ccc;
      padding: 20px;
      border-radius: 8px;
      background: #f9f9f9;
      min-height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #foto-preview {
      max-height: 300px;
      border-radius: 8px;
    }
  </style>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <?php echo Sidebar("vehicle"); ?>

      <main class="col-lg-10">
        <header id="admin-header" class="py-2 d-flex align-items-center justify-content-between gap-2 px-3">
          <div id="left-info"><?php echo mb_strtoupper($pageTitle); ?></div>
          <div id="right-info">
            <button type="button" id="mock-veiculo" class="btn btn-warning btn-sm py-2">
              <i class="bi bi-magic"></i> Mock Veículo
            </button>
            <a href="Index.php" class="py-2 btn btn-outline-secondary btn-sm"><i class="bi bi-arrow-left"></i> Voltar</a>
          </div>
        </header>

        <hr class="m-0">

        <div class="container mt-4 mb-5">
          <form action="actions.php" method="post" enctype="multipart/form-data">
            <input type="hidden" name="id" value="<?php echo $id; ?>">

            <div class="row g-4">
              <div class="col-lg-8">
                <div class="card shadow-sm mb-4">
                  <div class="card-header bg-light"><strong>Identificação e Estilo</strong></div>
                  <div class="card-body row g-3">
                    <div class="col-md-5">
                      <label class="form-label">Modelo <span class="text-danger">*</span></label>
                      <select name="model" id="model" class="form-select" required>
                        <option value="">Selecione...</option>
                        <?php
                        $result = mysqli_query($connection, "SELECT id, nome FROM modelo ORDER BY nome ASC");
                        while ($m = mysqli_fetch_assoc($result)) {
                          $selected = ($vehicle && $vehicle['id_modelo'] == $m['id']) ? 'selected' : '';
                          echo "<option value='{$m['id']}' $selected>{$m['nome']}</option>";
                        }
                        ?>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Categoria <span class="text-danger">*</span></label>
                      <select name="category" id="category" class="form-select" required>
                        <option value="" disabled <?= $vehicle ? '' : "selected" ?>>Selecione uma categoria</option>

                        <?php
                        $categories = [
                          "Hatch Compacto",
                          "Hatch Médio",
                          "Sedan Compacto",
                          "Sedan Médio",
                          "Sedan Premium",
                          "SUV Compacto",
                          "SUV Médio",
                          "SUV de Luxo",
                          "SUV 7 Lugares",
                          "Picape Compacta",
                          "Picape Média",
                          "Picape Full-size",
                          "Coupé",
                          "Conversível",
                          "Esportivo",
                          "Superesportivo",
                          "Off-Road / 4x4",
                          "Minivan",
                          "Perua (SW)",
                          "Utilitário / Carga",
                          "Van de Passageiros",
                          "Antigo / Colecionador",
                          "Híbrido",
                          "Elétrico"
                        ];
                        foreach ($categories as $category) {
                        ?>
                          <option value="<?= $category; ?>" <?php if (isset($vehicle) && $vehicle["categoria"] == $category) echo 'selected'; ?>>
                            <?= $category; ?>
                          </option>
                        <?php
                        }
                        ?>
                      </select>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Cor <span class="text-danger">*</span></label>
                      <select name="color" id="color" class="form-select" required>
                        <option value="">Selecione...</option>
                        <?php
                        $colorList = [
                          "Branco",
                          "Preto",
                          "Prata",
                          "Cinza",
                          "Vermelho",
                          "Azul",
                          "Verde",
                          "Amarelo",
                          "Laranja",
                          "Marrom",
                          "Bege",
                          "Bordo",
                          "Dourado",
                          "Roxo",
                          "Rosa",
                          "Grafite",
                          "Champagne",
                          "Vinho"
                        ];
                        foreach ($colorList as $colorName) {
                          // Verifica se o veículo já tem essa cor salva (para o modo edição)
                          $selected = ($vehicle && $vehicle["cor"] == $colorName) ? 'selected' : '';
                          echo "<option value='$colorName' $selected>$colorName</option>";
                        }
                        ?>
                      </select>
                    </div>
                  </div>
                </div>

                <div class="card shadow-sm mb-4">
                  <div class="card-header bg-light"><strong>Ficha Técnica e Condição</strong></div>
                  <div class="card-body row g-3">
                    <div class="col-md-3">
                      <label class="form-label">Ano</label>
                      <input type="text" data-mask="0000" name="year" id="year" class="form-control" value="<?php echo $vehicle["ano"] ?? ''; ?>" required>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Quilometragem</label>
                      <input type="text" data-mask="######0" name="mileage" id="mileage" class="form-control" value="<?php echo $vehicle["quilometragem"] ?? ''; ?>" required>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Condição</label>
                      <select name="condition" id="condition" class="form-select">
                        <option value="Novo" <?php if ($vehicle && $vehicle["estado_do_veiculo"] == 'Novo') echo 'selected'; ?>>Novo</option>
                        <option value="Semi-novo" <?php if ($vehicle && $vehicle["estado_do_veiculo"] == 'Semi-novo') echo 'selected'; ?>>Semi-novo</option>
                        <option value="Usado" <?php if ($vehicle && $vehicle["estado_do_veiculo"] == 'Usado') echo 'selected'; ?>>Usado</option>
                      </select>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Tempo de Uso (dias)</label>
                      <input data-mask="####0" type="text" name="usageTime" id="usageTime" class="form-control" placeholder="Ex: 365" value="<?= $vehicle ? $vehicle['tempo_de_uso'] : ''; ?>">
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Câmbio</label>
                      <select name="transmissionType" id="transmissionType" class="form-select">
                        <option value="Manual" <?php if ($vehicle && $vehicle["tipo_cambio"] == 'Manual') echo 'selected'; ?>>Manual</option>
                        <option value="Auto Trad." <?php if ($vehicle && $vehicle["tipo_cambio"] == 'Auto Trad.') echo 'selected'; ?>>Automático Tradicional</option>
                        <option value="CVT" <?php if ($vehicle && $vehicle["tipo_cambio"] == 'CVT') echo 'selected'; ?>>(CVT) Transmissão Continuamente Variável</option>
                        <option value="Auto Mono." <?php if ($vehicle && $vehicle["tipo_cambio"] == 'Auto Mono.') echo 'selected'; ?>>Automático Tradicional</option>
                        <option value="DCT" <?php if ($vehicle && $vehicle["tipo_cambio"] == 'DCT') echo 'selected'; ?>>Automático de Dupla Embreagem</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Combustível</label>
                      <select name="fuelType" id="fuelType" class="form-select">
                        <option value="Flex" <?php if ($vehicle && $vehicle["tipo_combustivel"] == 'Flex') echo 'selected'; ?>>Flex</option>
                        <option value="Gasolina" <?php if ($vehicle && $vehicle["tipo_combustivel"] == 'Gasolina') echo 'selected'; ?>>Gasolina</option>
                        <option value="Diesel" <?php if ($vehicle && $vehicle["tipo_combustivel"] == 'Diesel') echo 'selected'; ?>>Diesel</option>
                        <option value="Etanol" <?php if ($vehicle && $vehicle["tipo_combustivel"] == 'Etanol') echo 'selected'; ?>>Etanol</option>
                        <option value="GNV" <?php if ($vehicle && $vehicle["tipo_combustivel"] == 'GNV') echo 'selected'; ?>>(GNV) Gás Natural Veicular</option>
                      </select>
                    </div>
                    <div class="col-md-12">
                      <label class="form-label">Descrição do Anúncio</label>
                      <textarea maxlength="250" name="description" id="description" class="form-control" rows="3"><?= $vehicle ? $vehicle['descricao'] : ''; ?></textarea>
                    </div>
                  </div>
                </div>

                <div class="card shadow-sm mb-4">
                  <div class="card-header bg-light d-flex justify-content-between align-items-center">
                    <strong>Características e Opcionais</strong>
                  </div>
                  <div class="card-body">
                    <div class="row g-2 mb-3">
                      <div class="col-md-10">
                        <select id="select-feature" class="form-select">
                          <option value="">Selecione uma característica...</option>
                          <?php
                          $featuresQuery = mysqli_query($connection, "SELECT * FROM caracteristica WHERE status = 1 ORDER BY nome ASC");
                          while($f = mysqli_fetch_assoc($featuresQuery)) {
                            echo "<option value='{$f['id']}' data-nome='{$f['nome']}'>{$f['nome']}</option>";
                          }
                          ?>
                        </select>
                      </div>
                      <div class="col-md-2">
                        <button type="button" class="btn btn-secondary w-100" onclick="addFeature()">
                          <i class="bi bi-plus-lg"></i> Adicionar
                        </button>
                      </div>
                    </div>
                    <div class="table-responsive">
                      <table class="table table-sm table-bordered">
                        <thead class="table-light">
                          <tr>
                            <th>Característica</th>
                            <th width="100" class="text-center">Ação</th>
                          </tr>
                        </thead>
                        <tbody id="features-table-body">
                          <?php
                          if ($id > 0) {
                            $currentFeatures = mysqli_query($connection, "SELECT c.id, c.nome FROM caracteristica c 
                              INNER JOIN caracteristica_carro cc ON c.id = cc.id_caracteristica 
                              WHERE cc.id_veiculo = $id");
                            while($cf = mysqli_fetch_assoc($currentFeatures)) {
                              echo "<tr id='feature-row-{$cf['id']}'>
                                      <td class='align-middle'>{$cf['nome']} <input type='hidden' name='features[]' value='{$cf['id']}'></td>
                                      <td class='text-center'><button type='button' class='btn btn-danger btn-sm' onclick='removeFeature({$cf['id']})'><i class='bi bi-trash'></i></button></td>
                                    </tr>";
                            }
                          }
                          ?>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>

                <div class="card shadow-sm">
                  <div class="card-header bg-light"><strong>Preços e Valores</strong></div>
                  <div class="card-body row g-3">

                    <div class="col-md-4">
                      <label class="form-label">Preço Custo (R$)</label>
                      <input maxlength="16" data-mask="#.##0,00" data-mask-reverse="true" type="text" id="costPrice" name="costPrice" class="form-control" value="<?= $vehicle ? number_format($vehicle["preco_custo"], 2, ',', '.') : '' ?>" placeholder="R$ 0,00">
                    </div>

                    <div class="col-md-4">
                      <label class="form-label">Lucro (%)</label>
                      <input data-mask="####0" id="expected_profit" name="expected_profit" class="form-control" placeholder="0" value="<?= $vehicle ? $vehicle["lucro"] : '' ?>">
                    </div>

                    <div class="col-md-4">
                      <label class="form-label">Preço Venda (R$)</label>
                      <input maxlength="16" data-mask="#.##0,00" data-mask-reverse="true" placeholder="R$ 0,00" type="text" id="sellPrice" name="sellPrice" class="form-control" readonly value="<?= $vehicle ? number_format($vehicle["preco_venda"], 2, ',', '.') : '' ?>">
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Desconto (%)</label>
                      <input data-mask="##0" id="discount" name="discount" class="form-control" placeholder="0"
                        value="<?= $vehicle ? $vehicle["desconto"] : '' ?>">
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Preço com Desconto (R$)</label>
                      <input maxlength="16" data-mask="#.##0,00" data-mask-reverse="true" placeholder="R$ 0,00" type="text" id="discountPrice" name="discountPrice" class="form-control" readonly
                        value="<?= $vehicle ? number_format($vehicle["preco_desconto"], 2, ',', '.') : '' ?>">
                    </div>

                  </div>
                </div>
              </div>

              <div class="col-lg-4">
                <div class="card shadow-sm mb-4">
                  <div class="card-header bg-light"><strong>Galeria de Fotos (Upload Individual)</strong></div>
                  <div class="card-body">
                    <div class="row g-3">
                      <?php for ($i = 1; $i <= 6; $i++): ?>
                        <div class="col-md-6 col-6">
                          <div class="upload-slot border rounded p-2 text-center" style="background: #f8f9fa; cursor: pointer;" onclick="document.getElementById('photo-input-<?php echo $i; ?>').click();">
                            <div id="preview-container-<?php echo $i; ?>">
                              <?php
                              // Se for o slot 1, tenta pegar a foto principal. Se for outro slot, pega da galeria.
                              $mainPhoto = ($i == 1) ? ($vehicle ? $vehicle['foto'] : '') : ($photosGalery[$i] ?? '');

                              if (!empty($mainPhoto) && $mainPhoto != 'default.png'):
                              ?>
                                <img src="../../images/<?php echo $mainPhoto; ?>" class="img-fluid rounded mb-2" style="height: 100px; width: 100%; object-fit: cover;">
                              <?php else: ?>
                                <i class="bi bi-camera" style="font-size: 2rem; color: #ccc;"></i>
                                <p class="small text-muted mb-0">Foto <?php echo $i; ?></p>
                              <?php endif; ?>
                            </div>

                            <input type="file"
                              name="photo_<?php echo $i; ?>"
                              id="photo-input-<?php echo $i; ?>"
                              class="d-none"
                              accept="image/*"
                              onchange="previewImage(this, <?php echo $i; ?>)">

                            <button type="button" class="btn btn-sm btn-outline-primary mt-2 w-100">
                              Selecionar
                            </button>
                          </div>
                        </div>
                      <?php endfor; ?>
                    </div>
                    <small class="text-muted d-block mt-2 text-center w-100">* A primeira foto será a principal do anúncio.</small>
                  </div>
                </div>

                <div class="card shadow-sm mt-5">
                  <div class="card-header bg-light"><strong>Controle</strong></div>
                  <div class="card-body">
                    <label class="form-label">Quantidade em Estoque</label>
                    <input type="text" data-mask="####0" name="stock" class="form-control mb-3" value="<?= $vehicle ? $vehicle['estoque'] : ''; ?>">

                    <button type="submit" name="actionSave" class="btn btn-primary w-100 py-2 mt-4">
                      <i class="bi bi-check-circle"></i> <?= $vehicle ? "Atualizar Dados" : "Cadastrar Veículo"; ?>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </main>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="../../assets/js/jquery.mask.js"></script>

  <script src="../../assets/js/components/sidebar.js"></script>
  <script src="../../assets/js/register-vehicle-form-extras.js"></script>
  <script>
    function addFeature() {
      const select = document.getElementById('select-feature');
      const id = select.value;
      const nome = select.options[select.selectedIndex].getAttribute('data-nome');

      if (!id) return;
      
      if (document.getElementById('feature-row-' + id)) {
        alert('Esta característica já foi adicionada.');
        return;
      }

      const html = `
        <tr id="feature-row-${id}">
          <td class="align-middle">${nome} <input type="hidden" name="features[]" value="${id}"></td>
          <td class="text-center">
            <button type="button" class="btn btn-danger btn-sm" onclick="removeFeature(${id})">
              <i class="bi bi-trash"></i>
            </button>
          </td>
        </tr>
      `;
      
      $('#features-table-body').append(html);
      select.value = "";
    }

    function removeFeature(id) {
      $('#feature-row-' + id).remove();
    }

    function previewImage(input, index) {
      const container = document.getElementById('preview-container-' + index);

      if (input.files && input.files[0]) {
        const reader = new FileReader();

        reader.onload = function(e) {
          // Limpa o ícone e adiciona a foto
          container.innerHTML = `
                <img src="${e.target.result}" 
                     class="img-fluid rounded mb-2" 
                     style="height: 100px; width: 100%; object-fit: cover;">
                <p class="small text-success mb-0">Pronta!</p>
            `;
        };

        reader.readAsDataURL(input.files[0]);
      }
    }

    $("#photo-input").change(function() {
      const file = this.files[0];
      if (file) {
        let reader = new FileReader();
        reader.onload = function(event) {
          $("#foto-preview").attr("src", event.target.result).removeClass("d-none");
          $("#placeholder-icon").addClass("d-none");
        }
        reader.readAsDataURL(file);
      }
    });

    $("#discount").on('input', function() {
      if (parseInt($(this).val()) > 100) {
        $(this).val(100);
      }
    });

    $(function() {
      function parseCurrency(value) {
        if (!value) return 0;
        return parseFloat(value.replace(/\./g, '').replace(',', '.')) || 0;
      }

      function formatCurrency(value) {
        return value.toLocaleString('pt-BR', {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2
        });
      }

      function calculatePrices() {
        const cost = parseCurrency($('#costPrice').val());
        const profitPercentage = parseFloat($('#expected_profit').val()) || 0;
        const discountPercentage = parseFloat($('#discount').val()) || 0;

        const margin = cost * (profitPercentage / 100);
        const sellPrice = cost + margin;

        const discountAmount = sellPrice * (discountPercentage / 100);
        const discountedPrice = sellPrice - discountAmount;

        $('#sellPrice').val(formatCurrency(sellPrice));
        $('#discountPrice').val(formatCurrency(discountedPrice));

        const profitInput = document.getElementById('expected_profit');
        const discountInput = document.getElementById('discount');

        profitInput.setCustomValidity('');
        discountInput.setCustomValidity('');

        if (sellPrice < cost && cost > 0) {
          profitInput.setCustomValidity('Atenção: O preço de venda não pode ser inferior ao preço de custo. Aumente a margem de lucro.');
        } else if (discountedPrice < cost && cost > 0) {
          discountInput.setCustomValidity('Aviso: O preço de desconto está abaixo do preço de custo, diminua o desconto ou aumente o lucro.');
        }
      }

      $('#costPrice, #expected_profit, #discount').on('input', function() {
        calculatePrices();
      });

      if ($('#costPrice').val()) {
        calculatePrices();
      }
    });

    $('#mock-veiculo').on('click', function() {
      try {
        const rand = (arr) => arr[Math.floor(Math.random() * arr.length)];
        const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1) + min);

        // 1. FILTRO DE MODELOS (Ignora nomes comuns se quiser focar em exóticos)  480]
        const nomesProibidos = ["X1", "Kicks", "Compass", "Civic", "HB20", "Ranger", "Strada", "Onix", "Gol", "Corolla"];
        const $opcoesValidas = $('#model option').filter(function() {
          const texto = $(this).text().toUpperCase();
          const valor = $(this).val();
          return valor !== "" && !nomesProibidos.some(proibido => texto.includes(proibido.toUpperCase()));
        });

        if ($opcoesValidas.length > 0) {
          $(rand($opcoesValidas)).prop('selected', true);
        } else {
          $('#model option:eq(1)').prop('selected', true);
        }

        // 2. DADOS PADRONIZADOS (Cores agora devem bater exatamente com o seu SELECT) 
        const baseExotica = {
          // Lista de cores ajustada para o seu novo select
          cores: [
            "Branco", "Preto", "Prata", "Cinza", "Vermelho", "Azul", "Verde",
            "Amarelo", "Laranja", "Marrom", "Bege", "Bordo", "Dourado",
            "Roxo", "Rosa", "Grafite", "Champagne", "Vinho"
          ],
          categorias: ["Sedan", "Hatchback", "SUV", "Pickup"],
          cambios: ["Manual", "Automático"],
          combustiveis: ["Gasolina", "Flex", "Diesel"],
          descricoes: [
            "Edição limitada com acabamento em fibra de carbono e escape esportivo original.",
            "Configuração exclusiva, interior em alcântara e freios de cerâmica. Impecável.",
            "Veículo de importação oficial, revisado em concessionária por tempo e não km.",
            "Performance absurda, 0-100km/h em 2.9s. Um verdadeiro item de colecionador."
          ]
        };

        // 3. PREENCHIMENTO DOS CAMPOS (O .val() funcionará perfeitamente no select) 
        $('#category').val(rand(baseExotica.categorias));
        $('#transmissionType').val(rand(baseExotica.cambios));
        $('#fuelType').val(rand(baseExotica.combustiveis));
        $('#color').val(rand(baseExotica.cores)); // Sorteia uma cor da lista acima
        $('#year').val(randInt(2022, 2026));
        $('#mileage').val(randInt(50, 5000));
        $('#description').val(rand(baseExotica.descricoes));
        $('#stock').val(randInt(1, 2));

        // 4. FINANCEIRO 
        const cost = randInt(850000, 3500000);
        const profit = rand([5, 8, 10, 15]);
        const costFormatted = cost.toLocaleString('pt-br', {
          minimumFractionDigits: 2
        });

        $('#costPrice').val(costFormatted);
        $('#expected_profit').val(profit);

        // Dispara o cálculo automático do preço de venda 
        calcularVenda();

        // 5. IMAGENS 
        const marcasFlickr = ["ferrari", "lamborghini", "porsche-911", "mclaren", "rolls-royce"];
        const imgUrl = `https://loremflickr.com/640/480/${rand(marcasFlickr)}?lock=${randInt(1, 1000)}`;

        $("#foto-preview").attr("src", imgUrl).removeClass("d-none").show();
        $("#placeholder-icon").addClass("d-none");

        console.log("💎 Mock 'Exotic Edition' com Select aplicado!");

      } catch (err) {
        console.error("Erro no Mock:", err);
      }
    });
  </script>
</body>

</html>
--- END_FILE: ..\admin\veiculos\manage.php ---
------------------------------

--- START_FILE: ..\admin\veiculos\table.php ---
<?php
require_once("../../conexao/conecta.php");
require_once("../../Components/Table.php");

$query = "SELECT v.id, m.nome 'modelName', v.categoria 'category', v.estado_do_veiculo, v.preco_venda 'sellPrice', v.estoque 'stock', v.status 
        FROM veiculo v 
        INNER JOIN modelo m ON v.id_modelo = m.id";

$conditions = [];
if (!empty($_POST['id'])) $conditions[] = "v.id = " . (int)$_POST['id'];
if (!empty($_POST['model'])) $conditions[] = "m.nome LIKE '%".mysqli_real_escape_string($connection, $_POST['model'])."%'";
if (!empty($_POST['category'])) $conditions[] = "v.categoria = '".$_POST['category']."'";
if (!empty($_POST['conditions'])) $conditions[] = "v.estado_do_veiculo = '".$_POST['conditions']."'";
if (isset($_POST['status']) && $_POST['status'] !== "") $conditions[] = "v.status = " . (int)$_POST['status'];

if (!empty($conditions)) $query .= " WHERE " . implode(" AND ", $conditions);
$query .= " ORDER BY v.id";

$result = mysqli_query($connection, $query);

// Renderizando com o componente Table
echo Table::render([
  "#" => "id",
  "Modelo" => "modelName",
  "Categoria" => "category",
  "Preço (R$)" => "sellPrice",
  "Estoque" => "stock",
  "Status" => "status"
], $result, [
  "editUrl" => "manage.php?id=", // Ajuste no componente para aceitar link de página em vez de modal se necessário
  "entity" => "veiculos",
  "modalTarget" => null // Indica que não abre modal, vai pra página
]);
--- END_FILE: ..\admin\veiculos\table.php ---
------------------------------

--- START_FILE: ..\admin\vendas\actions.php ---
<?php
require_once("../../conexao/conecta.php");
if (!isset($_SESSION)) {
    session_start();
}

// Excluir
if (isset($_POST["delete"])) {
    $id = (int)$_POST["delete"];
    try {
        $items = mysqli_fetch_all(mysqli_query($connection, "SELECT id_veiculo, quantidade FROM item_venda WHERE id_venda=$id"), MYSQLI_ASSOC);
        foreach ($items as $item) {
            $vId = $item['id_veiculo'];
            $qty = $item['quantidade'];
            mysqli_query($connection, "UPDATE veiculo SET estoque=estoque+$qty WHERE id=$vId");
        }
        mysqli_query($connection, "DELETE FROM item_venda WHERE id_venda=$id");
        mysqli_query($connection, "DELETE FROM pagamento_venda WHERE id_venda=$id");
        mysqli_query($connection, "DELETE FROM venda WHERE id=$id");
        $_SESSION['messageType'] = 'success';
        $_SESSION['messageText'] = "Sucesso: Venda excluída e o estoque foi restaurado.";
    } catch (mysqli_sql_exception $e) {
        $_SESSION['messageType'] = 'error';
        $_SESSION['messageText'] = "Erro: Não foi possível excluir a venda.";
    }
    header("Location: Index.php");
    exit;
}

// Salvar
if (isset($_POST['actionSave'])) {
    $saleId = (int)$_POST['saleId'];
    $isEditing = ($saleId > 0);
    $customerId = (int)$_POST['customerId'];
    $employeeId = (int)$_POST['employeeId'];
    $discountPercent = (int)($_POST['saleDiscount'] ?? 0); // Percentual (ex: 10)

    try {
        if ($isEditing) {
            $oldItems = mysqli_fetch_all(mysqli_query($connection, "SELECT id_veiculo, quantidade FROM item_venda WHERE id_venda=$saleId"), MYSQLI_ASSOC);
            foreach ($oldItems as $old) {
                $vId = $old['id_veiculo'];
                $qty = $old['quantidade'];
                mysqli_query($connection, "UPDATE veiculo SET estoque=estoque+$qty WHERE id=$vId");
            }
            mysqli_query($connection, "DELETE FROM item_venda WHERE id_venda=$saleId");
            mysqli_query($connection, "DELETE FROM pagamento_venda WHERE id_venda=$saleId");
        }

        $aggregatedItems = [];
        foreach ($_POST['itemsId'] as $key => $vId) {
            $qty = (int)$_POST['itemAmount'][$key];
            if (!isset($aggregatedItems[$vId])) {
                $aggregatedItems[$vId] = 0;
            }
            $aggregatedItems[$vId] += $qty;
        }

        $subtotal = 0;
        foreach ($aggregatedItems as $vId => $totalQty) {
            $vehicleData = mysqli_fetch_assoc(mysqli_query($connection, "SELECT estoque, preco_venda FROM veiculo WHERE id=$vId"));

            if ($vehicleData['estoque'] < $totalQty) {

                $_SESSION['messageType'] = 'error';
                $_SESSION['messageText'] = "Falha: O veículo do código $vId tem apenas {$vehicleData['estoque']} em estoque! Você tentou vender $totalQty.";
                header("Location: manage.php");
                exit;
            }

            $subtotal += ($vehicleData['preco_venda'] * $totalQty);
        }

        $discountValue = $subtotal * ($discountPercent / 100); // Valor em R$
        $totalFinal = $subtotal - $discountValue;              // Valor líquido: valorTotal - desconto

        if ($isEditing) {
            mysqli_query($connection, "UPDATE venda SET 
                    id_funcionario=$employeeId, 
                    id_cliente=$customerId, 
                    valor_total='$totalFinal', 
                    valor_desconto='$discountValue', 
                    desconto=$discountPercent 
                    WHERE id=$saleId");
            $currentId = $saleId;
        } else {
            mysqli_query($connection, "INSERT INTO venda 
                    (id_funcionario, id_cliente, valor_total, valor_desconto, desconto, data_cadastro, status) 
                    VALUES ($employeeId, $customerId, '$totalFinal', '$discountValue', $discountPercent, NOW(), 1)");
            $currentId = mysqli_insert_id($connection);
        }

        foreach ($_POST['itemsId'] as $key => $vId) {
            $qty = (int)$_POST['itemAmount'][$key];
            $price = mysqli_fetch_assoc(mysqli_query($connection, "SELECT preco_venda FROM veiculo WHERE id=$vId"))['preco_venda'];
            mysqli_query($connection, "INSERT INTO item_venda (id_veiculo, id_venda, quantidade, valor_unitario, valor_total) VALUES ($vId, $currentId, $qty, '$price', '" . ($price * $qty) . "')");
            mysqli_query($connection, "UPDATE veiculo SET estoque=estoque-$qty WHERE id=$vId");
        }

        foreach ($_POST['payMethod'] as $key => $m) {
            $val = (float)$_POST['payAmount'][$key];
            $inst = (int)$_POST['payInstallments'][$key];
            $mClean = mysqli_real_escape_string($connection, $m);
            mysqli_query($connection, "INSERT INTO pagamento_venda (id_venda, metodo, valor_final, parcelas, status) VALUES ($currentId, '$mClean', $val, $inst, 1)");
        }

        $_SESSION['messageType'] = 'success';
        $_SESSION['messageText'] = "Sucesso: Venda realizada com sucesso.";
    } catch (Exception $e) {
        $_SESSION['messageType'] = 'error';
        $_SESSION['messageText'] = 'Erro: ' . $e->getMessage();
    }
    header("Location: Index.php");
    exit;
}

--- END_FILE: ..\admin\vendas\actions.php ---
------------------------------

--- START_FILE: ..\admin\vendas\index.php ---
<?php
if (!isset($_SESSION)) {
  session_start();
}
require_once("../../conexao/conecta.php");
require_once('../../Components/Sidebar.php');
?>
<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Carros Fácil - Gerenciar Vendas</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <link rel="shortcut icon" href="../../assets/img/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="../../custom/css/style.css">
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <?php echo Sidebar("sell"); ?>

      <main class="col-lg-10">
        <header id="admin-header" class="py-3 d-flex align-items-center justify-content-between gap-2 px-3">
          <div id="left-info">GERENCIANDO - VENDAS</div>
          <div id="right-info">
            <div id="current-time">AGORA</div>
          </div>
        </header>

        <hr class="m-0">

        <?php include('../Mensagem.php'); ?>

        <div class="container mt-3">
          <div class="card shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h4 class="m-0">Relatório de Vendas</h4>
              <a href="manage.php" class="btn btn-primary">
                <i class="bi bi-cart-plus"></i> Registrar Venda
              </a>
            </div>

            <div class="card-body">
              <div class="row g-2">
                <div class="col-md-1">
                  <input onkeyup="applyFilters()" type="text" id="id-filter" class="form-control" placeholder="ID">
                </div>
                <div class="col-md-3">
                  <input onkeyup="applyFilters()" type="text" id="client-filter" class="form-control" placeholder="Cliente">
                </div>
                <div class="col-md-3">
                  <input onkeyup="applyFilters()" type="text" id="employee-filter" class="form-control" placeholder="Funcionário">
                </div>
                <div class="col-md-3">
                  <input onchange="applyFilters()" type="date" id="date-filter" class="form-control">
                </div>
                <div class="col-md-2">
                  <select onchange="applyFilters()" id="status-filter" class="form-select">
                    <option value="">Status</option>
                    <option value="1">Concluída</option>
                    <option value="0">Cancelada</option>
                  </select>
                </div>
              </div>
            </div>

            <div id="table-target">
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../../assets/js/components/admin-header.js"></script>
  <script src="../../assets/js/components/sidebar.js"></script>

  <script>
    function applyFilters() {
      $.ajax({
        url: 'table.php',
        method: 'POST',
        data: {
          id: $("#id-filter").val(),
          customer: $("#client-filter").val(),
          employee: $("#employee-filter").val(),
          date: $("#date-filter").val(),
          status: $("#status-filter").val()
        },
        success: function(response) {
          $("#table-target").html(response);
        }
      });
    }

    $(document).ready(function() {
      applyFilters();
    });
  </script>
</body>
</html>
--- END_FILE: ..\admin\vendas\index.php ---
------------------------------

--- START_FILE: ..\admin\vendas\manage.php ---
<?php
if (!isset($_SESSION)) {
  session_start();
}
require_once("../../conexao/conecta.php");
require_once('../../Components/Sidebar.php');

$isEditing = false;
$saleData = null;
$itemsJson = '[]';
$paymentsJson = '[]';

if (isset($_GET['id'])) {
  $isEditing = true;
  $id = (int)$_GET['id'];

  $saleQuery = mysqli_query($connection, "SELECT v.*, c.nome as customer_name, f.nome as employee_name 
                                      FROM venda v 
                                      INNER JOIN cliente c ON v.id_cliente = c.id 
                                      INNER JOIN funcionario f ON v.id_funcionario = f.id 
                                      WHERE v.id = $id");
  $saleData = mysqli_fetch_assoc($saleQuery);

  $itemsQuery = mysqli_query($connection, "SELECT iv.*, m.nome as model, v.estoque 
                                      FROM item_venda iv 
                                      INNER JOIN veiculo v ON iv.id_veiculo = v.id 
                                      INNER JOIN modelo m ON v.id_modelo = m.id 
                                      WHERE iv.id_venda = $id");

  $itemsList = [];
  $itemsCount = mysqli_num_rows($itemsQuery);

  for ($index = 0; $index < $itemsCount; $index++) {
    $item = mysqli_fetch_assoc($itemsQuery);
    $itemsList[] = [
      'id' => $item['id_veiculo'],
      'name' => $item['model'],
      'price' => (float)$item['valor_unitario'],
      'quantity' => (int)$item['quantidade'],
      'stock' => (int)$item['estoque'] + (int)$item['quantidade']
    ];
  }
  $itemsJson = json_encode($itemsList);

  $paymentsQuery = mysqli_query($connection, "SELECT * FROM pagamento_venda WHERE id_venda = $id");

  $paymentsList = [];
  $paymentsCount = mysqli_num_rows($paymentsQuery);

  for ($index = 0; $index < $paymentsCount; $index++) {
    $pay = mysqli_fetch_assoc($paymentsQuery);
    $paymentsList[] = [
      'method' => $pay['metodo'],
      'amount' => (float)$pay['valor_final'],
      'installments' => $pay['parcelas'],
    ];
  }
  $paymentsJson = json_encode($paymentsList);
}

$mockCustomers = mysqli_fetch_all(mysqli_query($connection, "SELECT id, nome FROM cliente WHERE status = 1 LIMIT 5"), MYSQLI_ASSOC);
$mockEmployees = mysqli_fetch_all(mysqli_query($connection, "SELECT id, nome FROM funcionario WHERE status = 1 LIMIT 5"), MYSQLI_ASSOC);
$mockVehicles = mysqli_fetch_all(mysqli_query($connection, "SELECT v.id, m.nome, v.preco_venda, v.estoque FROM veiculo v JOIN modelo m ON v.id_modelo = m.id WHERE v.status = 1 AND v.estoque > 0 LIMIT 5"), MYSQLI_ASSOC);
?>
<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Carros Fácil - <?php echo $isEditing ? 'Editar' : 'Nova'; ?> Venda</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="../../custom/css/style.css">

  <style>
    .search-wrapper {
      position: relative;
    }

    .search-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      z-index: 1050;
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 0 0 8px 8px;
      display: none;
      max-height: 200px;
      overflow-y: auto;
    }

    .search-row {
      padding: 10px 15px;
      cursor: pointer;
      border-bottom: 1px solid #f8f9fa;
    }

    .search-row:hover {
      background: #f1f1f1;
    }

    .summary-card {
      background: #f8f9fa;
      border-left: 4px solid #0d6efd;
      position: sticky;
      top: 20px;
    }

    .field-selected {
      background-color: #e8f5e9 !important;
      border-color: #4caf50 !important;
    }
  </style>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <?php echo Sidebar("sell"); ?>

      <main class="col-lg-10">
        <header id="main-header" class="py-3 d-flex align-items-center justify-content-between gap-2 px-3">
          <div id="header-title"><?php echo $isEditing ? 'VISUALIZANDO' : 'NOVA'; ?> VENDA #<?php echo $isEditing ? $id : ''; ?></div>

          <div class="d-flex gap-2">
            <button type="button" onclick="generateMockData()" class="btn btn-warning btn-sm"><i class="bi bi-magic"></i> Gerar Mock</button>
            <a href="Index.php" class="btn btn-outline-secondary btn-sm"><i class="bi bi-arrow-left"></i> Voltar</a>
          </div>
        </header>
        <?php include('../Mensagem.php'); ?>

        <div class="container mt-4 mb-5">
          <form action="actions.php" method="post" id="sale-form">
            <input type="hidden" name="saleId" value="<?php echo $isEditing ? $id : '0'; ?>">

            <div class="row g-4">
              <div class="col-lg-8">
                <div class="card shadow-sm mb-4">
                  <div class="card-header bg-light"><strong>Identificação</strong></div>
                  <div class="card-body row g-3">
                    <div class="col-md-6 search-wrapper">
                      <label class="form-label">Cliente</label>
                      <div class="input-group">
                        <span class="input-group-text bg-white" id="customer-icon">
                          <?php echo $isEditing ? '<i class="bi bi-check-lg text-success"></i>' : '<i class="bi bi-search"></i>'; ?>
                        </span>
                        <input type="text" id="customer-search" class="form-control <?php echo $isEditing ? 'field-selected' : ''; ?>"
                          placeholder="Buscar cliente..." autocomplete="off" value="<?php echo $isEditing ? $saleData['customer_name'] : ''; ?>">
                        <input type="hidden" name="customerId" id="customer-id-hidden" value="<?php echo $isEditing ? $saleData['id_cliente'] : ''; ?>" required>
                      </div>
                      <div class="search-dropdown shadow" id="customer-results"></div>
                    </div>
                    <div class="col-md-6 search-wrapper">
                      <label class="form-label">Vendedor</label>
                      <div class="input-group">
                        <span class="input-group-text bg-white" id="seller-icon">
                          <?php echo $isEditing ? '<i class="bi bi-check-lg text-success"></i>' : '<i class="bi bi-person-badge"></i>'; ?>
                        </span>
                        <input type="text" id="seller-search" class="form-control <?php echo $isEditing ? 'field-selected' : ''; ?>"
                          placeholder="Buscar vendedor..." autocomplete="off" value="<?php echo $isEditing ? $saleData['employee_name'] : ''; ?>">
                        <input type="hidden" name="employeeId" id="seller-id-hidden" value="<?php echo $isEditing ? $saleData['id_funcionario'] : ''; ?>" required>
                      </div>
                      <div class="search-dropdown shadow" id="seller-results"></div>
                    </div>
                  </div>
                </div>

                <div class="card shadow-sm mb-4">
                  <div class="card-header bg-light"><strong>Veículos Vendidos</strong></div>
                  <div class="card-body">
                    <div class="row g-2 mb-4 align-items-end">
                      <div class="col-md-7 search-wrapper">
                        <label class="form-label small">Pesquisar Veículo</label>
                        <input type="text" id="vehicle-search" class="form-control" placeholder="Modelo ou cor...">
                        <div class="search-dropdown shadow" id="vehicle-results"></div>
                      </div>
                      <div class="col-md-2">
                        <label class="form-label small">Qtd</label>
                        <input type="number" id="input-amount" class="form-control" value="1" min="1">
                      </div>
                      <div class="col-md-3">
                        <button type="button" id="btn-add-vehicle" class="btn btn-dark w-100">
                          <i class="bi bi-plus-lg"></i> Adicionar
                        </button>
                      </div>
                    </div>

                    <div class="table-responsive">
                      <table class="table align-middle">
                        <thead>
                          <tr>
                            <th>Veículo</th>
                            <th>Preço Unit.</th>
                            <th>Qtd</th>
                            <th>Subtotal</th>
                            <th width="50"></th>
                          </tr>
                        </thead>
                        <tbody id="vehicle-table-body"></tbody>
                      </table>
                    </div>
                  </div>
                </div>

                <div class="card shadow-sm">
                  <div class="card-header bg-light"><strong>Formas de Pagamento</strong></div>
                  <div class="card-body">
                    <div class="row g-2 mb-3 align-items-end">
                      <div class="col-md-4">
                        <label class="form-label small">Meio</label>
                        <select id="pay-method" class="form-select">
                          <option value="Pix">Pix</option>
                          <option value="Dinheiro">Dinheiro</option>
                          <option value="Cartão de Crédito">Cartão de Crédito</option>
                          <option value="Cartão de Débito">Cartão de Débito</option>
                        </select>
                      </div>
                      <div class="col-md-3">
                        <label class="form-label small">Valor (R$)</label>
                        <input type="text" id="pay-amount" data-mask="#.##0,00" data-mask-reverse="true" class="form-control" placeholder="0,00">
                      </div>
                      <div class="col-md-2">
                        <label class="form-label small">Parcelas</label>
                        <select disabled id="pay-installments" class="form-select">
                          <option value="1">1x</option>
                          <option value="3">3x</option>
                          <option value="6">6x</option>
                          <option value="12">12x</option>
                          <option value="24">24x</option>
                          <option value="48">48x</option>
                        </select>
                      </div>
                      <div class="col-md-3">
                        <button type="button" id="btn-add-payment" class="btn btn-outline-dark w-100">Adicionar Pago</button>
                      </div>
                    </div>

                    <div class="table-responsive">
                      <table class="table table-sm align-middle">
                        <thead>
                          <tr class="text-muted small">
                            <th>Meio</th>
                            <th>Parcelas</th>
                            <th>Valor</th>
                            <th></th>
                          </tr>
                        </thead>
                        <tbody id="payment-table-body"></tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-lg-4">
                <div class="card shadow-sm summary-card p-3">
                  <div class="mb-3">
                    <span class="text-muted small">Subtotal:</span>
                    <h5 id="view-subtotal">R$ 0,00</h5>
                  </div>

                  <div class="mb-3">
                    <label class="small">Desconto (%)</label>
                    <input type="text" maxlength="3" data-mask="##0" id="sale-discount" name="saleDiscount" class="form-control"
                      value="<?php echo $isEditing ? ($saleData['desconto'] ?? '') : ''; ?>">
                  </div>

                  <hr>

                  <div class="mb-2">
                    <span class="h6">Total Geral:</span>
                    <h4 class="text-primary" id="view-total">R$ 0,00</h4>
                  </div>

                  <div class="d-flex justify-content-between text-success small mb-1">
                    <span>Recebido:</span>
                    <span id="view-received">R$ 0,00</span>
                  </div>
                  <div class="d-flex justify-content-between text-danger small mb-4">
                    <span>Faltante/Troco:</span>
                    <span id="view-difference">R$ 0,00</span>
                  </div>

                  <button type="submit" name="actionSave" class="btn btn-primary w-100 py-3 shadow-sm">
                    <i class="bi bi-shield-check"></i> <?php echo $isEditing ? 'ATUALIZAR' : 'FINALIZAR'; ?> VENDA
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </main>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../../assets/js/jquery.mask.js"></script>
  <script src="../../assets/js/components/sidebar.js"></script>

  <script>
    let selectedItems = <?php echo $itemsJson; ?>;
    let selectedPayments = <?php echo $paymentsJson; ?>;
    let currentVehicle = null;

    function formatMoney(value) {
      return value.toLocaleString('pt-br', {
        style: 'currency',
        currency: 'BRL'
      });
    }

    function parseMoney(value) {
      if (!value) return 0;
      return parseFloat(value.replace(/\./g, '').replace(',', '.'));
    }

    $(document).ready(function() {
      if (selectedItems.length > 0) renderItemsTable();
      if (selectedPayments.length > 0) renderPaymentsTable();
      updateCalculations();
    });

function initSearch(inputId, resultsId, searchType) {
    // Esse timeout é um teste, resumindo, se eu esquecer:
    // Ele espera x tempo pra enviar a solicitação, isso evita enviar solicitações muitas vezes, qunado o usuário nem parou de digitar ainda.
    let timeout = null;

    $(`#${inputId}`).on('input', function() {
        clearTimeout(timeout);
        
        const query = $(this).val().trim();
        const results = $(`#${resultsId}`);

        if (query.length > 2) {
            timeout = setTimeout(() => {
                $.get('search.php', { 
                    type: searchType, 
                    q: query 
                }, function(response) {
                    results.html(response).show();
                });
            }, 300);
        } else {
            results.hide().html('');
        }
    });
}

    initSearch('customer-search', 'customer-results', 'customer');
    initSearch('seller-search', 'seller-results', 'employee');
    initSearch('vehicle-search', 'vehicle-results', 'vehicle');

    function selectCustomer(id, name) {
      $('#customer-id-hidden').val(id);
      $('#customer-search').val(name).addClass('field-selected');
      $('#customer-icon').html('<i class="bi bi-check-lg text-success"></i>');
      $('#customer-results').hide();
    }

    function selectEmployee(id, name) {
      $('#seller-id-hidden').val(id);
      $('#seller-search').val(name).addClass('field-selected');
      $('#seller-icon').html('<i class="bi bi-check-lg text-success"></i>');
      $('#seller-results').hide();
    }

    function selectVehicle(id, name, price, stock) {
      currentVehicle = {
        id: id,
        name: name,
        price: parseFloat(price),
        stock: parseInt(stock)
      };
      $('#vehicle-search').val(name);
      $('#vehicle-results').hide();
    }

    function updateCalculations() {
      let subtotalValue = 0;
      let itemsCount = selectedItems.length;

      for (let index = 0; index < itemsCount; index++) {
        subtotalValue += (selectedItems[index].price * selectedItems[index].quantity);
      }

      let discountPercent = parseFloat($('#sale-discount').val()) || 0;
      let totalValue = subtotalValue - (subtotalValue * (discountPercent / 100));

      let totalReceived = 0;
      let paymentsCount = selectedPayments.length;

      for (let index = 0; index < paymentsCount; index++) {
        totalReceived += selectedPayments[index].amount;
      }

      let difference = totalReceived - totalValue;

      $('#view-subtotal').text(formatMoney(subtotalValue));
      $('#view-total').text(formatMoney(totalValue));
      $('#view-received').text(formatMoney(totalReceived));
      $('#view-difference').text(formatMoney(difference));
    }

    $("#sale-discount").on('input', function() {
      if (parseInt($(this).val()) > 100) {
        $(this).val(100);
      }
    });

    $('#btn-add-vehicle').click(function() {
      if (!currentVehicle) return alert("Por favor, selecione um veículo.");
      let amount = parseInt($('#input-amount').val());
      if (amount > currentVehicle.stock) return alert("Estoque insuficiente.");

      // O push coloca um novo objeto dentro da lista (array)
      selectedItems.push({
        id: currentVehicle.id,
        name: currentVehicle.name,
        price: currentVehicle.price,
        quantity: amount
      });

      renderItemsTable();
      currentVehicle = null;
      $('#vehicle-search').val('');
    });

    function renderItemsTable() {
      let rowsHtml = '';
      let totalRecords = selectedItems.length;

      for (let index = 0; index < totalRecords; index++) {
        let item = selectedItems[index];
        let sub = item.price * item.quantity;
        rowsHtml += `<tr>
                    <td>${item.name} 
                        <input type="hidden" name="itemsId[]" value="${item.id}">
                        <input type="hidden" name="itemAmount[]" value="${item.quantity}">
                    </td>
                    <td>${formatMoney(item.price)}</td>
                    <td>${item.quantity}</td>
                    <td>${formatMoney(sub)}</td>
                    <td class="text-end"><i class="bi bi-trash text-danger pointer" onclick="removeItem(${index})"></i></td>
                </tr>`;
      }
      $('#vehicle-table-body').html(rowsHtml);
      updateCalculations();
    }

    function removeItem(index) {
      selectedItems.splice(index, 1);
      renderItemsTable();
    }

    $('#btn-add-payment').click(function() {
      let method = $('#pay-method').val();
      let amount = parseMoney($('#pay-amount').val());
      let installments = $('#pay-installments').val();

      if (amount <= 0) return alert("Informe um valor válido.");
      if (method !== "Cartão de Crédito") installments = 1;

      selectedPayments.push({
        method: method,
        amount: amount,
        installments: installments
      });
      renderPaymentsTable();
      $('#pay-amount').val('');
    });

    function renderPaymentsTable() {
      let rowsHtml = '';
      let totalRecords = selectedPayments.length;

      for (let index = 0; index < totalRecords; index++) {
        let p = selectedPayments[index];
        rowsHtml += `<tr>
                    <td>${p.method} 
                        <input type="hidden" name="payMethod[]" value="${p.method}">
                        <input type="hidden" name="payAmount[]" value="${p.amount}">
                        <input type="hidden" name="payInstallments[]" value="${p.installments}">
                    </td>
                    <td>${p.installments}x</td>
                    <td>${formatMoney(p.amount)}</td>
                    <td class="text-end"><i class="bi bi-x-lg text-danger pointer" onclick="removePayment(${index})"></i></td>
                </tr>`;
      }
      $('#payment-table-body').html(rowsHtml);
      updateCalculations();
    }

    function removePayment(index) {
      selectedPayments.splice(index, 1);
      renderPaymentsTable();
    }

    $('#sale-discount').on('keyup', updateCalculations);

    function generateMockData() {
      const customers = <?php echo json_encode($mockCustomers); ?>;
      const employees = <?php echo json_encode($mockEmployees); ?>;
      const vehicles = <?php echo json_encode($mockVehicles); ?>;
      if (customers.length === 0 || employees.length === 0 || vehicles.length === 0) return;

      selectCustomer(customers[0].id, customers[0].nome);
      selectEmployee(employees[0].id, employees[0].nome);

      selectedItems = [{
        id: vehicles[0].id,
        name: vehicles[0].nome,
        price: parseFloat(vehicles[0].preco_venda),
        quantity: 1
      }];
      renderItemsTable();
    }

    $("#pay-method").on('change', function() {
      const isCredit = $(this).val() === "Cartão de Crédito";
      $("#pay-installments").prop('disabled', !isCredit);
    });

    $('#sale-form').on('submit', function(e) {
      let customerId = $("#customer-id-hidden").val();
      let sellerId = $("#seller-id-hidden").val();
      let discountPercent = parseFloat($('#sale-discount').val()) || 0;

      if (customerId == "") {
        alert('Por favor, selecione um cliente antes de finalizar.');
        e.preventDefault();
        return;
      }

      if (sellerId == "") {
        alert('Por favor, selecione um vendedor antes de finalizar.');
        e.preventDefault();
        return;
      }

      if (selectedItems.length == 0) {
        alert('A venda não possui produtos. Adicione ao menos um veículo.');
        e.preventDefault();
        return;
      }

      if (selectedPayments.length == 0) {
        alert('Você precisa informar como o cliente vai pagar.');
        e.preventDefault();
        return;
      }

      let totalToPay = 0;
      for (let index = 0; index < selectedItems.length; index++) {
        totalToPay += (selectedItems[index].price * selectedItems[index].quantity);
      }

      let finalTotalWithDiscount = totalToPay - (totalToPay * (discountPercent / 100));

      let totalAmountPaid = 0;
      for (let index = 0; index < selectedPayments.length; index++) {
        totalAmountPaid += selectedPayments[index].amount;
      }

      if (totalAmountPaid < finalTotalWithDiscount) {
        alert('O valor total pago é menor que o valor final da venda. Ajuste os pagamentos.');
        // O preventDefault cancela o envio do formulário
        e.preventDefault();
        return;
      }
    });
  </script>
</body>

</html>
--- END_FILE: ..\admin\vendas\manage.php ---
------------------------------

--- START_FILE: ..\admin\vendas\search.php ---
<?php
require_once("../../conexao/conecta.php");

$type = $_GET['type'] ?? '';
$query = mysqli_real_escape_string($connection, $_GET['q'] ?? '');

if ($type == 'customer') {
    $sql = "SELECT id, nome, cpf FROM cliente WHERE nome LIKE '%$query%' OR cpf LIKE '%$query%' LIMIT 5";
    $res = mysqli_query($connection, $sql);
    while ($row = mysqli_fetch_assoc($res)) {
        echo "<div class='search-item p-2' onclick=\"selectCustomer('{$row['id']}', '{$row['nome']}')\">
                <strong>{$row['nome']}</strong> <br> <small>CPF: {$row['cpf']}</small>
              </div>";
    }
}

if ($type == 'employee') {
    $sql = "SELECT id, nome FROM funcionario WHERE nome LIKE '%$query%' AND status = 1 LIMIT 5";
    $res = mysqli_query($connection, $sql);
    while ($row = mysqli_fetch_assoc($res)) {
        echo "<div class='search-item p-2' onclick=\"selectEmployee('{$row['id']}', '{$row['nome']}')\">
                <strong>{$row['nome']}</strong>
              </div>";
    }
}

if ($type == 'vehicle') {
    $sql = "SELECT v.id, m.nome as modelo, v.preco_venda, v.estoque, v.cor 
            FROM veiculo v 
            INNER JOIN modelo m ON v.id_modelo = m.id 
            WHERE m.nome LIKE '%$query%' AND v.status = 1 AND v.estoque > 0 LIMIT 5";
    $res = mysqli_query($connection, $sql);
    while ($row = mysqli_fetch_assoc($res)) {
        $preco = number_format($row['preco_venda'], 2, ',', '.');
        echo "<div class='search-item p-2' onclick=\"selectVehicle('{$row['id']}', '{$row['modelo']}', '{$row['preco_venda']}', '{$row['estoque']}')\">
                <strong>{$row['modelo']}</strong> - {$row['cor']} <br>
                <small>Preço: R$ $preco | Estoque: {$row['estoque']}</small>
              </div>";
    }
}
--- END_FILE: ..\admin\vendas\search.php ---
------------------------------

--- START_FILE: ..\admin\vendas\table.php ---
<?php
require_once("../../conexao/conecta.php");
require_once("../../Components/Table.php");

// Definindo a query principal com apelidos (aliases) em inglês para o código
$saleListSql = "SELECT 
            v.id, 
            c.nome AS customer_name, 
            f.nome AS employee_name, 
            v.valor_total AS total_amount, 
            v.data_cadastro AS createdAt, 
            v.status 
        FROM venda v 
        INNER JOIN cliente c ON v.id_cliente = c.id 
        INNER JOIN funcionario f ON v.id_funcionario = f.id";

$filterConditions = [];

// Verificando filtros enviados via POST (AJAX)
if (!empty($_POST['id'])) {
    $filterConditions[] = "v.id = " . (int)$_POST['id'];
}

if (!empty($_POST['customer'])) {
    $searchCustomer = mysqli_real_escape_string($connection, $_POST['customer']);
    $filterConditions[] = "c.nome LIKE '%$searchCustomer%'";
}

if (!empty($_POST['employee'])) {
    $searchEmployee = mysqli_real_escape_string($connection, $_POST['employee']);
    $filterConditions[] = "f.nome LIKE '%$searchEmployee%'";
}

if (!empty($_POST['date'])) {
    $searchDate = mysqli_real_escape_string($connection, $_POST['date']);
    $filterConditions[] = "DATE(v.data_cadastro) = '$searchDate'";
}

if (isset($_POST['status']) && $_POST['status'] !== "") {
    $filterConditions[] = "v.status = " . (int)$_POST['status'];
}

// Montando o WHERE dinamicamente se houver filtros
if (!empty($filterConditions)) {
    // Cara, ele sabe que o implode junta os itens do array com " AND "?
    $saleListSql .= " WHERE " . implode(" AND ", $filterConditions);
}

$saleListSql .= " ORDER BY v.id DESC";

$saleResult = mysqli_query($connection, $saleListSql);

// Renderizando a tabela: Labels em PT-BR para o usuário, mas chaves em EN para o banco
echo Table::render([
  "#" => "id",
  "Cliente" => "customer_name",
  "Vendedor" => "employee_name",
  "Total (R$)" => "total_amount",
  "Data" => "createdAt",
  "Status" => "status"
], $saleResult, [
  "editUrl" => "manage.php?id=",
  "entity" => "sales",
  "modalTarget" => null
]);
--- END_FILE: ..\admin\vendas\table.php ---
------------------------------

--- START_FILE: ..\admin\vitems\actions.php ---
<?php 
    require_once('../../conexao/conecta.php');

    if (!isset($_SESSION)) { session_start(); }

    // Excluir
    if (isset($_POST["delete"])) {
        $id = (int)$_POST["delete"]; 

        try {
            $query = "DELETE FROM caracteristica WHERE id = $id;";
            if (mysqli_query($connection, $query)) {
                $_SESSION['messageType'] = 'success';
                $_SESSION['messageText'] = "Sucesso: A característica foi excluída.";
            } else {
                throw new mysqli_sql_exception();
            }
        } catch (mysqli_sql_exception $e) {
            if ($e->getCode() == 1451) {
                $query = "SELECT COUNT(id_veiculo) AS total FROM caracteristica_carro WHERE id_caracteristica = $id";
                $result = mysqli_query($connection, $query);
                $totalCount = mysqli_fetch_assoc($result)['total'];

                $_SESSION['messageType'] = 'info';
                $_SESSION['messageText'] = "Falhou: Existem $totalCount veículos que dependem dela.";
            } else {
                $_SESSION['messageType'] = 'error';
                $_SESSION['messageText'] = "Erro: Não foi possível excluir o item.";
            }
        }
        header('Location: Index.php');
        exit;
    }

    // Cadastrar e Editar
    $id = isset($_POST['id']) ? (int)$_POST['id'] : 0;
    $isEditing = ($id > 0);

    $name = mysqli_real_escape_string($connection, $_POST['name']);
    $observation = mysqli_real_escape_string($connection, $_POST['observation']);
    $status = isset($_POST['status']) ? (int)$_POST['status'] : 1;
    
    $iconQuery = "";
    if (!empty($_FILES['icon']['name'])) {
        $iconName = time() . "_" . basename($_FILES['icon']['name']);
        if (move_uploaded_file($_FILES['icon']['tmp_name'], '../../images/' . $iconName)) {
            $iconQuery = ", icone = '$iconName'";
        }
    }

    if ($isEditing) {
        $query = "UPDATE caracteristica SET nome = '$name', observacao = '$observation', status = $status $iconQuery WHERE id = $id";
        $successMessage = "Característica editada com sucesso!";
    } else {
        $iconFinal = !empty($iconName) ? $iconName : 'default.png';
        $query = "INSERT INTO caracteristica VALUES (0, '$name', '$observation', '$iconFinal', NOW(), 1);";
        $successMessage = "Característica cadastrada!";
    }

    try {
        if (mysqli_query($connection, $query)) {
            $_SESSION['messageType'] = 'success';
            $_SESSION['messageText'] = 'Sucesso: '. $successMessage;
        } else {
            throw new mysqli_sql_exception();
        }
    } catch (mysqli_sql_exception $e) {
        $_SESSION['messageType'] = 'error';
        $_SESSION['messageText'] = ($e->getCode() == 1062) ? "Erro: Esse nome já existe." : "Erro: Não foi possível salvar os dados, tente novamente.";
        }

    header('Location: Index.php');
    exit;
?>
--- END_FILE: ..\admin\vitems\actions.php ---
------------------------------

--- START_FILE: ..\admin\vitems\Index.php ---
<?php

if (!isset($_SESSION)) {
  session_start();
}

require_once("../../conexao/conecta.php");
require_once("../../Components/FormModal.php");
require_once("../../Components/Table.php");
require_once('../../Components/Sidebar.php');
?>
<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Carros Fácil - Painel</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

  <link rel="shortcut icon" href="../../assets/img/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="../../custom/css/style.css">
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <?php echo Sidebar("items"); ?>

      <main class="col-lg-10">
        <header id="admin-header" class="py-3 d-flex align-items-center justify-content-between gap-2 px-3">
          <div id="left-info">GERENCIANDO - CARACTERÍSTICAS</div>
          <div id="right-info">
            <div id="current-time">AGORA</div>
          </div>
        </header>

        <hr class="m-0">

        <?php include('../Mensagem.php'); ?>

        <div class="container mt-3">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h4 class="m-0">Items</h4>
              <button type="button" class="btn btn-primary" data-entity="vitems" data-bs-toggle="modal" data-bs-target="#acessoriosModal">
                <i class="bi bi-plus-lg"></i> Adicionar
              </button>
            </div>

            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-4">
                  <input onkeyup="applyFilters()" type="text" name="name-filter" id="name-filter" class="form-control" placeholder="Nome da característica">
                </div>
                <div class="col-md-2">
                  <select onchange="applyFilters()" name="status-filter" id="status-filter" class="form-control">
                    <option value="">Status</option>
                    <option value="1">Ativo</option>
                    <option value="0">Inativo</option>
                  </select>
                </div>
              </div>
            </div>

           <div id="table-target"></div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <?php
  echo FormModal::create([
    "modalId" => "acessoriosModal",
    "actionUrl" => "./actions.php",
    "submitButton" => '<button id="#modal-submit-btn" type="submit" class="btn btn-primary w-100">Cadastrar</button>'
  ], [
    ["id" => "icon", "optional" => false, "label" => "Ícone do Item", "type" => "image"],
    ["id" => "name", "optional" => false, "label" => "Nome", "type" => "text", "length" => 80],
    ["id" => "observation", "optional" => true, "label" => "Observação", "type" => "text", "length" => 250],
    ["id" => "status", "optional" => false, "label" => "Status", "type" => "select", "options" => [
      ["label" => "Desativado", "value" => 0],
      ["label" => "Ativado", "value" => 1],
    ]]
  ]);
  ?>

  <!-- API JAVASCRIPTS -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- CUSTOM JAVASCRIPTS -->
  <script src="../../assets/js/components/form-modal.js"></script>
  <script src="../../assets/js/components/admin-header.js"></script>
  <script src="../../assets/js/components/sidebar.js"></script>

  <script>

    function updateTableWithFilters(name, status) {
      $.ajax({
        url: 'table.php',
        method: 'POST',
        data: {
          name,
          status
        },
        success: function(response) {
          $("#table-target").html(response);
        }
      });
    }

    function applyFilters() {
      updateTableWithFilters($("#name-filter").val(), $("#status-filter").val());
    }

    $(document).ready(function() {
      applyFilters();
    });
  </script>
</body>

</html>
--- END_FILE: ..\admin\vitems\Index.php ---
------------------------------

--- START_FILE: ..\admin\vitems\table.php ---
<?php
require_once("../../conexao/conecta.php");
require_once("../../Components/Table.php");

// Query base que vai ser usada abaixo
$query = "SELECT id, nome 'name', observacao 'observation', icone 'icon', data_cadastro 'createdAt', status FROM caracteristica";

$name = $_POST["name"] ?? "";
$status = $_POST["status"] ?? "";
$conditions = [];

// Filtro por nome
if ($name !== "") {
    $name = mysqli_real_escape_string($connection, $name);
    $conditions[] = "nome LIKE '%$name%'";
}

// Filtro por status (Ativo/Inativo)
if ($status !== "") {
    $conditions[] = "status = " . (int)$status;
}

// Se houver filtros, aplica o WHERE no SQL
if (!empty($conditions)) {
    $query .= " WHERE " . implode(" AND ", $conditions);
}

$query .= " ORDER BY id ASC";
$result = mysqli_query($connection, $query);

// Renderiza a tabela usando o componente padrão do sistema
echo Table::render([
  "#" => "id",
  "Ícone" => "icon",
  "Nome" => "name",
  "Observação" => "observation",
  "Status" => "status"
], $result, [
  "entity" => "vitems",
  "modalTarget" => "#acessoriosModal"
]);
?>
--- END_FILE: ..\admin\vitems\table.php ---
------------------------------

